# Kiro Knowledge Base v3.0 - "贾维斯"架构完整设计方案

> 创建时间: 2026-01-20  
> 目标工程: D:\G_GitHub\Kiro-KB-Plugin  
> 来源: 关于"让 AI 懂你"的深度讨论  
> 状态: 待迁移到插件工程

---

## 📍 重要说明

**这份文档应该保存到**: `D:\G_GitHub\Kiro-KB-Plugin/docs/architecture/v3.0-jarvis-architecture.md`

**目的**: 当你打开 Kiro-KB-Plugin 工程时，Kiro 能通过读取这份文档，理解我们今天讨论的"贾维斯架构"愿景。

---

## 🎯 核心愿景

**从"工具"进化为"助手"——构建个人版贾维斯**

### 问题的本质

```
当前 Kiro 的问题:
❌ 每次对话都是"重新开始"
❌ 不记得上次在做什么
❌ 不知道项目之间的关联
❌ 需要用户重复说明上下文

用户的期望（贾维斯式）:
✓ 记住我的项目和习惯
✓ 理解我的工作模式
✓ 预测我的需求
✓ 主动提醒和建议
```

### 关键洞察

**1. Trae 的启发**
- Trae 有 Skill 系统（云同步的专业知识）
- 虽然自动化调试成本高，但"懂用户"的能力很强
- 用户想要的不是"完全自动化"，而是"理解和记忆"

**2. 贾维斯的比喻**
- **战甲贾维斯**（本地 Kiro）：跟随用户，实时辅助
- **基地贾维斯**（中央知识库）：强大的后台，完整的记忆
- **无缝连接**：在家讨论的方案，到公司 Kiro 也知道

**3. 核心需求**
> "让 AI 分析出你现在拥有的项目，智能的把点子规划到相应的项目中，打开那项目，AI 会提醒，我们要不要给予这个点子，重新深度的开发下架构。"

---

## 🏗️ 三层架构

### Level 1: 记住（Memory）

**目标**: 让 Kiro 记住基本信息

**实现**:

1. **项目元数据（PROJECT.md）**
   ```json
   {
     "name": "Blender 动画工作流",
     "type": "3d-animation",
     "keywords": ["blender", "spine", "comfyui", "animation"],
     "status": "active",
     "lastUpdate": "2026-01-20",
     "currentTasks": [
       {
         "id": "task-001",
         "title": "完成 AI 序列帧工作流",
         "status": "in-progress",
         "priority": "high"
       }
     ],
     "commonPaths": {
       "source": "D:/Projects/Blender/",
       "export": "D:/Export/FBX/"
     },
     "relatedProjects": ["ComfyUI", "Spine"],
     "notes": "用户习惯先调研再实现"
   }
   ```

2. **会话历史（session-history.json）**
   ```json
   {
     "sessions": [
       {
         "id": "session-20260120-001",
         "date": "2026-01-20",
         "device": "home-pc",
         "project": "kiro-knowledge-base",
         "topic": "贾维斯架构设计",
         "summary": "讨论了如何让 Kiro 变得'懂用户'",
         "decisions": [
           "采用三层架构：记住、理解、预测",
           "实现跨设备同步"
         ],
         "nextSteps": [
           "设计 PROJECT.md 格式",
           "实现自动同步机制"
         ]
       }
     ]
   }
   ```

3. **用户习惯（user-profile.json）**
   ```json
   {
     "workingHours": {
       "preferred": "20:00-22:00",
       "timezone": "Asia/Shanghai"
     },
     "workStyle": {
       "approach": "research-first",
       "development": "incremental",
       "testing": "manual-then-automated"
     },
     "preferences": {
       "codeStyle": "typescript-strict",
       "communication": "concise",
       "documentation": "markdown"
     }
   }
   ```

### Level 2: 理解（Understanding）

**目标**: 让 Kiro 理解上下文和关联

**实现**:

1. **对话价值评估**
   ```typescript
   interface ConversationValue {
     score: number;        // 1-5 分
     category: string;     // solutions/notes/discussions
     reasoning: string;
     tags: string[];
   }
   
   评分标准:
   5分：重要技术方案、架构设计、关键决策
   4分：完整的问题解决方案
   3分：有用的技术笔记、代码片段
   2分：一般性讨论
   1分：闲聊或无价值内容
   ```

2. **项目匹配引擎**
   ```typescript
   interface ProjectMatch {
     projectName: string;
     matchScore: number;   // 0-100
     matchedKeywords: string[];
     reasoning: string;
   }
   
   算法:
   1. 提取对话关键词
   2. 匹配项目 keywords
   3. 计算匹配度
   4. 按分数排序
   ```

3. **知识关联发现**
   - 发现项目间的重复内容
   - 发现知识缺失（有问题但无解决方案）
   - 发现知识过时（技术栈变更）

### Level 3: 预测（Prediction）

**目标**: 让 Kiro 主动服务

**实现**:

1. **习惯学习**
   - 分析用户的操作模式
   - 提取常用工作流
   - 识别时间偏好

2. **主动提醒**
   ```
   打开项目时:
   "你已经 3 天没碰这个项目了。
    上次讨论：ComfyUI IPAdapter 问题
    待办任务：2 个
    要继续吗？"
   ```

3. **智能建议**
   ```
   基于项目状态:
   "这个项目的文档已经很完善了，
    可以整理成教程分享"
   
   基于历史经验:
   "你在 Feishu 项目中用的自动化思路，
    也适用于 Blender 导出流程"
   ```

---

## 🌐 战甲-基地架构

### 核心概念

```
基地贾维斯（中央知识库）
├─ 云端存储（GitHub）
├─ 完整的项目记忆
├─ 所有对话历史
├─ 工作习惯数据
└─ 跨设备同步

        ↕️ 实时连接

战甲贾维斯（本地 Kiro）
├─ 家里电脑
├─ 公司电脑
├─ 笔记本
└─ 都连接到同一个"基地"
```

### 中央知识库结构

```
D:\G_GitHub\Kiro-Central-KB\
├─ projects/           # 项目元数据
│   ├─ blender.json
│   ├─ maya.json
│   ├─ feishu.json
│   └─ kiro-kb-plugin.json
│
├─ sessions/           # 会话历史
│   ├─ 2026-01/
│   │   ├─ 20.json
│   │   └─ 21.json
│   └─ index.json
│
├─ habits/             # 工作习惯
│   └─ user-profile.json
│
└─ knowledge/          # 知识文档
    ├─ solutions/
    ├─ notes/
    └─ discussions/
```

### 同步策略

**方案 A：Git 自动同步（推荐）**

```
同步机制:
1. 对话结束时自动保存到本地 KB
2. Git hook 自动 commit + push
3. 其他设备定时 pull（每 5 分钟）
4. 冲突解决：最新优先 + 手动合并

优势:
✓ 简单可靠
✓ 版本控制
✓ 离线可用
✓ 零成本

劣势:
✗ 不是实时（5 分钟延迟）
✗ 需要网络
```

**方案 B：云数据库实时同步（高级）**

```
技术栈:
- Supabase（开源、免费额度大）
- 实时订阅（WebSocket）
- 离线支持（本地缓存）

优势:
✓ 真正实时（秒级）
✓ 自动冲突解决
✓ 多设备并发

劣势:
✗ 需要搭建
✗ 依赖网络
✗ 有一定成本
```

**方案 C：混合方案（平衡）**

```
基础数据（Git 同步）
├─ 项目元数据（变化不频繁）
├─ 知识文档（定期更新）
└─ 每天同步一次

实时数据（云数据库）
├─ 会话历史（实时记录）
├─ 当前任务状态（频繁变化）
└─ 实时同步

优势:
✓ Git 保证数据安全
✓ 云数据库保证实时性
✓ 成本可控
```

---

## 🎬 实际场景

### 场景 1：跨设备工作

```
周一晚上在家:
你: "帮我设计 Blender 导出流程"
家里 Kiro: [讨论方案]
系统: [保存到中央 KB，自动同步]

周二早上到公司:
你: 打开 Blender 项目
公司 Kiro: [自动 pull 最新数据]
公司 Kiro: "检测到你昨晚在家讨论了导出流程，
           这是方案摘要：[...]
           要继续实现吗？"
```

### 场景 2：项目关联发现

```
在 Blender 项目:
你: "这个动画导出有问题"
Kiro: [查询中央知识库]
Kiro: "发现你在 Maya 项目中遇到过类似问题，
      当时的解决方案是：[...]
      要应用到 Blender 吗？"
```

### 场景 3：习惯学习

```
中央知识库分析（每周自动）:
- 你通常在晚上 8-10 点工作
- 你喜欢先做技术调研，再实现
- 你习惯用 Git 提交触发通知
- 你的项目通常在 D:\Projects\

下次新项目:
Kiro: "按照你的习惯，我建议:
      1. 先调研现有方案（你通常这样做）
      2. 创建项目在 D:\Projects\（你的常用路径）
      3. 设置 Git 通知（你喜欢的方式）
      4. 晚上 8 点开始（你的高效时段）"
```

### 场景 4：主动提醒

```
打开 Kiro-KB-Plugin 项目:
Kiro: "检测到你打开了知识库插件项目。
      
      上次讨论（2026-01-20）:
      - 主题：贾维斯架构设计
      - 决策：采用三层架构（记住、理解、预测）
      - 下一步：设计 PROJECT.md 格式
      
      要基于这个讨论重新设计架构吗？"
```

---

## 🛠️ 技术实现

### 插件架构调整

```
当前架构（v2.x）:
VSCode Extension
├─ 监听对话事件
├─ 保存到知识库
└─ 更新索引

新架构（v3.0）:
VSCode Extension
├─ 对话监听层
│  ├─ 实时记录对话
│  └─ 对话结束时触发评估
│
├─ 智能分析层
│  ├─ 价值评估引擎
│  ├─ 项目匹配引擎
│  └─ 知识关联引擎
│
├─ 知识管理层
│  ├─ 自动保存
│  ├─ 智能分类
│  └─ 索引更新
│
├─ 项目感知层
│  ├─ 项目扫描
│  ├─ 元数据管理
│  └─ 主动提醒
│
└─ 同步层
   ├─ Git 自动同步
   ├─ 冲突解决
   └─ 跨设备协调
```

### 核心模块（伪代码）

#### 1. 项目扫描器

```typescript
export class ProjectScanner {
  async scanWorkspace(): Promise<Project[]> {
    // 扫描工作区中的所有项目
    // 读取 PROJECT.md 或自动识别项目类型
  }
  
  async detectProjectType(projectPath: string): Promise<string> {
    // 根据文件特征识别项目类型
    // package.json → nodejs
    // requirements.txt → python
    // *.blend → blender
  }
}
```

#### 2. 会话管理器

```typescript
export class SessionManager {
  startSession(project?: Project) {
    // 开始新会话
  }
  
  addMessage(message: Message) {
    // 记录对话消息
  }
  
  async endSession() {
    // 1. 生成会话摘要
    // 2. 评估对话价值
    // 3. 匹配相关项目
    // 4. 保存到中央知识库
    // 5. 触发同步
  }
}
```

#### 3. 同步管理器

```typescript
export class SyncManager {
  async push() {
    // 1. 检查未同步数据
    // 2. Git commit
    // 3. Git push
  }
  
  async pull() {
    // 1. Git pull
    // 2. 检查冲突
    // 3. 解决冲突
    // 4. 更新本地缓存
  }
  
  private startAutoSync() {
    // 每 5 分钟自动同步
  }
}
```

#### 4. 主动提醒器

```typescript
export class Reminder {
  async onProjectOpen(projectPath: string) {
    // 1. 读取项目元数据
    // 2. 查询最近会话
    // 3. 检查待办任务
    // 4. 生成提醒消息
    // 5. 显示提醒
  }
  
  private generateReminderMessage(context: ReminderContext): string {
    // 根据上下文生成个性化提醒
  }
}
```

---

## 📋 实施计划

### Phase 1: 基础记忆（1-2 周）

**目标**: 让 Kiro 能记住基本信息

```
Week 1:
- [ ] 设计 PROJECT.md 格式
- [ ] 实现项目扫描器
- [ ] 实现会话记录功能
- [ ] 创建中央知识库结构

Week 2:
- [ ] 实现 Git 自动同步
- [ ] 实现打开项目时读取元数据
- [ ] 实现简单的提醒功能
- [ ] 测试基础流程
```

**验收标准**:
- ✓ 能自动识别项目类型
- ✓ 能记录每次对话
- ✓ 能跨设备同步数据
- ✓ 打开项目时能显示上次进度

### Phase 2: 智能理解（2-3 周）

**目标**: 让 Kiro 理解上下文和关联

```
Week 3-5:
- [ ] 实现对话价值评估
- [ ] 实现自动分类保存
- [ ] 实现项目匹配引擎
- [ ] 实现知识关联发现
- [ ] 优化匹配算法
```

**验收标准**:
- ✓ 能自动判断对话价值
- ✓ 能准确匹配相关项目
- ✓ 能发现知识重复和缺失
- ✓ 提醒准确率 > 80%

### Phase 3: 主动服务（1-2 月）

**目标**: 让 Kiro 主动建议和优化

```
Week 6-10:
- [ ] 实现习惯学习算法
- [ ] 实现智能建议引擎
- [ ] 实现预测性提醒
- [ ] 优化用户体验
- [ ] 完善文档
```

**验收标准**:
- ✓ 能学习用户习惯
- ✓ 能主动建议下一步
- ✓ 能预测用户需求
- ✓ 用户满意度 > 90%

---

## 🎯 成功标准

### 用户体验目标

```
✓ 跨设备工作无缝衔接
✓ 打开项目快速回到工作状态
✓ 自动发现知识关联
✓ 根据习惯提供个性化建议
```

### 技术指标

```
性能:
- 项目扫描 < 1 秒
- 会话保存 < 500ms
- 同步延迟 < 5 分钟
- 提醒响应 < 100ms

准确性:
- 项目匹配准确率 > 85%
- 对话价值评估准确率 > 80%
- 知识关联发现准确率 > 75%

可靠性:
- 数据不丢失（Git 版本控制）
- 冲突自动解决率 > 95%
- 系统可用性 > 99%
```

---

## 💭 待讨论的问题

### 1. 隐私和安全
- 公司项目信息是否应该同步到个人中央 KB？
- 敏感数据（API 密钥、密码）如何处理？
- 多人协作时如何隔离个人数据？

### 2. 性能优化
- 大量项目时扫描性能如何？
- 会话历史过多时查询性能如何？
- 跨设备同步的网络开销如何？

### 3. 用户体验
- 提醒频率如何控制？（避免打扰）
- 如何处理误判？（匹配错误的项目）
- 如何让用户信任 AI 的建议？

---

## 📚 参考资料

### 相关讨论
- `knowledge-base/notes/20260120-LLM认知编排系统架构详解.md`
- `incubator/kiro-knowledge-base/ideas/20260120-智能知识管理与项目感知.md`
- 今天关于"让 AI 懂你"的完整讨论

### 技术参考
- VSCode Extension API
- Git 自动化（simple-git）
- LLM 提示词工程
- Supabase 实时数据库

### 竞品分析
- Trae/SOLO 的 Skill 系统
- GitHub Copilot 的上下文理解
- Cursor 的项目感知

---

**创建时间**: 2026-01-20  
**创建者**: 基于与用户的深度讨论  
**下一步**: 
1. 将此文档迁移到 `D:\G_GitHub\Kiro-KB-Plugin/docs/architecture/`
2. 打开插件工程测试 Kiro 是否能理解这个架构
3. 开始 Phase 1 开发

