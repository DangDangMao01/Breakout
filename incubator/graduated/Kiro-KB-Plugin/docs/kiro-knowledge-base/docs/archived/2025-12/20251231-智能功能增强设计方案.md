---
domain: kiro
tags: [plugin, analysis, v2.38.0]
date: 2026-01-04
source_project: "kiro-knowledge-base"
---

# Kiro Knowledge Base v2.38.0 功能分析

## 当前版本功能总结

### P0-P5 智能分类系统 (classifier.ts)

#### P0: KnowledgeClassifier
- 领域检测: unity, kiro, devops, web, ai, database, other
- 子领域识别: shader, physics, animation, ui 等
- 类型识别: solution, note, discussion, reference, tutorial
- 标签规范化

#### P1: SimilarityDetector
- Jaccard 相似度计算
- 标题相似度检测
- 重复内容检测

#### P1: TagManager
- 标签统计分析
- 低频/高频标签识别
- 相似标签合并建议

#### P2: QualityAssessor
- 5维度评分: 结构、深度、元数据、可读性、时效性
- A-F 等级评定
- 改进建议生成
- 复查提醒

#### P3: KnowledgeGraphBuilder
- 知识节点管理
- 关联边构建 (领域/标签/相似度)
- Mermaid 图谱生成
- 核心节点/孤立节点识别
- 相关推荐

#### P4: LifecycleManager
- 清理建议生成 (低质量/过期/重复)
- 归档记录管理
- 清理报告生成

#### P5: ContextAnalyzer
- 文件类型识别
- 技术栈检测
- 领域推断

#### P5: SmartRecommendationEngine
- 访问历史记录
- 基于上下文的智能推荐
- 热门/最近知识统计

#### P6: TFIDFSearchEngine
- TF-IDF 语义搜索（比简单关键词匹配更精准）
- 中英文分词支持
- 文档索引管理 (addDocument/addDocuments)
- IDF 自动重建
- 相似文档查找 (余弦相似度)
- 索引统计 (docCount/termCount/avgDocLength)

#### P7: KnowledgeGapAnalyzer
- 知识缺口检测
- 领域覆盖率分析
- 期望主题 vs 已覆盖主题对比
- 缺口严重程度评估 (high/medium/low)
- 建议学习主题生成
- 缺口分析报告生成

#### P8: HealthAnalyzer (知识库健康度仪表盘)
- 总体健康度评分 (0-100) + 等级评定 (A-F)
- 7 个关键指标监控:
  - 知识总量 (目标 ≥50 篇)
  - 月活跃度 (目标 ≥10 篇/月)
  - 高质量占比 (A/B 级占比)
  - 平均质量分 (0-10)
  - 领域均衡度 (基尼系数反向)
  - 内容新鲜度 (180天内更新占比)
  - 标签丰富度 (平均标签数/篇)
- 活跃度统计 (7天/30天/90天/周均)
- 质量分布 (A/B/C/D/F 等级分布)
- 领域平衡分析 (各领域占比)
- 类型平衡分析 (各类型占比)
- 智能告警 (info/warning/error 级别)
- 仪表盘报告生成 (支持中英文)

#### P9: LearningPathGenerator (学习路径生成器)
- 基于主题生成学习路径
- 难度分析 (beginner/intermediate/advanced)
- 阅读时间估算 (中文400字/分钟，英文200词/分钟)
- 关键点提取 (从二级标题提取)
- 前置知识依赖关系
- 学习步骤排序 (按难度递进)
- 进度追踪表格
- 学习路径报告生成 (支持中英文)

## 版本历史 (v2.20.0 - v2.40.0)

- v2.40.0: 智能标题生成
  - 清理无意义前缀（TASK、Hook、STATUS 等）
  - 清理 Markdown 格式（标题标记、加粗、链接等）
  - 问句转陈述句（如何→方法、为什么→原因）
  - 从 AI 回答中提取标题（当用户问题无意义时）
  - 智能截断（在标点处截断，避免断词）
- v2.39.0: 编码修复功能
  - 新增 encoding.ts 模块，统一编码处理
  - UTF-8 BOM 自动添加，解决跨设备中文乱码
  - 编码检测（UTF-8/UTF-8 BOM/UTF-16LE/UTF-16BE）
  - 新增命令：`Kiro KB: 修复编码` - 批量修复知识库文件编码
  - safeWriteFile 函数升级，默认添加 BOM
- v2.38.0: 知识整理助手
  - 知识库问题分析（标题不规范、内容重复、低价值）
  - 生成结构化整理提示让 Kiro 执行
  - 侧边栏整理状态显示
- v2.37.0: 对话整理设置增强
  - 自动检查开关 (toggleDigestAutoCheck)
  - 最低价值分数设置 (setDigestMinScore)
  - 重复检测优化
- v2.35.0: 对话整理功能
  - 扫描 Kiro 对话历史 (scanConversations)
  - 智能整理到知识库 (digestConversations)
  - 首次打开项目检查历史对话
  - 关闭项目时提示整理
  - 知识提炼（问题→解决方案格式）
- v2.32.0: P6-P9 智能功能增强
  - P6: TF-IDF 语义搜索引擎
  - P7: 知识缺口检测
  - P8: 健康度仪表盘
  - P9: 学习路径生成器
  - 智能链接建议 (Ctrl+Alt+L)
  - 交互式知识图谱 (D3.js WebView)
- v2.31.0: UUID 项目绑定 + 默认保存到中央库
- v2.30.0: 本地知识库增强
- v2.29.x: 项目管理模块、文档迁移
- v2.28.0: 项目问题追踪
- v2.27.x: 侧边栏工具按钮、MCP 文件系统配置
- v2.22.0-v2.27.0: P0-P5 智能分类系统

## 交互式知识图谱实现 (v2.32.0)

### 技术栈
- D3.js v7 力导向图
- WebView Panel (retainContextWhenHidden)

### 功能特性
- 力导向布局自动排列
- 节点按领域着色 (unity/kiro/devops/web/ai/database)
- 节点大小 = 5 + qualityScore
- 边粗细 = sqrt(weight) * 2
- 搜索过滤 (标题/标签)
- 领域下拉筛选
- 缩放/平移/拖拽
- 悬停显示详情 (标题/领域/标签/质量进度条)
- 点击打开文件


## v2.35.0-v2.38.0 新功能详解

### 对话整理模块 (conversationDigest.ts)

v2.35.0 引入的核心功能，自动扫描和整理 Kiro 对话历史。

**功能特性：**
- 扫描 Kiro 存储路径下的对话历史
- 智能评估对话价值（1-10分）
- 重复检测：保存前检查知识库是否已有类似内容
- 知识提炼：将对话转化为结构化的问题→解决方案格式
- 自动分类：solution/note/discussion

**触发时机：**
1. 首次打开项目 - 扫描历史对话，提示用户是否整理
2. 工作期间 - 后台监控，定期/手动整理
3. 关闭项目时 - 提示用户整理本次会话内容

**配置项：**
- `kiro-kb.digest.enabled` - 启用对话整理功能
- `kiro-kb.digest.autoOnClose` - 关闭项目时自动提示整理
- `kiro-kb.digest.checkOnOpen` - 首次打开项目时检查历史对话
- `kiro-kb.digest.minValueScore` - 整理的最低价值分数 (1-10)

### 知识整理助手 (knowledgeOrganizer.ts)

v2.38.0 引入，分析知识库问题并生成整理任务。

**分析维度：**
1. 标题问题检测
   - TASK 前缀 (`## TASK 1:`)
   - Hook 前缀 (`[自动化]`, `Execute hook:`)
   - 无意义标题 (`上传`, `读取`, `测试`)
   - 过长标题 (>60字符)

2. 相似内容检测
   - 版本系列分组 (v2.xx 系列)
   - 关键词相似度 (Jaccard >0.6)
   - 生成合并建议

3. 低价值文件检测
   - 内容过短 (<200字)
   - 无标签
   - 自动生成且内容少

**输出：**
- 生成结构化 Markdown 任务清单
- 包含具体的合并/重命名/删除建议
- 侧边栏显示整理状态摘要

### 新增命令

| 命令 | 功能 | 版本 |
|------|------|------|
| digestConversations | 整理对话到知识库 | v2.35.0 |
| scanConversations | 扫描对话历史 | v2.35.0 |
| toggleDigestAutoCheck | 切换自动检查 | v2.37.0 |
| setDigestMinScore | 设置最低价值分数 | v2.37.0 |
| organizeKnowledge | 知识整理助手 | v2.38.0 |


## v2.39.0 编码修复模块 (encoding.ts)

### 问题背景
Windows 跨设备同步知识库时，UTF-8 文件可能被错误识别为其他编码（如 GBK），导致中文显示乱码。

### 解决方案
为 Markdown 文件添加 UTF-8 BOM (Byte Order Mark) 标记，确保所有编辑器正确识别编码。

### 核心函数

| 函数 | 功能 |
|------|------|
| `detectEncoding(buffer)` | 检测文件编码类型 |
| `isValidUtf8(buffer)` | 验证是否为有效 UTF-8 |
| `safeReadFileWithEncoding(path)` | 安全读取（自动处理编码） |
| `safeWriteFileWithEncoding(path, content, addBom)` | 安全写入（带 BOM） |
| `hasBom(path)` | 检查文件是否有 BOM |
| `addBomToFile(path)` | 为单个文件添加 BOM |
| `fixEncodingInDirectory(dir, recursive)` | 批量修复目录下所有 .md 文件 |
| `countFilesWithoutBom(dir)` | 统计缺少 BOM 的文件数量 |

### 新增命令

`Kiro KB: 修复编码 / Fix Encoding`
- 选择本地/中央知识库或全部修复
- 显示需要修复的文件数量
- 批量添加 UTF-8 BOM
- 进度条显示修复进度

### 技术细节

UTF-8 BOM 字节序列：`0xEF 0xBB 0xBF`

```typescript
const UTF8_BOM_BUFFER = Buffer.from([0xEF, 0xBB, 0xBF]);
```

编码检测优先级：
1. UTF-8 BOM (EF BB BF)
2. UTF-16 LE (FF FE)
3. UTF-16 BE (FE FF)
4. 纯 UTF-8（无 BOM，通过字节序列验证）
