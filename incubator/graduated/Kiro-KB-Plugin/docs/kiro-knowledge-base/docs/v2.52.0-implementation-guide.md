# v2.52.0 实施指南

> 从代码到发布的完整步骤

---

## 📋 已完成的工作

### 1. 核心模块创建 ✅

- **setupWizard.ts** - 首次使用引导和路径验证
- **simplifiedPanel.ts** - 简化版侧边栏
- **helpSystem.ts** - 帮助系统
- **v2.52.0-integration.ts** - 集成代码示例

### 2. 功能实现状态

| 功能 | 状态 | 文件 |
|------|------|------|
| 启动时路径验证 | ✅ 完成 | setupWizard.ts |
| 首次设置向导 | ✅ 完成 | setupWizard.ts |
| 路径无效提示 | ✅ 完成 | setupWizard.ts |
| 自动检测知识库 | ✅ 完成 | setupWizard.ts |
| 一键初始化 | ✅ 完成 | setupWizard.ts |
| 重置配置命令 | ✅ 完成 | setupWizard.ts |
| 简化侧边栏 | ✅ 完成 | simplifiedPanel.ts |
| 智能显示逻辑 | ✅ 完成 | simplifiedPanel.ts |
| 帮助菜单 | ✅ 完成 | helpSystem.ts |
| 快速开始指南 | ✅ 完成 | helpSystem.ts |
| 常见问题 FAQ | ✅ 完成 | helpSystem.ts |
| 智能提示系统 | ✅ 完成 | helpSystem.ts |
| 错误提示优化 | ✅ 完成 | helpSystem.ts |

---

## 🔧 接下来的步骤

### Step 1: 集成到 extension.ts

#### 1.1 添加导入语句

在 `extension.ts` 文件顶部添加：

```typescript
// v2.52.0 新增导入
import { 
    validateSetup, 
    showFirstTimeSetup, 
    showPathInvalidPrompt, 
    showInitializePrompt, 
    resetPluginConfiguration 
} from './setupWizard';
import { SimplifiedPanelProvider } from './simplifiedPanel';
import { HelpSystem, showErrorWithSolution } from './helpSystem';
```

#### 1.2 在 activate 函数开始处添加验证

```typescript
export async function activate(context: vscode.ExtensionContext) {
    // 创建输出通道
    outputChannel = vscode.window.createOutputChannel('Kiro Knowledge Base');
    context.subscriptions.push(outputChannel);
    
    log('Kiro Knowledge Base extension is now active!');
    
    // v2.52.0: 启动时验证设置
    const validation = await validateSetup();
    switch (validation.reason) {
        case 'no-config':
            await showFirstTimeSetup();
            break;
        case 'path-invalid':
            await showPathInvalidPrompt(validation.centralPath!);
            break;
        case 'structure-incomplete':
            await showInitializePrompt(validation.centralPath!);
            break;
    }
    
    // Load configuration
    loadConfiguration();
    
    // ... 继续现有代码 ...
}
```

#### 1.3 注册帮助系统命令

在命令注册部分添加：

```typescript
// v2.52.0: 帮助系统
const helpSystem = new HelpSystem(context);

context.subscriptions.push(
    vscode.commands.registerCommand('kiro-kb.showHelp', async () => {
        await helpSystem.showHelpMenu();
    }),
    vscode.commands.registerCommand('kiro-kb.showQuickStart', async () => {
        await helpSystem.showQuickStart();
    }),
    vscode.commands.registerCommand('kiro-kb.showFAQ', async () => {
        await helpSystem.showFAQ();
    }),
    vscode.commands.registerCommand('kiro-kb.resetConfiguration', async () => {
        await resetPluginConfiguration();
    })
);
```

#### 1.4 （可选）注册简化版面板

如果要启用新的简化侧边栏：

```typescript
// v2.52.0: 简化版知识面板
const simplifiedProvider = new SimplifiedPanelProvider();
const simplifiedTreeView = vscode.window.createTreeView('kiro-kb.simplifiedPanel', {
    treeDataProvider: simplifiedProvider,
    showCollapseAll: false
});
context.subscriptions.push(simplifiedTreeView);

context.subscriptions.push(
    vscode.commands.registerCommand('kiro-kb.refreshSimplifiedPanel', () => {
        simplifiedProvider.refresh();
    })
);
```

### Step 2: 更新 package.json

#### 2.1 添加新命令

在 `contributes.commands` 中添加：

```json
{
  "command": "kiro-kb.showHelp",
  "title": "Kiro KB: 帮助 / Help",
  "icon": "$(question)"
},
{
  "command": "kiro-kb.showQuickStart",
  "title": "Kiro KB: 快速开始 / Quick Start"
},
{
  "command": "kiro-kb.showFAQ",
  "title": "Kiro KB: 常见问题 / FAQ"
},
{
  "command": "kiro-kb.resetConfiguration",
  "title": "Kiro KB: 重置插件配置 / Reset Configuration"
}
```

#### 2.2 （可选）添加新的 TreeView

如果启用简化版面板，在 `contributes.views` 中添加：

```json
"views": {
  "kiro-kb-explorer": [
    {
      "id": "kiro-kb.simplifiedPanel",
      "name": "📚 Knowledge Base",
      "contextualTitle": "Knowledge Base"
    }
  ]
}
```

#### 2.3 更新版本号

```json
{
  "version": "2.52.0"
}
```

### Step 3: 编译和测试

#### 3.1 编译 TypeScript

```bash
cd kiro-knowledge-base/extension
npm run compile
```

#### 3.2 检查编译错误

```bash
# 查看编译输出
# 修复任何 TypeScript 错误
```

#### 3.3 本地测试

1. 按 F5 启动调试
2. 测试首次使用流程：
   - 清除配置：`Kiro KB: 重置插件配置`
   - 重新加载窗口
   - 验证首次设置向导是否显示
3. 测试路径无效场景：
   - 手动修改配置为无效路径
   - 重新加载窗口
   - 验证路径无效提示
4. 测试帮助系统：
   - 运行 `Kiro KB: 帮助`
   - 验证快速开始指南
   - 验证 FAQ
5. 测试简化侧边栏（如果启用）：
   - 验证层级结构
   - 验证搜索功能
   - 验证浏览功能

### Step 4: 打包发布

#### 4.1 打包 VSIX

```bash
cd kiro-knowledge-base/extension
npm run package
```

#### 4.2 测试 VSIX

```bash
# 在新的 VSCode 窗口中安装
code --install-extension kiro-knowledge-base-2.52.0.vsix
```

#### 4.3 编写发布说明

创建 `RELEASE-NOTES-v2.52.0.md`：

```markdown
# Kiro Knowledge Base v2.52.0

> 用户体验优化版本 | 发布日期：2026-01-09

## ✨ 新功能

### 1. 首次使用引导
- 启动时自动验证路径
- 3步完成设置（欢迎 → 选择路径 → 自动初始化）
- 跨设备场景智能提示

### 2. 侧边栏简化
- 减少层级，1-2次点击即可访问
- 最常用功能放最前（搜索 > 浏览 > 最近）
- 智能显示（根据 IDE 类型自动调整）

### 3. 自动化配置
- 自动检测知识库位置
- 一键初始化完整结构
- 自动修复缺失文件/目录

### 4. 帮助系统
- 快速开始指南（3分钟上手）
- 常见问题 FAQ
- 智能提示系统
- 清晰的错误提示

## 🔧 改进

- 命名优化：更简洁直观
- 错误提示：说明原因和解决方案
- 跨设备支持：自动检测和修复

## 📦 安装

\`\`\`bash
# 从 VSIX 安装
Ctrl+Shift+P → Extensions: Install from VSIX
选择 kiro-knowledge-base-2.52.0.vsix
\`\`\`

## 🔄 从旧版本升级

1. 卸载旧版本
2. 安装 v2.52.0
3. 重新加载窗口
4. 按照首次设置向导操作（如果需要）
```

---

## 🧪 测试清单

### 新用户测试

- [ ] 全新安装，无任何配置
- [ ] 首次设置向导显示正确
- [ ] 自动检测知识库功能正常
- [ ] 手动选择路径功能正常
- [ ] 自动初始化目录结构
- [ ] 设置完成后可以正常使用

### 老用户测试

- [ ] 从 v2.51.0 升级
- [ ] 配置保留正确
- [ ] 所有功能正常工作
- [ ] 侧边栏显示正确

### 跨设备测试

- [ ] 路径无效时显示提示
- [ ] 重新选择路径功能正常
- [ ] 创建目录功能正常
- [ ] 配置同步正常

### 帮助系统测试

- [ ] 帮助菜单显示正确
- [ ] 快速开始指南内容完整
- [ ] FAQ 内容完整
- [ ] 智能提示显示正确
- [ ] 错误提示清晰

### 跨平台测试

- [ ] Kiro IDE (Windows)
- [ ] Kiro IDE (Mac)
- [ ] VSCode (Windows)
- [ ] VSCode (Mac)
- [ ] Trae (Windows)
- [ ] Trae (Mac)

---

## 📝 已知问题

### 待解决

1. 简化侧边栏与旧版本共存可能导致混淆
   - **解决方案**：v2.53.0 完全替换旧版本

2. 自动检测可能在某些特殊路径下失败
   - **解决方案**：提供手动选择选项

### 不影响使用

1. 首次设置向导在某些主题下样式可能不一致
   - **影响**：仅视觉效果，不影响功能

---

## 🎯 下一步计划

### v2.53.0 计划

1. 完全替换旧版侧边栏
2. 添加更多自动化功能
3. 优化性能
4. 添加更多帮助内容

### 长期计划

1. AI 辅助分类和标签
2. 知识图谱可视化
3. 跨项目知识关联
4. 团队协作功能

---

## 📞 反馈

如有问题或建议，请访问：
- GitHub Issues: https://github.com/DangDangMao01/Kiro_work/issues
- Email: dangdangshijie@gmail.com

---

*感谢使用 Kiro Knowledge Base！*
