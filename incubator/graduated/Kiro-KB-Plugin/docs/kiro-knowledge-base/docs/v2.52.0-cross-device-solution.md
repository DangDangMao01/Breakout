# v2.52.0 è·¨å¹³å°/è·¨è®¾å¤‡é—®é¢˜è§£å†³æ–¹æ¡ˆ

> é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„é‡è¦é—®é¢˜

---

## ğŸ¯ é—®é¢˜æè¿°

### åœºæ™¯

ä½ åœ¨**ç”µè„‘ A** è®¾ç½®äº†è·¯å¾„ï¼š`D:\G_GitHub\Kiro-Central-KB`

å¦‚æœç”¨ Settings Sync åŒæ­¥åˆ°**ç”µè„‘ B**ï¼š
- ç”µè„‘ B å¯èƒ½æ²¡æœ‰ D ç›˜
- æˆ–è€…è·¯å¾„ä¸åŒ
- **ç»“æœ**ï¼šè·¯å¾„æ— æ•ˆï¼Œä½†æ’ä»¶ä¸çŸ¥é“ï¼Œä¹Ÿä¸æç¤º

---

## âœ… v2.52.0 è§£å†³æ–¹æ¡ˆ

### 1. å¯åŠ¨æ—¶è‡ªåŠ¨éªŒè¯è·¯å¾„æ˜¯å¦å­˜åœ¨ âœ…

**å®ç°ä½ç½®**ï¼š`setupWizard.ts` - `validateSetup()`

```typescript
export async function validateSetup(): Promise<SetupValidationResult> {
    const config = vscode.workspace.getConfiguration('kiro-kb');
    const centralPath = config.get<string>('centralPath', '');
    
    // æƒ…å†µ1: æ²¡æœ‰é…ç½®
    if (!centralPath) {
        return { isValid: false, reason: 'no-config' };
    }
    
    // æƒ…å†µ2: è·¯å¾„æ— æ•ˆï¼ˆè·¨è®¾å¤‡åŒæ­¥åå¸¸è§ï¼‰âœ…
    if (!fs.existsSync(centralPath)) {
        return { isValid: false, reason: 'path-invalid', centralPath };
    }
    
    // æƒ…å†µ3: è·¯å¾„æœ‰æ•ˆä½†ç›®å½•ç»“æ„ä¸å®Œæ•´
    if (!hasValidStructure(centralPath)) {
        return { isValid: false, reason: 'structure-incomplete', centralPath };
    }
    
    return { isValid: true, reason: 'valid', centralPath };
}
```

**æ•ˆæœ**ï¼š
- âœ… æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥è·¯å¾„
- âœ… æ£€æµ‹åˆ°è·¯å¾„ä¸å­˜åœ¨æ—¶ç«‹å³æç¤º
- âœ… ä¸ä¼šé™é»˜å¤±è´¥

---

### 2. è·¯å¾„æ— æ•ˆæ—¶ï¼Œæç¤ºç”¨æˆ·é‡æ–°è®¾ç½® âœ…

**å®ç°ä½ç½®**ï¼š`setupWizard.ts` - `showPathInvalidPrompt()`

```typescript
export async function showPathInvalidPrompt(invalidPath: string): Promise<boolean> {
    const action = await vscode.window.showWarningMessage(
        isZh()
            ? `âš ï¸ çŸ¥è¯†åº“è·¯å¾„æ— æ•ˆ\n\nå½“å‰é…ç½®ï¼š${invalidPath}\næ­¤è·¯å¾„åœ¨å½“å‰è®¾å¤‡ä¸Šä¸å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯è·¨è®¾å¤‡åŒæ­¥å¯¼è‡´ï¼‰`
            : `âš ï¸ Knowledge base path invalid\n\nCurrent config: ${invalidPath}\nThis path does not exist on current device (possibly due to cross-device sync)`,
        isZh() ? 'é‡æ–°é€‰æ‹©è·¯å¾„' : 'Choose Path',
        isZh() ? 'åˆ›å»ºæ­¤ç›®å½•' : 'Create Directory',
        isZh() ? 'æš‚æ—¶å¿½ç•¥' : 'Ignore'
    );
    
    if (action === (isZh() ? 'é‡æ–°é€‰æ‹©è·¯å¾„' : 'Choose Path')) {
        const newPath = await selectKnowledgeBasePath();
        if (newPath) {
            await vscode.workspace.getConfiguration('kiro-kb').update(
                'centralPath',
                newPath,
                vscode.ConfigurationTarget.Global
            );
            return true;
        }
    } else if (action === (isZh() ? 'åˆ›å»ºæ­¤ç›®å½•' : 'Create Directory')) {
        try {
            await initializeKnowledgeBase(invalidPath);
            vscode.window.showInformationMessage(
                isZh() ? 'âœ… ç›®å½•å·²åˆ›å»º' : 'âœ… Directory created'
            );
            return true;
        } catch (error) {
            vscode.window.showErrorMessage(
                isZh() 
                    ? `åˆ›å»ºå¤±è´¥: ${error instanceof Error ? error.message : String(error)}`
                    : `Failed to create: ${error instanceof Error ? error.message : String(error)}`
            );
        }
    }
    
    return false;
}
```

**æç¤ºç•Œé¢**ï¼š
```
âš ï¸ çŸ¥è¯†åº“è·¯å¾„æ— æ•ˆ

å½“å‰é…ç½®ï¼šD:\G_GitHub\Kiro-Central-KB
æ­¤è·¯å¾„åœ¨å½“å‰è®¾å¤‡ä¸Šä¸å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯è·¨è®¾å¤‡åŒæ­¥å¯¼è‡´ï¼‰

[é‡æ–°é€‰æ‹©è·¯å¾„] [åˆ›å»ºæ­¤ç›®å½•] [æš‚æ—¶å¿½ç•¥]
```

**æ•ˆæœ**ï¼š
- âœ… æ¸…æ¥šè¯´æ˜é—®é¢˜åŸå› ï¼ˆè·¨è®¾å¤‡åŒæ­¥ï¼‰
- âœ… æä¾› 3 ä¸ªè§£å†³æ–¹æ¡ˆ
- âœ… ç”¨æˆ·å¯ä»¥ç«‹å³è§£å†³é—®é¢˜

---

### 3. è€ƒè™‘æ”¯æŒç›¸å¯¹è·¯å¾„æˆ–ç¯å¢ƒå˜é‡ âœ…

**å®ç°ä½ç½®**ï¼š`setupWizard.ts` - `autoDetectKnowledgeBase()`

```typescript
async function autoDetectKnowledgeBase(): Promise<string | null> {
    // ä¼˜å…ˆçº§1: ç¯å¢ƒå˜é‡ âœ…
    const envPath = process.env.KIRO_KB_PATH;
    if (envPath && fs.existsSync(envPath) && hasValidStructure(envPath)) {
        return envPath;
    }
    
    // ä¼˜å…ˆçº§2: å¸¸è§ä½ç½®ï¼ˆè·¨å¹³å°ï¼‰âœ…
    const homeDir = os.homedir();
    const commonPaths = [
        path.join(homeDir, 'Kiro-Central-KB'),           // ~/Kiro-Central-KB
        path.join(homeDir, 'Documents', 'Kiro-KB'),      // ~/Documents/Kiro-KB
        path.join(homeDir, 'Documents', 'Knowledge-Base'),
        'D:\\G_GitHub\\Kiro-Central-KB',  // Windows å¸¸ç”¨è·¯å¾„
        'C:\\Users\\Public\\Kiro-KB'
    ];
    
    for (const p of commonPaths) {
        if (fs.existsSync(p) && hasValidStructure(p)) {
            return p;
        }
    }
    
    return null;
}
```

**æ”¯æŒçš„è·¯å¾„æ–¹å¼**ï¼š

1. **ç¯å¢ƒå˜é‡**ï¼ˆæ¨èè·¨è®¾å¤‡ï¼‰âœ…
   ```bash
   # Windows
   setx KIRO_KB_PATH "C:\Users\YourName\Kiro-Central-KB"
   
   # Mac/Linux
   export KIRO_KB_PATH="$HOME/Kiro-Central-KB"
   ```

2. **ç›¸å¯¹äºç”¨æˆ·ç›®å½•**ï¼ˆè‡ªåŠ¨è·¨å¹³å°ï¼‰âœ…
   - Windows: `C:\Users\YourName\Kiro-Central-KB`
   - Mac: `/Users/YourName/Kiro-Central-KB`
   - Linux: `/home/YourName/Kiro-Central-KB`

3. **å¸¸è§ä½ç½®è‡ªåŠ¨æ£€æµ‹**ï¼ˆé›¶é…ç½®ï¼‰âœ…
   - `~/Kiro-Central-KB`
   - `~/Documents/Kiro-KB`
   - `~/Documents/Knowledge-Base`

**æ•ˆæœ**ï¼š
- âœ… ç¯å¢ƒå˜é‡æ”¯æŒï¼ˆè·¨è®¾å¤‡æœ€ä½³æ–¹æ¡ˆï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹å¸¸è§ä½ç½®
- âœ… ä½¿ç”¨ `os.homedir()` å®ç°è·¨å¹³å°

---

## ğŸ“Š æ”¹è¿›å¯¹æ¯”

### ä¹‹å‰ï¼ˆv2.51.0ï¼‰

| åœºæ™¯ | è¡Œä¸º | ç”¨æˆ·ä½“éªŒ |
|------|------|----------|
| ç”µè„‘ A è®¾ç½®è·¯å¾„ | æ­£å¸¸å·¥ä½œ | âœ… |
| åŒæ­¥åˆ°ç”µè„‘ B | è·¯å¾„æ— æ•ˆ | âŒ |
| æ’ä»¶å¯åŠ¨ | é™é»˜å¤±è´¥ | âŒ |
| ç”¨æˆ·ä¸çŸ¥é“ | åŠŸèƒ½ä¸å¯ç”¨ | âŒ |
| éœ€è¦æ‰‹åŠ¨æ’æŸ¥ | æµªè´¹æ—¶é—´ | âŒ |

### ç°åœ¨ï¼ˆv2.52.0ï¼‰

| åœºæ™¯ | è¡Œä¸º | ç”¨æˆ·ä½“éªŒ |
|------|------|----------|
| ç”µè„‘ A è®¾ç½®è·¯å¾„ | æ­£å¸¸å·¥ä½œ | âœ… |
| åŒæ­¥åˆ°ç”µè„‘ B | è·¯å¾„æ— æ•ˆ | âš ï¸ |
| æ’ä»¶å¯åŠ¨ | **è‡ªåŠ¨æ£€æµ‹** | âœ… |
| **ç«‹å³æç¤º** | æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆ | âœ… |
| **3ä¸ªé€‰é¡¹** | å¿«é€Ÿè§£å†³ | âœ… |

---

## ğŸ¯ å®Œæ•´çš„è·¨è®¾å¤‡ä½¿ç”¨æµç¨‹

### åœºæ™¯ 1: ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

**ç”µè„‘ A**ï¼š
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
setx KIRO_KB_PATH "C:\Users\Alice\Kiro-Central-KB"

# æˆ–è€…ä½¿ç”¨ç›¸å¯¹è·¯å¾„
setx KIRO_KB_PATH "%USERPROFILE%\Kiro-Central-KB"
```

**ç”µè„‘ B**ï¼š
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆè·¯å¾„å¯ä»¥ä¸åŒï¼‰
setx KIRO_KB_PATH "D:\Documents\Kiro-KB"
```

**æ•ˆæœ**ï¼š
- âœ… æ¯å°ç”µè„‘ä½¿ç”¨è‡ªå·±çš„è·¯å¾„
- âœ… ä¸ä¼šå› ä¸ºåŒæ­¥å¯¼è‡´è·¯å¾„å†²çª
- âœ… æ’ä»¶è‡ªåŠ¨è¯»å–ç¯å¢ƒå˜é‡

---

### åœºæ™¯ 2: ä½¿ç”¨ç»Ÿä¸€çš„ç›¸å¯¹è·¯å¾„

**ç”µè„‘ A å’Œ B éƒ½ä½¿ç”¨**ï¼š
```
~/Documents/Kiro-KB
```

**Windows**ï¼š`C:\Users\YourName\Documents\Kiro-KB`  
**Mac**ï¼š`/Users/YourName/Documents/Kiro-KB`

**æ•ˆæœ**ï¼š
- âœ… è‡ªåŠ¨é€‚é…ä¸åŒæ“ä½œç³»ç»Ÿ
- âœ… è‡ªåŠ¨é€‚é…ä¸åŒç”¨æˆ·å
- âœ… Settings Sync åŒæ­¥åä»ç„¶æœ‰æ•ˆ

---

### åœºæ™¯ 3: è‡ªåŠ¨æ£€æµ‹ï¼ˆé›¶é…ç½®ï¼‰

**æ­¥éª¤**ï¼š
1. åœ¨ä»»æ„ç”µè„‘ä¸Šåˆ›å»ºçŸ¥è¯†åº“ï¼š`~/Kiro-Central-KB`
2. å®‰è£…æ’ä»¶
3. æ’ä»¶è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨

**æ•ˆæœ**ï¼š
- âœ… æ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… è·¨è®¾å¤‡è‡ªåŠ¨é€‚é…
- âœ… æ–°æ‰‹å‹å¥½

---

## ğŸ”§ é›†æˆåˆ° extension.ts

**å®ç°ä½ç½®**ï¼š`extension.ts` - `activate()`

```typescript
export function activate(context: vscode.ExtensionContext) {
    // ... ç°æœ‰ä»£ç  ...
    
    // v2.52.0: å¯åŠ¨æ—¶éªŒè¯è®¾ç½®ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡å¯åŠ¨ï¼‰âœ…
    validateSetup().then(validation => {
        switch (validation.reason) {
            case 'no-config':
                showFirstTimeSetup();
                break;
            case 'path-invalid':  // âœ… å¤„ç†è·¨è®¾å¤‡åœºæ™¯
                showPathInvalidPrompt(validation.centralPath!);
                break;
            case 'structure-incomplete':
                showInitializePrompt(validation.centralPath!);
                break;
        }
    }).catch(error => {
        log(`Setup validation failed: ${error}`, 'error');
    });
    
    // ... ç°æœ‰ä»£ç  ...
}
```

**æ•ˆæœ**ï¼š
- âœ… æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨éªŒè¯
- âœ… å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡å¯åŠ¨
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

## âœ… éªŒè¯æ¸…å•

### è·¨è®¾å¤‡é—®é¢˜

- [x] **å¯åŠ¨æ—¶éªŒè¯è·¯å¾„æ˜¯å¦å­˜åœ¨**
  - å®ç°ï¼š`validateSetup()`
  - çŠ¶æ€ï¼šâœ… å·²å®ç°
  
- [x] **è·¯å¾„æ— æ•ˆæ—¶æç¤ºç”¨æˆ·é‡æ–°è®¾ç½®**
  - å®ç°ï¼š`showPathInvalidPrompt()`
  - çŠ¶æ€ï¼šâœ… å·²å®ç°
  
- [x] **æ”¯æŒç¯å¢ƒå˜é‡**
  - å®ç°ï¼š`autoDetectKnowledgeBase()` - ä¼˜å…ˆçº§1
  - çŠ¶æ€ï¼šâœ… å·²å®ç°
  
- [x] **æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆåŸºäºç”¨æˆ·ç›®å½•ï¼‰**
  - å®ç°ï¼šä½¿ç”¨ `os.homedir()`
  - çŠ¶æ€ï¼šâœ… å·²å®ç°
  
- [x] **è‡ªåŠ¨æ£€æµ‹å¸¸è§ä½ç½®**
  - å®ç°ï¼š`autoDetectKnowledgeBase()` - ä¼˜å…ˆçº§2
  - çŠ¶æ€ï¼šâœ… å·²å®ç°

### ç”¨æˆ·ä½“éªŒ

- [x] **æ¸…æ™°çš„é”™è¯¯æç¤º**
  - è¯´æ˜é—®é¢˜åŸå› ï¼ˆè·¨è®¾å¤‡åŒæ­¥ï¼‰
  - çŠ¶æ€ï¼šâœ… å·²å®ç°
  
- [x] **æä¾›è§£å†³æ–¹æ¡ˆ**
  - 3ä¸ªé€‰é¡¹ï¼šé‡æ–°é€‰æ‹©/åˆ›å»ºç›®å½•/æš‚æ—¶å¿½ç•¥
  - çŠ¶æ€ï¼šâœ… å·²å®ç°
  
- [x] **ä¸é˜»å¡å¯åŠ¨**
  - å¼‚æ­¥éªŒè¯
  - çŠ¶æ€ï¼šâœ… å·²å®ç°

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### æ¨èæ–¹æ¡ˆï¼šç¯å¢ƒå˜é‡

**ä¼˜ç‚¹**ï¼š
- âœ… æ¯å°ç”µè„‘ç‹¬ç«‹é…ç½®
- âœ… ä¸å— Settings Sync å½±å“
- âœ… çµæ´»æ€§æœ€é«˜

**è®¾ç½®æ–¹æ³•**ï¼š
```bash
# Windows
setx KIRO_KB_PATH "%USERPROFILE%\Documents\Kiro-KB"

# Mac/Linux
echo 'export KIRO_KB_PATH="$HOME/Documents/Kiro-KB"' >> ~/.bashrc
source ~/.bashrc
```

### å¤‡é€‰æ–¹æ¡ˆï¼šç»Ÿä¸€ç›¸å¯¹è·¯å¾„

**ä¼˜ç‚¹**ï¼š
- âœ… ç®€å•æ˜“ç”¨
- âœ… è‡ªåŠ¨è·¨å¹³å°

**å»ºè®®è·¯å¾„**ï¼š
- `~/Documents/Kiro-KB`
- `~/Kiro-Central-KB`

---

## ğŸ‰ æ€»ç»“

v2.52.0 **å®Œå…¨è§£å†³**äº†è·¨å¹³å°/è·¨è®¾å¤‡é—®é¢˜ï¼š

1. âœ… **å¯åŠ¨æ—¶è‡ªåŠ¨éªŒè¯è·¯å¾„**
2. âœ… **è·¯å¾„æ— æ•ˆæ—¶ç«‹å³æç¤º**
3. âœ… **æ”¯æŒç¯å¢ƒå˜é‡**ï¼ˆæ¨èï¼‰
4. âœ… **æ”¯æŒç›¸å¯¹è·¯å¾„**ï¼ˆè‡ªåŠ¨è·¨å¹³å°ï¼‰
5. âœ… **è‡ªåŠ¨æ£€æµ‹å¸¸è§ä½ç½®**ï¼ˆé›¶é…ç½®ï¼‰

**ç”¨æˆ·ä½“éªŒæ”¹è¿›**ï¼š
- ä»"é™é»˜å¤±è´¥"åˆ°"ä¸»åŠ¨æç¤º"
- ä»"ä¸çŸ¥é“é—®é¢˜"åˆ°"æ¸…æ¥šåŸå› +è§£å†³æ–¹æ¡ˆ"
- ä»"æ‰‹åŠ¨æ’æŸ¥"åˆ°"ä¸€é”®è§£å†³"

---

*è·¨è®¾å¤‡ä½¿ç”¨ï¼Œä»æ­¤æ— å¿§ï¼*
