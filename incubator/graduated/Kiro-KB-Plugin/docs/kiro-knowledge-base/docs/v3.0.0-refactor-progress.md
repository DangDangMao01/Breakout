# v3.0.0 重构进度

> 2026-01-13 开始

## ✅ 已完成

### Phase 1: 备份和准备
- ✅ Git 备份（commit + tag: v2.53.0-before-refactor）
- ✅ 创建模块化目录结构
  - `src/commands/`
  - `src/core/`
  - `src/features/`
  - `src/utils/`
  - `src/panels/`

### Phase 2: 重新设计侧边栏
- ✅ 创建 `panels/knowledgePanel.ts`（约 400 行）
  - 支持所有功能的树形结构
  - 操作节点（搜索、快速保存）
  - 浏览节点（分类、领域、最近）
  - 管理节点（标签、同步）
  - 工具节点（质量评估、图谱、对话整理）
  - 设置和帮助节点

- ✅ 创建 `extension.v3.ts`（约 200 行）
  - 精简的主入口
  - 只做模块注册和初始化
  - 所有命令都注册，但功能标记为 TODO

### Phase 3: 更新 package.json
- ✅ 创建 `package.v3.json`（精简版配置）
- ✅ 精简命令列表（40+ → 21个）
  - 6个核心命令（搜索、快速保存、生成索引、同步、设置、日志）
  - 15个辅助命令（标签管理、Git、工具等）
- ✅ 精简配置项（只保留3个核心配置）
  - centralPath - 知识库路径
  - language - 界面语言
  - autoSync - 自动同步

## 🔄 进行中

无

## ⏳ 待完成

### Phase 4: 实现核心功能
- [ ] 搜索功能（commands/search.ts）
- [ ] 快速保存功能（commands/save.ts）
- [ ] 同步功能（commands/sync.ts）
- [ ] 标签管理（features/tags.ts）
- [ ] 工具功能（features/tools.ts）

### Phase 5: 测试和验证
- [ ] 编译测试
- [ ] 功能测试
- [ ] 打包测试
- [ ] 更新文档

## 📝 设计决策

### 为什么创建 extension.v3.ts 而不是直接修改 extension.ts？
- 旧的 extension.ts 有 11,308 行，太复杂
- 先创建新版本，测试通过后再替换
- 保留旧版本作为参考（extension.ts.v2.53.0.backup）

### 侧边栏设计原则
- 所有功能通过侧边栏访问
- 减少命令面板的命令数量
- 用户不需要记命令，点击即可

### 模块化原则
- 每个模块独立（100-200 行）
- 职责清晰，易于测试
- extension.ts 只做注册（200 行以内）

## 🎯 下一步

1. 更新 package.json（精简命令）
2. 实现核心功能模块
3. 编译测试
4. 功能测试

## ⏱️ 预计时间

- 已用时间：1 小时
- 剩余时间：3-4 小时
- 总计：4-5 小时
