# v2.52.0 用户体验优化计划

> 目标：让插件**好用**，不管是新用户还是老用户

---

## 📋 问题清单

### 1. 首次使用体验差
- [ ] 新用户安装后不知道要做什么
- [ ] 没有引导流程
- [ ] 需要手动设置路径，不知道设置什么

### 2. 路径配置问题
- [ ] 跨设备同步后路径可能无效
- [ ] 路径无效时没有提示
- [ ] 卸载重装后配置还在，不触发引导

### 3. 侧边栏混乱
- [ ] 层级太深，找不到想要的功能
- [ ] 功能太多，不知道从哪开始
- [ ] "当前项目"没有本地知识库时，显示内容少
- [ ] "对话整理"在非 Kiro IDE 上无用但还显示

### 4. 命名不清晰
- [ ] "整理知识库"是什么意思？
- [ ] "搜索建议"和"全局搜索"区别？
- [ ] "知识库文档"和"按项目浏览"重复？

### 5. 缺失功能
- [ ] 没有使用教程/帮助入口
- [ ] 没有"重置插件配置"命令
- [ ] 没有快速保存选中文本的功能

---

## 🎯 优化方案

> **核心原则**：
> 1. **首次使用引导** - 启动时验证路径，无效就引导设置
> 2. **侧边栏简化** - 减少层级，最常用的放前面
> 3. **自动化配置** - 能自动的就自动，减少手动操作
> 4. **命名优化** - 让用户一看就懂
> 5. **帮助系统** - 不懂的时候有地方找答案

### Phase 1: 首次使用引导（优先级：高）✅ 已实现

#### 1.1 启动时路径验证 ✅
```typescript
// 启动时检查 - 已实现于 setupWizard.ts
export async function validateSetup(): Promise<SetupValidationResult> {
    const config = vscode.workspace.getConfiguration('kiro-kb');
    const centralPath = config.get<string>('centralPath', '');
    
    // 情况1: 没有配置
    if (!centralPath) {
        return { isValid: false, reason: 'no-config' };
    }
    
    // 情况2: 路径无效（跨设备同步后常见）
    if (!fs.existsSync(centralPath)) {
        return { isValid: false, reason: 'path-invalid', centralPath };
    }
    
    // 情况3: 路径有效但目录结构不完整
    if (!hasValidStructure(centralPath)) {
        return { isValid: false, reason: 'structure-incomplete', centralPath };
    }
    
    return { isValid: true, reason: 'valid', centralPath };
}
```

#### 1.2 首次设置向导（3步完成）✅ 已实现
**Step 1: 欢迎界面** ✅
```typescript
// 已实现于 setupWizard.ts
const action = await vscode.window.showInformationMessage(
    '🎉 欢迎使用 Kiro Knowledge Base！\n\n这个插件帮你管理技术笔记和解决方案。',
    '开始设置',
    '查看教程'
);
```

**Step 2: 选择知识库位置** ✅
- ✅ 自动检测常见位置（`~/Kiro-Central-KB`、`~/Documents/Kiro-KB`、`D:\G_GitHub\Kiro-Central-KB`）
- ✅ 检测到时显示"检测到知识库：xxx，是否使用？"
- ✅ 未检测到时提供"选择文件夹"对话框
- ✅ 支持环境变量 `KIRO_KB_PATH` 优先级最高

**Step 3: 自动初始化** ✅
- ✅ 创建目录结构（solutions/、notes/、discussions/、backlog/）
- ✅ 生成 INDEX.md 和 README.md（带完整内容模板）
- ✅ 生成 .gitignore 文件
- ✅ 显示成功提示："✅ 设置完成！现在可以开始保存知识了\n\n💡 提示：使用 Ctrl+Alt+Q 快速保存想法"

#### 1.3 路径无效提示（跨设备场景）✅ 已实现
```typescript
// 已实现于 setupWizard.ts
export async function showPathInvalidPrompt(invalidPath: string): Promise<boolean> {
    const action = await vscode.window.showWarningMessage(
        `⚠️ 知识库路径无效\n\n当前配置：${invalidPath}\n此路径在当前设备上不存在（可能是跨设备同步导致）`,
        '重新选择路径',
        '创建此目录',
        '暂时忽略'
    );
    // ... 处理用户选择
}
```

**功能完整性**：
- ✅ 重新选择路径：打开文件夹选择对话框
- ✅ 创建此目录：调用 `initializeKnowledgeBase()` 创建完整结构
- ✅ 暂时忽略：关闭对话框，不做任何操作

### Phase 2: 侧边栏简化（优先级：高）

#### 2.1 简化层级结构 - 减少点击次数

**当前结构**（层级太深，4-5次点击）：
```
📁 当前项目: xxx
  🔍 项目内搜索
  🔧 整理知识库
☁️ 中央知识库 (83)
  🔍 全局搜索
  💡 搜索建议
  📊 搜索统计
  🔥 热门知识
  📁 按项目浏览
🕐 最近更新
🏷️ 标签 (159)
⚙️ 设置
```

**优化后结构**（扁平化，1-2次点击）：
```
🔍 搜索              ← 最常用功能，直接点击搜索
📚 浏览 (83)         ← 默认展开，直接看到分类
  ✅ 问题解决 (52)
  💬 技术探讨 (17)
  📒 学习笔记 (32)
🕐 最近 (10)         ← 快速访问最近文档
🏷️ 标签             ← 默认折叠，需要时展开
❓ 帮助              ← 新增：使用指南入口
⚙️ 设置              ← 最后
```

**改进点**：
- ✅ 去掉"中央知识库"层级，直接显示内容
- ✅ 去掉"当前项目"层级（没有本地 KB 时无意义）
- ✅ 合并重复功能（"全局搜索"和"项目内搜索" → "搜索"）
- ✅ 简化命名（"知识库文档" → "浏览"）
- ✅ 最常用的放最前面（搜索 > 浏览 > 最近）

#### 2.2 智能显示 - 根据场景自动调整
```typescript
// 场景1: Kiro IDE + 有本地 KB
显示：搜索（本项目+全局）、浏览、最近、标签、对话整理

// 场景2: Kiro IDE + 无本地 KB
显示：搜索（仅全局）、浏览、最近、标签、对话整理

// 场景3: VSCode/Trae + 有本地 KB
显示：搜索（本项目+全局）、浏览、最近、标签
隐藏：对话整理（不支持）

// 场景4: VSCode/Trae + 无本地 KB
显示：搜索（仅全局）、浏览、最近、标签
隐藏：对话整理（不支持）

// 场景5: 未配置知识库
显示：欢迎引导界面
```

#### 2.3 空状态优化
```
📚 浏览 (0)
  
  还没有保存任何知识

  [保存当前对话] [查看使用教程]
```

### Phase 3: 自动化配置（优先级：中）

#### 3.1 自动检测知识库 - 零配置启动
```typescript
async function autoDetectKnowledgeBase(): Promise<string | null> {
    // 优先级1: 环境变量
    const envPath = process.env.KIRO_KB_PATH;
    if (envPath && fs.existsSync(envPath)) {
        return envPath;
    }
    
    // 优先级2: 常见位置
    const commonPaths = [
        path.join(os.homedir(), 'Kiro-Central-KB'),
        path.join(os.homedir(), 'Documents', 'Kiro-KB'),
        path.join(os.homedir(), 'Documents', 'Knowledge-Base'),
        'D:\\G_GitHub\\Kiro-Central-KB',  // 用户常用路径
    ];
    
    for (const p of commonPaths) {
        if (fs.existsSync(p) && hasValidStructure(p)) {
            return p;
        }
    }
    
    return null;
}
```

**用户体验**：
- 首次启动 → 自动检测 → 找到了 → 直接使用（0配置）
- 首次启动 → 自动检测 → 没找到 → 引导创建（1次配置）

#### 3.2 一键初始化 - 自动创建完整结构
```typescript
async function initializeKnowledgeBase(basePath: string) {
    // 创建目录
    const dirs = ['solutions', 'notes', 'discussions', 'backlog'];
    for (const dir of dirs) {
        await fs.mkdir(path.join(basePath, dir), { recursive: true });
    }
    
    // 生成 README.md
    await fs.writeFile(
        path.join(basePath, 'README.md'),
        generateReadmeContent()
    );
    
    // 生成 INDEX.md
    await fs.writeFile(
        path.join(basePath, 'INDEX.md'),
        generateIndexContent()
    );
    
    // 生成 .gitignore（可选）
    await fs.writeFile(
        path.join(basePath, '.gitignore'),
        '*.tmp\n.DS_Store\n'
    );
}
```

#### 3.3 智能重置 - 出问题时快速恢复
**命令**：`Kiro KB: 重置插件配置`

**功能**：
- 清除所有配置（路径、缓存、历史记录）
- 清除 Webview 状态
- 重新触发首次引导
- 不删除知识库文件（安全）

**使用场景**：
- 跨设备同步后路径混乱
- 插件行为异常
- 想重新配置

#### 3.4 自动修复 - 减少手动干预
```typescript
// 检测到问题时自动尝试修复
async function autoFix() {
    // 问题1: INDEX.md 不存在 → 自动生成
    if (!fs.existsSync(indexPath)) {
        await generateIndex();
        showInfo('已自动生成索引文件');
    }
    
    // 问题2: 目录结构不完整 → 自动补全
    const missingDirs = checkMissingDirs();
    if (missingDirs.length > 0) {
        await createMissingDirs(missingDirs);
        showInfo(`已自动创建缺失目录: ${missingDirs.join(', ')}`);
    }
}
```

### Phase 4: 命名优化（优先级：中）

#### 4.1 命名原则
- ✅ **简洁**：用最少的字表达清楚
- ✅ **直观**：一看就懂，不需要解释
- ✅ **一致**：同类功能用相同的命名模式
- ✅ **动词优先**：功能用动词开头（搜索、浏览、保存）

#### 4.2 命名对照表

| 位置 | 原名称 | 新名称 | 改进理由 |
|------|--------|--------|----------|
| 侧边栏 | 中央知识库 | （去掉层级） | 减少层级，直接显示内容 |
| 侧边栏 | 知识库文档 | 浏览 | 更简洁，动词优先 |
| 侧边栏 | 最近更新 | 最近 | 更简洁 |
| 侧边栏 | 全局搜索 | 搜索 | 更简洁（上下文已明确） |
| 侧边栏 | 项目内搜索 | 搜索本项目 | 更清晰 |
| 侧边栏 | 整理知识库 | 检查问题 | 更直观（实际功能是检查重复/错误） |
| 侧边栏 | 搜索建议 | 最近搜索 | 更准确（实际是历史记录） |
| 命令 | 保存对话到知识库 | 保存对话 | 更简洁（上下文已明确） |
| 命令 | 插入知识库链接 | 插入链接 | 更简洁 |
| 分类 | solutions | 问题解决 | 中文更友好 |
| 分类 | discussions | 技术探讨 | 中文更友好 |
| 分类 | notes | 学习笔记 | 中文更友好 |

#### 4.3 Tooltip 优化 - 补充说明

| 功能 | Tooltip |
|------|---------|
| 搜索 | 在知识库中搜索内容 |
| 浏览 | 按分类浏览所有文档 |
| 最近 | 最近更新的文档 |
| 标签 | 按标签筛选文档 |
| 检查问题 | 检查重复内容和文件错误 |
| 帮助 | 查看使用教程和常见问题 |

### Phase 5: 帮助系统（优先级：中）✅ 已实现

#### 5.1 多层次帮助入口 - 不懂的时候有地方找答案 ✅

**实现状态**：✅ 已完成（helpSystem.ts）

**层次1: 侧边栏帮助节点** ✅
```
❓ 帮助
  📖 快速开始
  💡 常见问题
  🎬 视频教程
  🐛 报告问题
  📚 完整文档
```

**实现细节**：
- `HelpSystem.showHelpMenu()` - 显示帮助菜单
- 5 个帮助选项，通过 QuickPick 选择
- 支持打开 Webview 面板或外部链接

**层次2: 上下文帮助** ⏳ 待实现
- 每个功能旁边添加 `(?)` 图标
- 鼠标悬停显示简短说明
- 点击打开详细帮助

**层次3: 空状态引导** ⏳ 待实现
```
📚 浏览 (0)
  
  还没有保存任何知识
  
  💡 提示：
  - 在 Kiro 对话后，点击"保存对话"
  - 或使用命令面板搜索"Kiro KB"
  
  [查看完整教程]
```

#### 5.2 智能提示系统 - 首次使用引导 ✅

**实现状态**：✅ 已完成（helpSystem.ts）

**核心功能**：
- `HelpSystem.showTipOnce(tipId, message)` - 显示一次性提示
- 支持的提示 ID：
  - `first-save` - 首次保存提示
  - `first-search` - 首次搜索提示
  - `first-browse` - 首次浏览提示
  - `first-tag` - 首次使用标签提示
  - `cross-device` - 跨设备使用提示
- 提示状态持久化存储（globalState）
- 用户可选择"不再提示"

**实现代码**：
```typescript
export class HelpSystem {
    private shownTips: Set<string> = new Set();
    
    async showTipOnce(tipId: TipId, message: string): Promise<void> {
        if (this.shownTips.has(tipId)) return;
        
        const result = await vscode.window.showInformationMessage(
            `💡 ${message}`,
            isZh() ? '知道了' : 'Got it',
            isZh() ? '不再提示' : 'Don\'t show again'
        );
        
        if (result === (isZh() ? '不再提示' : 'Don\'t show again')) {
            this.shownTips.add(tipId);
            await this.saveShownTips();
        }
    }
}
```

#### 5.3 快速开始指南 - 3分钟上手 ✅

**实现状态**：✅ 已完成（helpSystem.ts）

**功能**：
- `HelpSystem.showQuickStart()` - 显示快速开始指南
- Webview 面板展示
- 支持中英文
- 包含 3 个核心步骤（保存/搜索/浏览）
- 进阶技巧和帮助链接

**内容结构**：
```markdown
# Kiro Knowledge Base 快速开始

## 1️⃣ 保存知识（30秒）
在 Kiro 对话后 → 点击"保存对话" → 选择分类 → 完成
快捷键：Ctrl+Alt+Q 快速保存想法

## 2️⃣ 搜索知识（30秒）
侧边栏点击 🔍 搜索 → 输入关键词 → 点击结果打开
快捷键：Ctrl+Alt+F 全局搜索

## 3️⃣ 浏览知识（30秒）
侧边栏 📚 浏览 → 选择分类 → 查看文档列表
- ✅ 问题解决：Bug 修复、功能实现
- 💬 技术探讨：架构设计、方案对比
- 📒 学习笔记：概念学习、最佳实践

## 💡 进阶技巧
- 使用标签快速筛选：#unity #shader
- 查看最近更新：侧边栏 🕐 最近
- 插入链接到代码：右键文件 → 插入链接
- 跨设备同步：使用 Git 或云盘同步知识库文件夹
```

#### 5.4 常见问题 FAQ ✅

**实现状态**：✅ 已完成（helpSystem.ts）

**功能**：
- `HelpSystem.showFAQ()` - 显示常见问题
- Webview 面板展示
- 支持中英文
- 7 个常见问题及解答

**FAQ 内容**：

**Q1: 跨设备使用时路径无效怎么办？**
A: 插件会自动检测并提示重新设置路径。你也可以：
- 使用命令面板：`Kiro KB: 重置插件配置`
- 或者手动设置：侧边栏 → ⚙️ 设置 → 选择知识库路径

**Q2: 如何备份知识库？**
A: 知识库就是普通文件夹，可以：
- 直接复制整个文件夹
- 使用 Git 进行版本控制（推荐）
- 使用云盘同步（OneDrive、Dropbox 等）

**Q3: 支持哪些 IDE？**
A: 支持以下 IDE：
- **Kiro IDE**：完整功能（包括对话整理）
- **VSCode**：除对话整理外的所有功能
- **Trae**：除对话整理外的所有功能

**Q4: 如何导出知识库？**
A: 所有文件都是 Markdown 格式，可以：
- 用任何 Markdown 编辑器打开
- 使用 Pandoc 转换为 PDF、Word 等格式
- 直接在 GitHub 上查看（如果使用 Git）

**Q5: 知识库文件夹可以改名吗？**
A: 可以，但需要注意：
- 改名后需要重新设置路径
- 核心文件夹（solutions/notes/discussions）不建议改名
- 如果使用 Git，记得更新 .gitignore

**Q6: 如何删除不需要的知识？**
A: 在侧边栏右键文件 → 删除，或者直接在文件系统中删除 .md 文件

**Q7: 插件占用空间大吗？**
A: 插件本身很小（< 1MB），知识库大小取决于你保存的内容。一般情况下：
- 100 篇文档 ≈ 1-5 MB
- 1000 篇文档 ≈ 10-50 MB

#### 5.5 错误提示优化 - 清晰的错误信息 ✅

**实现状态**：✅ 已完成（helpSystem.ts）

**功能**：
- `showErrorWithSolution()` - 显示优化的错误提示
- 包含错误描述、可能原因、解决方案
- 支持中英文

**原则**：
- ✅ 说明发生了什么
- ✅ 说明为什么发生
- ✅ 提供解决方案

**实现代码**：
```typescript
export async function showErrorWithSolution(
    error: string,
    possibleCauses: string[],
    solutions: Array<{ label: string; action: () => Promise<void> }>
): Promise<void> {
    const message = isZh()
        ? `❌ ${error}\n\n可能原因：\n${possibleCauses.map(c => `• ${c}`).join('\n')}`
        : `❌ ${error}\n\nPossible causes:\n${possibleCauses.map(c => `• ${c}`).join('\n')}`;
    
    const actions = solutions.map(s => s.label);
    const selected = await vscode.window.showErrorMessage(message, ...actions);
    
    if (selected) {
        const solution = solutions.find(s => s.label === selected);
        if (solution) {
            await solution.action();
        }
    }
}
```

**使用示例**：
```typescript
await showErrorWithSolution(
    '保存失败：知识库路径不存在',
    [
        '路径配置错误',
        '磁盘空间不足',
        '没有写入权限'
    ],
    [
        { label: '重新设置路径', action: async () => { /* ... */ } },
        { label: '检查磁盘空间', action: async () => { /* ... */ } },
        { label: '查看帮助', action: async () => { /* ... */ } }
    ]
);
```

---

## 📅 实施计划

### Week 1: 核心体验优化（Phase 1 + Phase 2）
**目标**：让新用户能快速上手，老用户操作更流畅

- [ ] **Day 1-2**: 启动时路径验证逻辑
  - 实现 `validateSetup()` 函数
  - 处理3种场景（无配置/路径无效/结构不完整）
  
- [ ] **Day 3-4**: 首次设置向导
  - 欢迎界面 UI
  - 自动检测知识库位置
  - 一键初始化功能
  
- [ ] **Day 5-6**: 侧边栏重构
  - 简化层级结构
  - 实现智能显示逻辑
  - 空状态优化
  
- [ ] **Day 7**: 测试验证
  - 新用户首次安装测试
  - 跨设备场景测试
  - 不同 IDE 兼容性测试

### Week 2: 自动化与命名优化（Phase 3 + Phase 4）
**目标**：减少手动配置，提升理解度

- [ ] **Day 1-2**: 自动化配置
  - 自动检测知识库（环境变量 + 常见路径）
  - 自动修复功能（缺失目录/索引文件）
  
- [ ] **Day 3-4**: 重置与恢复
  - 实现"重置插件配置"命令
  - 保证数据安全（不删除知识库文件）
  
- [ ] **Day 5-6**: 命名优化
  - 更新所有 UI 文本
  - 添加 Tooltip
  - 更新命令名称
  
- [ ] **Day 7**: 测试验证
  - 自动检测准确性测试
  - 重置功能安全性测试
  - 命名清晰度用户测试

### Week 3: 帮助系统与发布（Phase 5 + 测试）
**目标**：完善帮助文档，确保质量

- [ ] **Day 1-2**: 帮助系统
  - 创建快速开始指南
  - 编写常见问题 FAQ
  - 实现智能提示系统
  
- [ ] **Day 3-4**: 全面测试
  - 新用户完整流程测试
  - 老用户升级测试
  - 跨平台兼容性测试
  - 性能测试
  
- [ ] **Day 5-6**: 文档更新
  - 更新 README.md
  - 编写 RELEASE-NOTES-v2.52.0.md
  - 更新使用教程
  
- [ ] **Day 7**: 发布准备
  - 打包 VSIX
  - 发布说明
  - 用户通知

---

## ✅ 验收标准

### 1. 新用户体验（核心指标）

| 指标 | 目标 | 验证方法 |
|------|------|----------|
| 首次安装到开始使用 | ≤ 60秒 | 计时测试 |
| 无需阅读文档即可使用 | 100% | 5人盲测 |
| 首次保存成功率 | ≥ 95% | 10人测试 |
| 错误提示理解度 | ≥ 90% | 用户反馈 |

**测试场景**：
- [ ] 全新安装，无任何配置
- [ ] 自动检测到知识库
- [ ] 手动选择知识库位置
- [ ] 创建新知识库

### 2. 老用户体验（兼容性）

| 指标 | 目标 | 验证方法 |
|------|------|----------|
| 升级后配置保留 | 100% | 升级测试 |
| 常用功能点击次数 | ≤ 2次 | 操作路径分析 |
| 侧边栏层级深度 | ≤ 3层 | UI 检查 |
| 功能迁移无感知 | 100% | 用户反馈 |

**测试场景**：
- [ ] 从 v2.51.0 升级
- [ ] 跨设备同步后使用
- [ ] 常用操作流程（搜索/浏览/保存）

### 3. 跨平台兼容性

| 平台 | 必须支持的功能 | 可选功能 |
|------|----------------|----------|
| Kiro IDE | 全部功能 | - |
| VSCode | 搜索/浏览/保存/标签 | 对话整理 |
| Trae | 搜索/浏览/保存/标签 | 对话整理 |

**测试场景**：
- [ ] Kiro IDE (Windows/Mac)
- [ ] VSCode (Windows/Mac)
- [ ] Trae (Windows/Mac)

### 4. 性能指标

| 指标 | 目标 | 验证方法 |
|------|------|----------|
| 插件启动时间 | ≤ 2秒 | 性能分析 |
| 搜索响应时间 | ≤ 500ms | 性能测试 |
| 侧边栏刷新时间 | ≤ 1秒 | 性能测试 |
| 内存占用 | ≤ 50MB | 资源监控 |

### 5. 质量检查清单

**功能完整性**：
- [ ] 所有 Phase 1-5 功能已实现
- [ ] 所有命令可正常执行
- [ ] 所有 UI 元素显示正确

**错误处理**：
- [ ] 路径无效时有明确提示
- [ ] 网络错误时有降级方案
- [ ] 文件读写失败时有错误提示

**文档完整性**：
- [ ] README.md 已更新
- [ ] RELEASE-NOTES 已编写
- [ ] 快速开始指南已创建
- [ ] FAQ 已编写

**代码质量**：
- [ ] 无 TypeScript 编译错误
- [ ] 无 ESLint 警告
- [ ] 关键功能有单元测试
- [ ] 代码已格式化

---

## 📝 备注

- 保持向后兼容，不破坏现有用户数据
- 优先解决高优先级问题
- 每个 Phase 完成后测试验证

---

*创建日期：2026-01-09*
*目标版本：v2.52.0*
