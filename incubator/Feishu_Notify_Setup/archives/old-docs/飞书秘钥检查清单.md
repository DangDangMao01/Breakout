# é£ä¹¦ç§˜é’¥æ£€æŸ¥æ¸…å•

> åˆ›å»ºæ—¶é—´ï¼š2026-01-22  
> é—®é¢˜ï¼šCI é€šè¿‡ï¼Œè„šæœ¬æ‰§è¡ŒæˆåŠŸï¼Œä½†é£ä¹¦æ²¡æ”¶åˆ°é€šçŸ¥

---

## ğŸ” æ£€æŸ¥æ­¥éª¤

### Step 1: æ£€æŸ¥ GitLab ç¯å¢ƒå˜é‡

1. æ‰“å¼€ GitLab é¡¹ç›®ï¼š`GroupTwoGame/groupTowArt_Hb`
2. è¿›å…¥ï¼šSettings â†’ CI/CD â†’ Variables
3. æ£€æŸ¥ä»¥ä¸‹å˜é‡æ˜¯å¦å­˜åœ¨ï¼š

```
â–¡ FEISHU_APP_ID
â–¡ FEISHU_APP_SECRET
```

4. æ£€æŸ¥å˜é‡å€¼ï¼š
   - ç‚¹å‡» "Reveal values" æŸ¥çœ‹å®Œæ•´å€¼
   - APP_ID æ ¼å¼ï¼š`cli_xxxxxxxxxx`ï¼ˆé€šå¸¸ 16-20 ä½ï¼‰
   - APP_SECRET æ ¼å¼ï¼šé•¿å­—ç¬¦ä¸²ï¼ˆé€šå¸¸ 32 ä½ä»¥ä¸Šï¼‰

---

### Step 2: æœ¬åœ°æµ‹è¯•ç§˜é’¥

1. æ‰“å¼€ PowerShell
2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ›¿æ¢ä¸ºä½ çš„çœŸå®å€¼ï¼‰ï¼š

```powershell
$env:FEISHU_APP_ID = "ä½ çš„APP_ID"
$env:FEISHU_APP_SECRET = "ä½ çš„APP_SECRET"
```

3. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```powershell
cd D:\G_GitHub\Kiro-Central-KB\Feishu_Notify_Setup
python test_feishu_token.py
```

4. æŸ¥çœ‹ç»“æœï¼š

**æˆåŠŸç¤ºä¾‹**ï¼š
```
[æˆåŠŸ] Token è·å–æˆåŠŸï¼
[Token] eyJhbGciOiJIUzI1Ni...
[æˆåŠŸ] ç”¨æˆ·æŸ¥æ‰¾æˆåŠŸï¼
[ç”¨æˆ·] {'user_id': 'ou_xxxxx', ...}
```

**å¤±è´¥ç¤ºä¾‹**ï¼š
```
[é”™è¯¯] Token è·å–å¤±è´¥
[é”™è¯¯ç ] 10013
[é”™è¯¯ä¿¡æ¯] app_id invalid
```

---

### Step 3: æ£€æŸ¥é£ä¹¦åº”ç”¨é…ç½®

1. æ‰“å¼€é£ä¹¦å¼€æ”¾å¹³å°ï¼šhttps://open.feishu.cn/app
2. æ‰¾åˆ°ä½ çš„åº”ç”¨
3. æ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š

#### 3.1 åº”ç”¨å‡­è¯
```
â–¡ APP ID æ˜¯å¦æ­£ç¡®
â–¡ APP Secret æ˜¯å¦æ­£ç¡®
â–¡ æ˜¯å¦å·²é‡æ–°ç”Ÿæˆè¿‡ï¼ˆå¦‚æœé‡æ–°ç”Ÿæˆï¼Œéœ€è¦æ›´æ–° GitLab å˜é‡ï¼‰
```

#### 3.2 æƒé™é…ç½®
è¿›å…¥ï¼šå¼€å‘é…ç½® â†’ æƒé™ç®¡ç†

å¿…é¡»å¼€å¯ä»¥ä¸‹æƒé™ï¼š
```
â–¡ im:messageï¼ˆå‘é€æ¶ˆæ¯ï¼‰
â–¡ contact:user.email:readonlyï¼ˆé€šè¿‡é‚®ç®±æŸ¥æ‰¾ç”¨æˆ·ï¼‰
â–¡ contact:user:readonlyï¼ˆè·å–ç”¨æˆ·ä¿¡æ¯ï¼‰
```

#### 3.3 åº”ç”¨çŠ¶æ€
```
â–¡ åº”ç”¨æ˜¯å¦å·²å‘å¸ƒ
â–¡ åº”ç”¨æ˜¯å¦å·²å¯ç”¨
â–¡ åº”ç”¨æ˜¯å¦åœ¨å¯ç”¨èŒƒå›´å†…
```

---

### Step 4: æ£€æŸ¥ç”¨æˆ·é‚®ç®±

1. æ‰“å¼€é£ä¹¦ç®¡ç†åå°
2. è¿›å…¥ï¼šé€šè®¯å½• â†’ æˆå‘˜ç®¡ç†
3. æœç´¢ï¼š`wangxinlai@huixuanjiasu.com`
4. æ£€æŸ¥ï¼š
```
â–¡ ç”¨æˆ·æ˜¯å¦å­˜åœ¨
â–¡ é‚®ç®±æ˜¯å¦æ­£ç¡®
â–¡ ç”¨æˆ·æ˜¯å¦å·²æ¿€æ´»
â–¡ ç”¨æˆ·æ˜¯å¦åœ¨åº”ç”¨å¯è§èŒƒå›´å†…
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šToken è·å–å¤±è´¥

**é”™è¯¯ç  10013**ï¼š`app_id invalid`
- åŸå› ï¼šAPP_ID ä¸æ­£ç¡®
- è§£å†³ï¼šé‡æ–°å¤åˆ¶ APP_IDï¼Œç¡®ä¿æ²¡æœ‰å¤šä½™ç©ºæ ¼

**é”™è¯¯ç  10014**ï¼š`app_secret invalid`
- åŸå› ï¼šAPP_SECRET ä¸æ­£ç¡®
- è§£å†³ï¼šé‡æ–°å¤åˆ¶ APP_SECRETï¼Œæˆ–é‡æ–°ç”Ÿæˆ

**é”™è¯¯ç  99991663**ï¼š`tenant access token not found`
- åŸå› ï¼šåº”ç”¨æœªå‘å¸ƒæˆ–æœªå¯ç”¨
- è§£å†³ï¼šåœ¨é£ä¹¦å¼€æ”¾å¹³å°å‘å¸ƒåº”ç”¨

---

### é—®é¢˜ 2ï¼šç”¨æˆ·æŸ¥æ‰¾å¤±è´¥

**é”™è¯¯ç  230001**ï¼š`permission denied`
- åŸå› ï¼šç¼ºå°‘æƒé™ `contact:user.email:readonly`
- è§£å†³ï¼šåœ¨é£ä¹¦å¼€æ”¾å¹³å°æ·»åŠ æƒé™

**æœªæ‰¾åˆ°ç”¨æˆ·**ï¼š
- åŸå›  1ï¼šé‚®ç®±ä¸æ­£ç¡®
- åŸå›  2ï¼šç”¨æˆ·ä¸åœ¨åº”ç”¨å¯è§èŒƒå›´å†…
- åŸå›  3ï¼šç”¨æˆ·æœªæ¿€æ´»
- è§£å†³ï¼šæ£€æŸ¥é£ä¹¦é€šè®¯å½•

---

### é—®é¢˜ 3ï¼šæ¶ˆæ¯å‘é€å¤±è´¥

**é”™è¯¯ç  230002**ï¼š`permission denied`
- åŸå› ï¼šç¼ºå°‘æƒé™ `im:message`
- è§£å†³ï¼šåœ¨é£ä¹¦å¼€æ”¾å¹³å°æ·»åŠ æƒé™

**é”™è¯¯ç  230011**ï¼š`user not found`
- åŸå› ï¼šç”¨æˆ· ID ä¸å­˜åœ¨
- è§£å†³ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨é£ä¹¦ä¸­

---

## ğŸ¯ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šé‡æ–°ç”Ÿæˆç§˜é’¥

1. æ‰“å¼€é£ä¹¦å¼€æ”¾å¹³å°
2. è¿›å…¥åº”ç”¨ â†’ å‡­è¯ä¸åŸºç¡€ä¿¡æ¯
3. ç‚¹å‡» "é‡ç½® Secret"
4. å¤åˆ¶æ–°çš„ APP_SECRET
5. æ›´æ–° GitLab ç¯å¢ƒå˜é‡ï¼š
   - Settings â†’ CI/CD â†’ Variables
   - ç¼–è¾‘ `FEISHU_APP_SECRET`
   - ç²˜è´´æ–°å€¼
   - ä¿å­˜

---

### æ–¹æ¡ˆ 2ï¼šé‡æ–°åˆ›å»ºåº”ç”¨

å¦‚æœç§˜é’¥æ— æ³•ä¿®å¤ï¼Œå¯ä»¥é‡æ–°åˆ›å»ºåº”ç”¨ï¼š

1. åˆ›å»ºæ–°åº”ç”¨
2. é…ç½®æƒé™ï¼ˆim:message, contact:user.email:readonly, contact:user:readonlyï¼‰
3. å‘å¸ƒåº”ç”¨
4. å¤åˆ¶æ–°çš„ APP_ID å’Œ APP_SECRET
5. æ›´æ–° GitLab ç¯å¢ƒå˜é‡

---

## ğŸ“ æµ‹è¯•è®°å½•

### æµ‹è¯• 1ï¼šæœ¬åœ°æµ‹è¯•ç§˜é’¥

**æ—¶é—´**ï¼š____________________

**å‘½ä»¤**ï¼š
```powershell
$env:FEISHU_APP_ID = "ä½ çš„APP_ID"
$env:FEISHU_APP_SECRET = "ä½ çš„APP_SECRET"
python test_feishu_token.py
```

**ç»“æœ**ï¼š
```
â–¡ Token è·å–æˆåŠŸ
â–¡ ç”¨æˆ·æŸ¥æ‰¾æˆåŠŸ
â–¡ æµ‹è¯•é€šè¿‡
```

**é—®é¢˜**ï¼š
```
ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼Œè®°å½•åœ¨è¿™é‡Œï¼‰
```

---

### æµ‹è¯• 2ï¼šGitLab CI æµ‹è¯•

**æ—¶é—´**ï¼š____________________

**æäº¤**ï¼š
```bash
cd D:\HuiXuanJiaSu\I_IAA_Work
echo "test" > test.txt
git add test.txt
git commit -m "æµ‹è¯•é£ä¹¦é€šçŸ¥"
git push
```

**ç»“æœ**ï¼š
```
â–¡ CI é€šè¿‡
â–¡ è„šæœ¬æ‰§è¡ŒæˆåŠŸ
â–¡ é£ä¹¦æ”¶åˆ°é€šçŸ¥
```

**é—®é¢˜**ï¼š
```
ï¼ˆå¦‚æœæœ‰é—®é¢˜ï¼Œè®°å½•åœ¨è¿™é‡Œï¼‰
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/app)
- [é£ä¹¦ API æ–‡æ¡£](https://open.feishu.cn/document/home/introduction-to-custom-app-development/self-built-application-development-process)
- [å…³é”®ç»éªŒ-å¿…è¯»](./docs/å…³é”®ç»éªŒ-å¿…è¯».md)
- [v3.1 éƒ¨ç½²æŒ‡å—](./docs/v3.1éƒ¨ç½²æŒ‡å—.md)

---

**åˆ›å»ºæ—¶é—´**: 2026-01-22  
**ç»´æŠ¤äºº**: Kiro AI Assistant
