---
domain: ai-philosophy
tags: [clawdbot, claude-code, claude-mem, memory, context, technical-research]
date: 2026-01-30
source_project: "K_Kiro_Work"
related_discussions:
  - "knowledge-base/notes/20260129-è¶…é•¿è®°å¿†ä¸Šä¸‹æ–‡ä¸AIè‡ªæˆ‘å”¤é†’å®Œæ•´æ–¹æ¡ˆ.md"
  - "knowledge-base/notes/20260129-ä»Šæ—¥å¯¹è¯æ€»ç»“.md"
value_score: 10
---

# Clawdbot / Claude Code è¶…é•¿è®°å¿†ä¸Šä¸‹æ–‡æŠ€æœ¯è°ƒç ”æŠ¥å‘Š

> **è°ƒç ”ç›®æ ‡**: äº†è§£ Clawdbot / Claude Code çš„è¶…é•¿è®°å¿†ä¸Šä¸‹æ–‡å®ç°åŸç†ï¼Œä¸º Kiro Knowledge Base æ’ä»¶æä¾›æŠ€æœ¯å‚è€ƒ

**åˆ›å»ºæ—¶é—´**: 2026-01-30  
**è°ƒç ”äºº**: Kiro AI + ç”¨æˆ·åä½œ  
**ç‰ˆæœ¬**: v1.0

---

## ğŸ¯ æ ¸å¿ƒå‘ç°

### æ¦‚å¿µæ¾„æ¸…

**Clawdbot** å’Œ **Claude Code** æ˜¯ä¸¤ä¸ªä¸åŒä½†ç›¸å…³çš„æ¦‚å¿µï¼š

1. **Claude Code** = Anthropic å®˜æ–¹çš„ AI ç¼–ç¨‹åŠ©æ‰‹ï¼ˆç±»ä¼¼ Cursorï¼‰
2. **Clawdbot** = ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œè¿æ¥ Claude åˆ°æ¶ˆæ¯å¹³å°ï¼ˆWhatsApp, Telegram ç­‰ï¼‰
3. **Claude-Mem** = å¼€æºæ’ä»¶ï¼Œä¸º Claude Code æ·»åŠ è¶…é•¿è®°å¿†åŠŸèƒ½ â­

**å…³é”®æ´å¯Ÿ**: Claude-Mem æ˜¯æœ€æ¥è¿‘æˆ‘ä»¬éœ€æ±‚çš„å¼€æºæ–¹æ¡ˆï¼

---

## ğŸ§  è¶…é•¿è®°å¿†ä¸Šä¸‹æ–‡çš„å®ç°åŸç†

### 1. Anthropic å®˜æ–¹æ–¹æ¡ˆï¼ˆClaude Agent SDKï¼‰

#### æ ¸å¿ƒæŠ€æœ¯

**A. Context Compactionï¼ˆä¸Šä¸‹æ–‡å‹ç¼©ï¼‰**
- è‡ªåŠ¨å‹ç¼©å¯¹è¯å†å²
- ä¿ç•™å…³é”®ä¿¡æ¯
- é¿å…ä¸Šä¸‹æ–‡çª—å£æº¢å‡º

**B. Memory Toolï¼ˆè®°å¿†å·¥å…·ï¼‰**
- æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
- è·¨ä¼šè¯æŒä¹…åŒ–
- CRUD æ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰

**C. Long-Running Agent Harnessï¼ˆé•¿æœŸè¿è¡Œä»£ç†æ¡†æ¶ï¼‰**

ä¸¤ä¸ªå…³é”®è§’è‰²ï¼š

1. **Initializer Agentï¼ˆåˆå§‹åŒ–ä»£ç†ï¼‰**
   - é¦–æ¬¡ä¼šè¯è®¾ç½®ç¯å¢ƒ
   - åˆ›å»º `init.sh` è„šæœ¬
   - åˆ›å»º `claude-progress.txt` è¿›åº¦æ—¥å¿—
   - åˆ›å»º `features.json` åŠŸèƒ½æ¸…å•ï¼ˆ200+ åŠŸèƒ½ï¼‰
   - åˆå§‹åŒ– Git ä»“åº“

2. **Coding Agentï¼ˆç¼–ç ä»£ç†ï¼‰**
   - åç»­ä¼šè¯å¢é‡å·¥ä½œ
   - è¯»å–è¿›åº¦æ—¥å¿—å’Œ Git å†å²
   - ä¸€æ¬¡åªåšä¸€ä¸ªåŠŸèƒ½
   - æäº¤ä»£ç ï¼Œä¿æŒæ¸…æ´çŠ¶æ€
   - æ›´æ–°è¿›åº¦æ—¥å¿—

#### å…³é”®æ–‡ä»¶

```
project/
â”œâ”€â”€ init.sh                 # åˆå§‹åŒ–è„šæœ¬ï¼ˆå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼‰
â”œâ”€â”€ claude-progress.txt     # è¿›åº¦æ—¥å¿—ï¼ˆæ¯æ¬¡ä¼šè¯æ›´æ–°ï¼‰
â”œâ”€â”€ features.json           # åŠŸèƒ½æ¸…å•ï¼ˆ200+ åŠŸèƒ½ï¼Œæ ‡è®°å®ŒæˆçŠ¶æ€ï¼‰
â””â”€â”€ .git/                   # Git å†å²ï¼ˆä»£ç æäº¤è®°å½•ï¼‰
```

#### å·¥ä½œæµç¨‹

```
Session 1 (Initializer Agent):
  â†“
åˆ›å»ºç¯å¢ƒï¼ˆinit.sh, features.json, claude-progress.txtï¼‰
  â†“
åˆå§‹åŒ– Git ä»“åº“
  â†“
Session 2+ (Coding Agent):
  â†“
è¯»å– claude-progress.txt å’Œ Git å†å²
  â†“
é€‰æ‹©ä¸€ä¸ªæœªå®Œæˆçš„åŠŸèƒ½
  â†“
å®ç°åŠŸèƒ½ + æµ‹è¯•
  â†“
æäº¤ Git + æ›´æ–°è¿›åº¦æ—¥å¿—
  â†“
é‡å¤...
```

#### å…³é”®è®¾è®¡åŸåˆ™

1. **å¢é‡è¿›æ­¥**ï¼šä¸€æ¬¡åªåšä¸€ä¸ªåŠŸèƒ½ï¼Œé¿å…ä¸€æ¬¡æ€§åšå¤ªå¤š
2. **æ¸…æ´çŠ¶æ€**ï¼šæ¯æ¬¡ä¼šè¯ç»“æŸæ—¶ä»£ç å¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯
3. **ç»“æ„åŒ–æ›´æ–°**ï¼šä½¿ç”¨ JSON æ ¼å¼è®°å½•åŠŸèƒ½çŠ¶æ€
4. **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆPuppeteerï¼‰æµ‹è¯•

---

### 2. Claude-Mem å¼€æºæ–¹æ¡ˆï¼ˆæ¨èå­¦ä¹ ï¼‰â­

**è¿™ä¸ªæœ€æ¥è¿‘æˆ‘ä»¬çš„éœ€æ±‚ï¼**

#### é¡¹ç›®ä¿¡æ¯

- **GitHub**: https://github.com/thedotmack/claude-mem
- **æ–‡æ¡£**: https://docs.claude-mem.ai/
- **è®¸å¯**: AGPL-3.0ï¼ˆå¼€æºï¼‰
- **æŠ€æœ¯æ ˆ**: TypeScript, Bun, SQLite, Chroma

#### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session Start â†’ æ³¨å…¥æœ€è¿‘ 10 æ¬¡ä¼šè¯çš„ä¸Šä¸‹æ–‡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Prompts â†’ åˆ›å»ºä¼šè¯ï¼Œä¿å­˜ç”¨æˆ·æç¤º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool Executions â†’ æ•è·è§‚å¯Ÿï¼ˆè¯»å–ã€å†™å…¥ç­‰ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Worker Processes â†’ é€šè¿‡ Claude Agent SDK æå–å­¦ä¹ å†…å®¹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session Ends â†’ ç”Ÿæˆæ‘˜è¦ï¼Œä¸ºä¸‹æ¬¡ä¼šè¯åšå‡†å¤‡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒç»„ä»¶

**1. ç”Ÿå‘½å‘¨æœŸé’©å­ç³»ç»Ÿï¼ˆ5 ä¸ªé’©å­ï¼‰**


```typescript
interface LifecycleHooks {
  SessionStart: () => Promise<void>;      // ä¼šè¯å¼€å§‹
  UserPromptSubmit: () => Promise<void>;  // ç”¨æˆ·æäº¤æç¤º
  PostToolUse: () => Promise<void>;       // å·¥å…·ä½¿ç”¨å
  Stop: () => Promise<void>;              // åœæ­¢
  SessionEnd: () => Promise<void>;        // ä¼šè¯ç»“æŸ
}
```

**2. Worker Serviceï¼ˆHTTP APIï¼‰**

- ç«¯å£ï¼š37777
- Web UI å¯è§†åŒ–ï¼ˆå®æ—¶è®°å¿†æµï¼‰
- 10 ä¸ªæœç´¢ç«¯ç‚¹
- ä½¿ç”¨ Bun ç®¡ç†è¿›ç¨‹

**3. SQLite æ•°æ®åº“**

```sql
-- ä¼šè¯è¡¨
CREATE TABLE sessions (
  id TEXT PRIMARY KEY,
  project TEXT,
  start_time INTEGER,
  end_time INTEGER,
  summary TEXT
);

-- è§‚å¯Ÿè¡¨
CREATE TABLE observations (
  id TEXT PRIMARY KEY,
  session_id TEXT,
  type TEXT,  -- 'read', 'write', 'execute', 'search'
  content TEXT,
  metadata TEXT,
  timestamp INTEGER,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);

-- FTS5 å…¨æ–‡æœç´¢
CREATE VIRTUAL TABLE observations_fts USING fts5(
  content,
  metadata,
  content='observations'
);
```

**4. Chroma å‘é‡æ•°æ®åº“**

- æ··åˆæœç´¢ï¼ˆè¯­ä¹‰ + å…³é”®è¯ï¼‰
- æ™ºèƒ½ä¸Šä¸‹æ–‡æ£€ç´¢
- æœ¬åœ°ä¼˜å…ˆ

**5. MCP æœç´¢å·¥å…·ï¼ˆ3 å±‚å·¥ä½œæµï¼‰â­**

è¿™æ˜¯ Claude-Mem æœ€èªæ˜çš„è®¾è®¡ï¼

```typescript
// ç¬¬ 1 å±‚ï¼šå¿«é€Ÿç´¢å¼•æœç´¢ï¼ˆ50-100 tokens/ç»“æœï¼‰
interface SearchResult {
  id: string;
  type: string;
  timestamp: number;
  snippet: string;  // åªè¿”å›æ‘˜è¦
}

// ç¬¬ 2 å±‚ï¼šæ—¶é—´çº¿ä¸Šä¸‹æ–‡
interface Timeline {
  before: Observation[];  // å‰åå„ 5 æ¡
  target: Observation;
  after: Observation[];
}

// ç¬¬ 3 å±‚ï¼šå®Œæ•´è¯¦æƒ…ï¼ˆ500-1000 tokens/ç»“æœï¼‰
interface Observation {
  id: string;
  session_id: string;
  type: string;
  content: string;  // å®Œæ•´å†…å®¹
  metadata: any;
  timestamp: number;
}
```

**ä¸ºä»€ä¹ˆæ˜¯ 3 å±‚ï¼Ÿ**
- **èŠ‚çœ Token**ï¼šä¸ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰å†…å®¹
- **æ¸è¿›å¼æŠ«éœ²**ï¼šå…ˆçœ‹ç´¢å¼•ï¼Œå†çœ‹æ—¶é—´çº¿ï¼Œæœ€åçœ‹è¯¦æƒ…
- **æ™ºèƒ½è¿‡æ»¤**ï¼šåªè·å–çœŸæ­£éœ€è¦çš„å†…å®¹

**6. Folder Context Filesï¼ˆ`CLAUDE.md`ï¼‰â­**

è¿™æ˜¯å¦ä¸€ä¸ªèªæ˜çš„è®¾è®¡ï¼

```markdown
# Kiro Context - ProjectName

## Recent Activity
- 2026-01-30 10:30 - å®ç°äº† SQLite æ•°æ®åº“
- 2026-01-30 11:00 - æ·»åŠ äº† FTS5 å…¨æ–‡æœç´¢
- 2026-01-30 14:00 - é›†æˆäº† Chroma å‘é‡æ•°æ®åº“

## Key Learnings
- SQLite FTS5 æ€§èƒ½å¾ˆå¥½ï¼Œé€‚åˆæœ¬åœ°æœç´¢
- Chroma æ”¯æŒæ··åˆæœç´¢ï¼Œè¯­ä¹‰ç†è§£å¼º
- 3 å±‚æœç´¢å·¥ä½œæµå¯ä»¥èŠ‚çœå¤§é‡ Token

## Current State
- æ•°æ®åº“ï¼šå·²å®Œæˆ
- æœç´¢ï¼šå·²å®Œæˆ
- UIï¼šè¿›è¡Œä¸­
- æµ‹è¯•ï¼šå¾…å¼€å§‹

## Next Steps
1. å®ç° Web UI
2. æ·»åŠ æµ‹è¯•
3. ä¼˜åŒ–æ€§èƒ½
```

**è‡ªåŠ¨ç”Ÿæˆ**ï¼š
- æ¯æ¬¡ä¼šè¯ç»“æŸæ—¶æ›´æ–°
- åŒ…å«æ´»åŠ¨æ—¶é—´çº¿
- æå–å…³é”®å­¦ä¹ å†…å®¹
- è®°å½•å½“å‰çŠ¶æ€

#### å…³é”®ç‰¹æ€§

- ğŸ§  **æŒä¹…åŒ–è®°å¿†** - ä¸Šä¸‹æ–‡è·¨ä¼šè¯å­˜æ´»
- ğŸ“ **æ–‡ä»¶å¤¹ä¸Šä¸‹æ–‡** - è‡ªåŠ¨ç”Ÿæˆ `CLAUDE.md`
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ** - 28 ç§è¯­è¨€
- ğŸ­ **æ¨¡å¼ç³»ç»Ÿ** - åˆ‡æ¢å·¥ä½œæµï¼ˆCode, Email, Chillï¼‰
- ğŸ” **è‡ªç„¶è¯­è¨€æŸ¥è¯¢** - æŸ¥è¯¢é¡¹ç›®å†å²
- ğŸŒ **Web UI** - å®æ—¶è®°å¿†æµå¯è§†åŒ–ï¼ˆhttp://localhost:37777ï¼‰
- ğŸ”’ **éšç§æ§åˆ¶** - `<private>` æ ‡ç­¾æ’é™¤æ•æ„Ÿå†…å®¹
- âš™ï¸ **ä¸Šä¸‹æ–‡é…ç½®** - ç»†ç²’åº¦æ§åˆ¶æ³¨å…¥å†…å®¹
- ğŸ¤– **è‡ªåŠ¨æ“ä½œ** - æ— éœ€æ‰‹åŠ¨å¹²é¢„
- ğŸ“Š **FTS5 æœç´¢** - å¿«é€Ÿå…¨æ–‡æœç´¢
- ğŸ”— **å¼•ç”¨** - é€šè¿‡ ID å¼•ç”¨è¿‡å»çš„è§‚å¯Ÿ

#### å·¥ä½œæµç¨‹ç¤ºä¾‹


```typescript
// ç”¨æˆ·æé—®ï¼š"å¦‚ä½•å®ç°ç™»å½•åŠŸèƒ½ï¼Ÿ"

// Step 1: æœç´¢ç´¢å¼•ï¼ˆå¿«é€Ÿï¼‰
const results = await search("login authentication");
// è¿”å›ï¼š[
//   { id: "obs_123", type: "read", snippet: "è¯»å–äº† auth.ts..." },
//   { id: "obs_456", type: "write", snippet: "å®ç°äº† login()..." },
//   { id: "obs_789", type: "execute", snippet: "æµ‹è¯•äº†ç™»å½•æµç¨‹..." }
// ]

// Step 2: è·å–æ—¶é—´çº¿ï¼ˆä¸Šä¸‹æ–‡ï¼‰
const timeline = await getTimeline("obs_456");
// è¿”å›ï¼šå‰åå„ 5 æ¡è§‚å¯Ÿï¼Œäº†è§£ä¸Šä¸‹æ–‡

// Step 3: è·å–å®Œæ•´è¯¦æƒ…ï¼ˆåªè·å–éœ€è¦çš„ï¼‰
const details = await getObservations(["obs_456", "obs_789"]);
// è¿”å›ï¼šå®Œæ•´çš„å®ç°ä»£ç å’Œæµ‹è¯•ç»“æœ
```

---

## ğŸ’¡ å¯¹æˆ‘ä»¬çš„å¯å‘

### å¯ä»¥ç›´æ¥å€Ÿé‰´çš„è®¾è®¡

#### 1. ç”Ÿå‘½å‘¨æœŸé’©å­ç³»ç»Ÿ âœ…

**æˆ‘ä»¬å·²ç»æœ‰ Hook ç³»ç»Ÿäº†ï¼**

å¯ä»¥æ‰©å±•ä¸ºç±»ä¼¼çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š

```typescript
// ç°æœ‰çš„ Hook ç³»ç»Ÿ
interface Hook {
  when: {
    type: 'fileEdited' | 'fileCreated' | 'fileDeleted' | 
          'userTriggered' | 'promptSubmit' | 'agentStop';
    patterns?: string[];
  };
  then: {
    type: 'askAgent' | 'runCommand';
    prompt?: string;
    command?: string;
  };
}

// æ‰©å±•ä¸ºç”Ÿå‘½å‘¨æœŸé’©å­
interface LifecycleHook extends Hook {
  when: {
    type: 'sessionStart' | 'sessionEnd' | 'toolUse' | 
          'promptSubmit' | 'agentStop';
  };
  then: {
    type: 'captureObservation' | 'generateSummary' | 
          'injectContext' | 'updateProgress';
  };
}
```

#### 2. SQLite + FTS5 å…¨æ–‡æœç´¢ âœ…

**è½»é‡çº§ï¼Œæœ¬åœ°ä¼˜å…ˆï¼Œä¸éœ€è¦é¢å¤–æœåŠ¡**

```typescript
// æ•°æ®åº“ç»“æ„
interface Database {
  sessions: Session[];
  observations: Observation[];
  summaries: Summary[];
}

// FTS5 å…¨æ–‡æœç´¢
const searchResults = await db.query(`
  SELECT id, type, timestamp, snippet(observations_fts, 2, '<b>', '</b>', '...', 32)
  FROM observations_fts
  WHERE observations_fts MATCH ?
  ORDER BY rank
  LIMIT 20
`, [query]);
```

#### 3. 3 å±‚æœç´¢å·¥ä½œæµ âœ…

**èŠ‚çœ Token çš„å…³é”®è®¾è®¡ï¼**

```typescript
class MemorySearch {
  // ç¬¬ 1 å±‚ï¼šå¿«é€Ÿç´¢å¼•æœç´¢ï¼ˆ50-100 tokens/ç»“æœï¼‰
  async searchIndex(query: string): Promise<SearchResult[]> {
    return await db.query(`
      SELECT 
        id, 
        type, 
        timestamp, 
        snippet(observations_fts, 2, '', '', '...', 50) as snippet
      FROM observations_fts
      WHERE observations_fts MATCH ?
      ORDER BY rank
      LIMIT 20
    `, [query]);
  }
  
  // ç¬¬ 2 å±‚ï¼šæ—¶é—´çº¿ä¸Šä¸‹æ–‡
  async getTimeline(observationId: string, radius: number = 5): Promise<Timeline> {
    const target = await db.get('SELECT * FROM observations WHERE id = ?', [observationId]);
    const before = await db.all(`
      SELECT * FROM observations
      WHERE timestamp < ? AND session_id = ?
      ORDER BY timestamp DESC
      LIMIT ?
    `, [target.timestamp, target.session_id, radius]);
    const after = await db.all(`
      SELECT * FROM observations
      WHERE timestamp > ? AND session_id = ?
      ORDER BY timestamp ASC
      LIMIT ?
    `, [target.timestamp, target.session_id, radius]);
    
    return { before: before.reverse(), target, after };
  }
  
  // ç¬¬ 3 å±‚ï¼šå®Œæ•´è¯¦æƒ…ï¼ˆ500-1000 tokens/ç»“æœï¼‰
  async getObservations(ids: string[]): Promise<Observation[]> {
    return await db.all(`
      SELECT * FROM observations
      WHERE id IN (${ids.map(() => '?').join(',')})
    `, ids);
  }
}
```

#### 4. Folder Context Filesï¼ˆ`KIRO.md`ï¼‰â­

**è¿™ä¸ªæƒ³æ³•å¤ªæ£’äº†ï¼**

æ¯ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹è‡ªåŠ¨ç”Ÿæˆä¸Šä¸‹æ–‡æ–‡ä»¶ï¼š

```typescript
class FolderContextGenerator {
  async generateContext(project: string): Promise<void> {
    const recentSessions = await getRecentSessions(project, 10);
    const timeline = await generateTimeline(recentSessions);
    const learnings = await extractLearnings(recentSessions);
    const currentState = await getCurrentState(project);
    
    const content = `
# Kiro Context - ${project}

> è‡ªåŠ¨ç”Ÿæˆäº ${new Date().toISOString()}

## ğŸ“… Recent Activity

${timeline.map(item => `- ${item.date} ${item.time} - ${item.description}`).join('\n')}

## ğŸ’¡ Key Learnings

${learnings.map(learning => `- ${learning}`).join('\n')}

## ğŸ“Š Current State

${currentState}

## ğŸš€ Next Steps

${await getNextSteps(project)}

---

*This file is auto-generated by Kiro Knowledge Base Plugin*
*Last updated: ${new Date().toLocaleString()}*
    `;
    
    await fs.writeFile(path.join(project, 'KIRO.md'), content);
  }
}
```

**è‡ªåŠ¨æ›´æ–°æ—¶æœº**ï¼š
- ä¼šè¯ç»“æŸæ—¶
- æ–‡ä»¶ä¿å­˜æ—¶ï¼ˆé€šè¿‡ Hookï¼‰
- ç”¨æˆ·æ‰‹åŠ¨è§¦å‘

#### 5. Worker Service + Web UI âœ…

**HTTP API æä¾›æœç´¢æœåŠ¡ï¼ŒWeb UI å¯è§†åŒ–**

```typescript
// Worker Service
import { serve } from 'bun';

serve({
  port: 37777,
  async fetch(req) {
    const url = new URL(req.url);
    
    // API ç«¯ç‚¹
    if (url.pathname === '/api/search') {
      const query = url.searchParams.get('q');
      const results = await memorySearch.searchIndex(query);
      return Response.json(results);
    }
    
    if (url.pathname === '/api/timeline') {
      const id = url.searchParams.get('id');
      const timeline = await memorySearch.getTimeline(id);
      return Response.json(timeline);
    }
    
    if (url.pathname === '/api/observations') {
      const ids = url.searchParams.get('ids')?.split(',') || [];
      const observations = await memorySearch.getObservations(ids);
      return Response.json(observations);
    }
    
    // Web UI
    if (url.pathname === '/') {
      return new Response(webUI, {
        headers: { 'Content-Type': 'text/html' }
      });
    }
    
    return new Response('Not Found', { status: 404 });
  }
});

console.log('ğŸš€ Kiro Memory Service running at http://localhost:37777');
```

#### 6. æ™ºèƒ½å‹ç¼©ï¼ˆä½¿ç”¨ Claude APIï¼‰âœ…

**è‡ªåŠ¨æå–å­¦ä¹ å†…å®¹ï¼Œç”Ÿæˆè¯­ä¹‰æ‘˜è¦**

```typescript
class IntelligentCompression {
  async compressSession(session: Session): Promise<Summary> {
    const observations = await getObservations(session.id);
    
    // ä½¿ç”¨ Claude API æå–å­¦ä¹ å†…å®¹
    const prompt = `
è¯·åˆ†æä»¥ä¸‹å¯¹è¯è®°å½•ï¼Œæå–å…³é”®å­¦ä¹ å†…å®¹ï¼š

${observations.map(obs => `[${obs.type}] ${obs.content}`).join('\n\n')}

è¯·æå–ï¼š
1. æŠ€æœ¯è¦ç‚¹
2. å†³ç­–å’ŒåŸå› 
3. é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
4. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

ä»¥ç®€æ´çš„ Markdown æ ¼å¼è¾“å‡ºã€‚
    `;
    
    const summary = await callClaudeAPI(prompt);
    
    return {
      session_id: session.id,
      content: summary,
      timestamp: Date.now()
    };
  }
}
```

---

## ğŸ“Š æŠ€æœ¯å¯¹æ¯”

| ç‰¹æ€§ | Anthropic å®˜æ–¹ | Claude-Mem | æˆ‘ä»¬çš„æ–¹æ¡ˆ |
|------|---------------|-----------|-----------|
| **å­˜å‚¨** | æ–‡ä»¶ç³»ç»Ÿ | SQLite + Chroma | SQLite + Chroma |
| **æœç´¢** | æ–‡ä»¶è¯»å– | FTS5 + å‘é‡æœç´¢ | FTS5 + å‘é‡æœç´¢ |
| **å‹ç¼©** | Context Compaction | Claude Agent SDK | Claude API |
| **UI** | æ—  | Web UI (37777) | Web UI (37777) |
| **é’©å­** | 2 ä¸ªï¼ˆInit + Codingï¼‰ | 5 ä¸ªç”Ÿå‘½å‘¨æœŸ | æ‰©å±•ç°æœ‰ Hook |
| **ä¸Šä¸‹æ–‡æ–‡ä»¶** | `claude-progress.txt` | `CLAUDE.md` | `KIRO.md` |
| **è·¨é¡¹ç›®** | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **æ¥æºè¿½è¸ª** | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **Skills ç”Ÿæˆ** | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **å¤š AI æ”¯æŒ** | âŒ åªæ”¯æŒ Claude | âŒ åªæ”¯æŒ Claude | âœ… æ”¯æŒå¤šä¸ª |
| **å¼€æº** | éƒ¨åˆ†å¼€æº | å®Œå…¨å¼€æº (AGPL-3.0) | å®Œå…¨å¼€æº |

---

## ğŸš€ æˆ‘ä»¬çš„å®ç°æ–¹æ¡ˆï¼ˆæ›´æ–°ï¼‰

### Phase 1: åŸºç¡€æ¶æ„ï¼ˆv2.5.0ï¼‰- ç«‹å³å¯åš

**å€Ÿé‰´ Claude-Mem çš„è®¾è®¡**ï¼š

#### 1. SQLite æ•°æ®åº“ + FTS5 å…¨æ–‡æœç´¢

```sql
-- ä¼šè¯è¡¨
CREATE TABLE sessions (
  id TEXT PRIMARY KEY,
  project TEXT NOT NULL,
  start_time INTEGER NOT NULL,
  end_time INTEGER,
  summary TEXT,
  metadata TEXT  -- JSON: { tags, context, etc. }
);

-- è§‚å¯Ÿè¡¨
CREATE TABLE observations (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL,
  type TEXT NOT NULL,  -- 'read', 'write', 'execute', 'search', 'discuss'
  content TEXT NOT NULL,
  metadata TEXT,  -- JSON: { file_path, line_number, etc. }
  timestamp INTEGER NOT NULL,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);

-- æ‘˜è¦è¡¨
CREATE TABLE summaries (
  id TEXT PRIMARY KEY,
  session_id TEXT NOT NULL,
  content TEXT NOT NULL,
  learnings TEXT,  -- JSON: [learning1, learning2, ...]
  timestamp INTEGER NOT NULL,
  FOREIGN KEY (session_id) REFERENCES sessions(id)
);

-- FTS5 å…¨æ–‡æœç´¢
CREATE VIRTUAL TABLE observations_fts USING fts5(
  content,
  metadata,
  content='observations',
  content_rowid='rowid'
);

-- è§¦å‘å™¨ï¼šè‡ªåŠ¨æ›´æ–° FTS5 ç´¢å¼•
CREATE TRIGGER observations_ai AFTER INSERT ON observations BEGIN
  INSERT INTO observations_fts(rowid, content, metadata)
  VALUES (new.rowid, new.content, new.metadata);
END;

CREATE TRIGGER observations_ad AFTER DELETE ON observations BEGIN
  DELETE FROM observations_fts WHERE rowid = old.rowid;
END;

CREATE TRIGGER observations_au AFTER UPDATE ON observations BEGIN
  UPDATE observations_fts 
  SET content = new.content, metadata = new.metadata
  WHERE rowid = new.rowid;
END;
```

#### 2. ç”Ÿå‘½å‘¨æœŸé’©å­æ‰©å±•

```json
// .kiro/hooks/memory-capture.json
{
  "name": "Memory Capture",
  "version": "1.0.0",
  "description": "è‡ªåŠ¨æ•è·å¯¹è¯è®°å½•åˆ°è®°å¿†ç³»ç»Ÿ",
  "when": {
    "type": "promptSubmit"
  },
  "then": {
    "type": "askAgent",
    "prompt": "æ•è·è¿™æ¬¡å¯¹è¯åˆ°è®°å¿†ç³»ç»Ÿ"
  }
}

// .kiro/hooks/session-summary.json
{
  "name": "Session Summary",
  "version": "1.0.0",
  "description": "ä¼šè¯ç»“æŸæ—¶ç”Ÿæˆæ‘˜è¦",
  "when": {
    "type": "agentStop"
  },
  "then": {
    "type": "askAgent",
    "prompt": "ç”Ÿæˆæœ¬æ¬¡ä¼šè¯çš„æ‘˜è¦å¹¶ä¿å­˜"
  }
}

// .kiro/hooks/context-injection.json
{
  "name": "Context Injection",
  "version": "1.0.0",
  "description": "ä¼šè¯å¼€å§‹æ—¶æ³¨å…¥ç›¸å…³ä¸Šä¸‹æ–‡",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "è¯»å– KIRO.md å¹¶æ³¨å…¥ç›¸å…³ä¸Šä¸‹æ–‡"
  }
}
```

#### 3. Folder Context Filesï¼ˆ`KIRO.md`ï¼‰

```typescript
// è‡ªåŠ¨ç”Ÿæˆ KIRO.md
interface KiroContext {
  project: string;
  lastUpdated: Date;
  recentActivity: Activity[];
  keyLearnings: string[];
  currentState: string;
  nextSteps: string[];
}

class KiroContextGenerator {
  async generate(project: string): Promise<string> {
    const context = await this.buildContext(project);
    
    return `
# Kiro Context - ${context.project}

> ğŸ¤– è‡ªåŠ¨ç”Ÿæˆäº ${context.lastUpdated.toLocaleString()}
> ğŸ“ é¡¹ç›®è·¯å¾„: ${project}

---

## ğŸ“… Recent Activity

${context.recentActivity.map(activity => 
  `- **${activity.date}** ${activity.time} - ${activity.description}`
).join('\n')}

---

## ğŸ’¡ Key Learnings

${context.keyLearnings.map((learning, i) => 
  `${i + 1}. ${learning}`
).join('\n')}

---

## ğŸ“Š Current State

${context.currentState}

---

## ğŸš€ Next Steps

${context.nextSteps.map((step, i) => 
  `${i + 1}. ${step}`
).join('\n')}

---

## ğŸ” Quick Search

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æœç´¢é¡¹ç›®å†å²ï¼š
\`\`\`
# æœç´¢å…³é”®è¯
kiro search "login authentication"

# æŸ¥çœ‹æ—¶é—´çº¿
kiro timeline <observation-id>

# è·å–è¯¦æƒ…
kiro get <observation-id>
\`\`\`

---

*This file is auto-generated by Kiro Knowledge Base Plugin*  
*Do not edit manually - changes will be overwritten*  
*Last updated: ${context.lastUpdated.toISOString()}*
    `.trim();
  }
  
  private async buildContext(project: string): Promise<KiroContext> {
    const sessions = await getRecentSessions(project, 10);
    const observations = await getRecentObservations(project, 50);
    
    return {
      project,
      lastUpdated: new Date(),
      recentActivity: await this.extractActivity(observations),
      keyLearnings: await this.extractLearnings(sessions),
      currentState: await this.analyzeCurrentState(project),
      nextSteps: await this.suggestNextSteps(sessions)
    };
  }
}
```

#### 4. 3 å±‚æœç´¢ API

```typescript
// API å®ç°
class MemoryAPI {
  // Layer 1: å¿«é€Ÿç´¢å¼•æœç´¢
  async search(query: string, options?: SearchOptions): Promise<SearchResult[]> {
    const sql = `
      SELECT 
        o.id,
        o.type,
        o.timestamp,
        s.project,
        snippet(observations_fts, 2, '<mark>', '</mark>', '...', 50) as snippet
      FROM observations_fts
      JOIN observations o ON observations_fts.rowid = o.rowid
      JOIN sessions s ON o.session_id = s.id
      WHERE observations_fts MATCH ?
      ${options?.project ? 'AND s.project = ?' : ''}
      ${options?.type ? 'AND o.type = ?' : ''}
      ${options?.startDate ? 'AND o.timestamp >= ?' : ''}
      ${options?.endDate ? 'AND o.timestamp <= ?' : ''}
      ORDER BY rank
      LIMIT ${options?.limit || 20}
    `;
    
    const params = [query];
    if (options?.project) params.push(options.project);
    if (options?.type) params.push(options.type);
    if (options?.startDate) params.push(options.startDate);
    if (options?.endDate) params.push(options.endDate);
    
    return await db.all(sql, params);
  }
  
  // Layer 2: æ—¶é—´çº¿ä¸Šä¸‹æ–‡
  async timeline(observationId: string, radius: number = 5): Promise<Timeline> {
    const target = await db.get(
      'SELECT * FROM observations WHERE id = ?',
      [observationId]
    );
    
    if (!target) throw new Error('Observation not found');
    
    const before = await db.all(`
      SELECT * FROM observations
      WHERE timestamp < ? AND session_id = ?
      ORDER BY timestamp DESC
      LIMIT ?
    `, [target.timestamp, target.session_id, radius]);
    
    const after = await db.all(`
      SELECT * FROM observations
      WHERE timestamp > ? AND session_id = ?
      ORDER BY timestamp ASC
      LIMIT ?
    `, [target.timestamp, target.session_id, radius]);
    
    return {
      before: before.reverse(),
      target,
      after
    };
  }
  
  // Layer 3: å®Œæ•´è¯¦æƒ…
  async getObservations(ids: string[]): Promise<Observation[]> {
    if (ids.length === 0) return [];
    
    const placeholders = ids.map(() => '?').join(',');
    return await db.all(`
      SELECT o.*, s.project, s.summary as session_summary
      FROM observations o
      JOIN sessions s ON o.session_id = s.id
      WHERE o.id IN (${placeholders})
    `, ids);
  }
}
```

**æ—¶é—´**: 1-2 å‘¨

---

### Phase 2: è¶…é•¿è®°å¿†ï¼ˆv2.6.0ï¼‰- Clawdbot æœºåˆ¶

#### æŠ€æœ¯æ ˆé€‰æ‹©

1. **SQLite + FTS5**ï¼ˆåŸºç¡€æœç´¢ï¼‰âœ…
   - è½»é‡çº§ï¼Œæœ¬åœ°ä¼˜å…ˆ
   - å…¨æ–‡æœç´¢æ€§èƒ½å¥½
   - ä¸éœ€è¦é¢å¤–æœåŠ¡

2. **Chroma å‘é‡æ•°æ®åº“**ï¼ˆè¯­ä¹‰æœç´¢ï¼‰âœ…
   - å¼€æºï¼Œæœ¬åœ°ä¼˜å…ˆ
   - æ”¯æŒæ··åˆæœç´¢ï¼ˆè¯­ä¹‰ + å…³é”®è¯ï¼‰
   - æ˜“äºé›†æˆ

3. **Claude API**ï¼ˆæ™ºèƒ½å‹ç¼©ï¼‰âœ…
   - è‡ªåŠ¨æå–å­¦ä¹ å†…å®¹
   - ç”Ÿæˆè¯­ä¹‰æ‘˜è¦
   - ä¿ç•™å…³é”®ä¿¡æ¯

#### å®ç°æ­¥éª¤


**1. é›†æˆ Chroma å‘é‡æ•°æ®åº“**

```typescript
import { ChromaClient } from 'chromadb';

class VectorMemory {
  private client: ChromaClient;
  private collection: any;
  
  async initialize() {
    this.client = new ChromaClient();
    this.collection = await this.client.getOrCreateCollection({
      name: 'kiro_memory',
      metadata: { 'hnsw:space': 'cosine' }
    });
  }
  
  async addObservation(observation: Observation) {
    // ç”Ÿæˆ Embeddingï¼ˆä½¿ç”¨ Claude API æˆ–æœ¬åœ°æ¨¡å‹ï¼‰
    const embedding = await generateEmbedding(observation.content);
    
    await this.collection.add({
      ids: [observation.id],
      embeddings: [embedding],
      metadatas: [{
        session_id: observation.session_id,
        type: observation.type,
        timestamp: observation.timestamp,
        project: observation.project
      }],
      documents: [observation.content]
    });
  }
  
  async semanticSearch(query: string, topK: number = 10): Promise<SearchResult[]> {
    const queryEmbedding = await generateEmbedding(query);
    
    const results = await this.collection.query({
      queryEmbeddings: [queryEmbedding],
      nResults: topK
    });
    
    return results.ids[0].map((id, i) => ({
      id,
      distance: results.distances[0][i],
      content: results.documents[0][i],
      metadata: results.metadatas[0][i]
    }));
  }
  
  async hybridSearch(query: string, topK: number = 10): Promise<SearchResult[]> {
    // æ··åˆæœç´¢ï¼šFTS5 + å‘é‡æœç´¢
    const ftsResults = await memoryAPI.search(query, { limit: topK });
    const vectorResults = await this.semanticSearch(query, topK);
    
    // åˆå¹¶å¹¶é‡æ–°æ’åº
    return this.mergeAndRank(ftsResults, vectorResults);
  }
}
```

**2. æ™ºèƒ½å‹ç¼©ï¼ˆä½¿ç”¨ Claude APIï¼‰**

```typescript
class IntelligentCompression {
  async compressSession(sessionId: string): Promise<Summary> {
    const observations = await getObservations(sessionId);
    
    // æ„å»ºå‹ç¼©æç¤º
    const prompt = `
è¯·åˆ†æä»¥ä¸‹å¯¹è¯è®°å½•ï¼Œæå–å…³é”®å­¦ä¹ å†…å®¹ï¼š

${observations.map(obs => `
[${obs.type}] ${new Date(obs.timestamp).toLocaleString()}
${obs.content}
`).join('\n---\n')}

è¯·æå–ï¼š
1. **æŠ€æœ¯è¦ç‚¹**ï¼šå…³é”®çš„æŠ€æœ¯å†³ç­–å’Œå®ç°ç»†èŠ‚
2. **é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**ï¼šé‡åˆ°çš„é—®é¢˜åŠå¦‚ä½•è§£å†³
3. **é‡è¦å†³ç­–**ï¼šåšå‡ºçš„å†³ç­–åŠåŸå› 
4. **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼šæœªå®Œæˆçš„ä»»åŠ¡å’Œè®¡åˆ’

ä»¥ç®€æ´çš„ Markdown æ ¼å¼è¾“å‡ºï¼Œæ¯ä¸ªéƒ¨åˆ†ä¸è¶…è¿‡ 3 æ¡ã€‚
    `;
    
    const summary = await callClaudeAPI(prompt);
    
    // ä¿å­˜æ‘˜è¦
    await db.run(`
      INSERT INTO summaries (id, session_id, content, timestamp)
      VALUES (?, ?, ?, ?)
    `, [generateId(), sessionId, summary, Date.now()]);
    
    return { session_id: sessionId, content: summary };
  }
  
  async extractLearnings(sessionId: string): Promise<string[]> {
    const summary = await getSummary(sessionId);
    
    // ä½¿ç”¨ Claude API æå–å­¦ä¹ ç‚¹
    const prompt = `
ä»ä»¥ä¸‹æ‘˜è¦ä¸­æå–å…³é”®å­¦ä¹ ç‚¹ï¼Œæ¯ä¸ªå­¦ä¹ ç‚¹ä¸€å¥è¯ï¼š

${summary.content}

è¾“å‡ºæ ¼å¼ï¼š
- å­¦ä¹ ç‚¹ 1
- å­¦ä¹ ç‚¹ 2
- å­¦ä¹ ç‚¹ 3
    `;
    
    const learnings = await callClaudeAPI(prompt);
    return learnings.split('\n').filter(l => l.trim().startsWith('-')).map(l => l.trim().substring(2));
  }
}
```

**3. è‡ªåŠ¨ä¸Šä¸‹æ–‡æ³¨å…¥**

```typescript
class ContextInjection {
  async injectContext(project: string, query: string): Promise<string> {
    // 1. è¯»å– KIRO.md
    const kiroContext = await fs.readFile(path.join(project, 'KIRO.md'), 'utf-8');
    
    // 2. æœç´¢ç›¸å…³å†å²
    const searchResults = await memoryAPI.search(query, { project, limit: 5 });
    
    // 3. è·å–æ—¶é—´çº¿ï¼ˆåªè·å–æœ€ç›¸å…³çš„ï¼‰
    const timelines = await Promise.all(
      searchResults.slice(0, 2).map(r => memoryAPI.timeline(r.id, 3))
    );
    
    // 4. æ„å»ºä¸Šä¸‹æ–‡
    const context = `
# é¡¹ç›®ä¸Šä¸‹æ–‡

${kiroContext}

---

# ç›¸å…³å†å²

${searchResults.map(r => `
## ${r.type} - ${new Date(r.timestamp).toLocaleString()}
${r.snippet}
[æŸ¥çœ‹è¯¦æƒ…: ${r.id}]
`).join('\n')}

---

# æ—¶é—´çº¿

${timelines.map(t => `
### å›´ç»• ${t.target.id} çš„ä¸Šä¸‹æ–‡

**ä¹‹å‰**:
${t.before.map(o => `- ${new Date(o.timestamp).toLocaleString()}: ${o.content.substring(0, 100)}...`).join('\n')}

**å½“å‰**:
- ${new Date(t.target.timestamp).toLocaleString()}: ${t.target.content.substring(0, 100)}...

**ä¹‹å**:
${t.after.map(o => `- ${new Date(o.timestamp).toLocaleString()}: ${o.content.substring(0, 100)}...`).join('\n')}
`).join('\n---\n')}
    `;
    
    return context;
  }
}
```

**æ—¶é—´**: 3-4 å‘¨

---

### Phase 3: Skills è‡ªåŠ¨ç”Ÿæˆï¼ˆv2.7.0ï¼‰

**å€Ÿé‰´ Claude-Mem çš„æ¨¡å¼æ£€æµ‹**ï¼š

```typescript
class PatternDetector {
  async detectPatterns(project: string): Promise<Pattern[]> {
    // 1. è·å–æ‰€æœ‰è§‚å¯Ÿ
    const observations = await getAllObservations(project);
    
    // 2. èšç±»ç›¸ä¼¼è§‚å¯Ÿï¼ˆä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼‰
    const clusters = await this.clusterObservations(observations);
    
    // 3. æå–å…±åŒç‰¹å¾
    const patterns = await Promise.all(
      clusters.map(async cluster => {
        const commonSteps = await this.extractCommonSteps(cluster);
        const keywords = await this.extractKeywords(cluster);
        const context = await this.extractContext(cluster);
        
        return {
          frequency: cluster.length,
          commonSteps,
          keywords,
          context,
          observations: cluster
        };
      })
    );
    
    // 4. è¿‡æ»¤é«˜é¢‘æ¨¡å¼ï¼ˆé¢‘ç‡ >= 3ï¼‰
    return patterns.filter(p => p.frequency >= 3);
  }
  
  private async clusterObservations(observations: Observation[]): Promise<Observation[][]> {
    // ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦èšç±»
    const embeddings = await Promise.all(
      observations.map(o => generateEmbedding(o.content))
    );
    
    // ç®€å•çš„èšç±»ç®—æ³•ï¼ˆå¯ä»¥ç”¨æ›´å¤æ‚çš„ï¼Œå¦‚ DBSCANï¼‰
    const clusters: Observation[][] = [];
    const visited = new Set<number>();
    
    for (let i = 0; i < observations.length; i++) {
      if (visited.has(i)) continue;
      
      const cluster = [observations[i]];
      visited.add(i);
      
      for (let j = i + 1; j < observations.length; j++) {
        if (visited.has(j)) continue;
        
        const similarity = cosineSimilarity(embeddings[i], embeddings[j]);
        if (similarity > 0.8) {  // ç›¸ä¼¼åº¦é˜ˆå€¼
          cluster.push(observations[j]);
          visited.add(j);
        }
      }
      
      if (cluster.length >= 3) {  // è‡³å°‘ 3 ä¸ªè§‚å¯Ÿ
        clusters.push(cluster);
      }
    }
    
    return clusters;
  }
  
  private async extractCommonSteps(cluster: Observation[]): Promise<string[]> {
    // ä½¿ç”¨ Claude API æå–å…±åŒæ­¥éª¤
    const prompt = `
åˆ†æä»¥ä¸‹ç›¸ä¼¼çš„æ“ä½œè®°å½•ï¼Œæå–å…±åŒçš„æ­¥éª¤ï¼š

${cluster.map((o, i) => `
## è®°å½• ${i + 1}
${o.content}
`).join('\n')}

è¯·æå–å…±åŒçš„æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤ä¸€å¥è¯ã€‚
    `;
    
    const steps = await callClaudeAPI(prompt);
    return steps.split('\n').filter(s => s.trim()).map(s => s.trim());
  }
}

class SkillGenerator {
  async generateSkill(pattern: Pattern): Promise<Skill> {
    // 1. ç”Ÿæˆ Skill åç§°
    const name = await this.generateSkillName(pattern.keywords);
    
    // 2. ç”Ÿæˆæè¿°
    const description = await this.summarizePattern(pattern);
    
    // 3. ç”Ÿæˆæ­¥éª¤
    const steps = pattern.commonSteps.map((step, i) => `${i + 1}. ${step}`).join('\n');
    
    // 4. ç”Ÿæˆç¤ºä¾‹
    const examples = await this.generateExamples(pattern);
    
    // 5. ç”Ÿæˆå®Œæ•´çš„ SKILL.md
    const content = `
---
name: "${name}"
description: "${description}"
frequency: ${pattern.frequency}
keywords: ${JSON.stringify(pattern.keywords)}
---

# ${name}

## ğŸ“ æè¿°

${description}

## ğŸ¯ ä½¿ç”¨åœºæ™¯

${pattern.context}

## ğŸ“‹ æ‰§è¡Œæ­¥éª¤

${steps}

## ğŸ’¡ ç¤ºä¾‹

${examples}

## ğŸ“Š ç»Ÿè®¡

- ä½¿ç”¨é¢‘ç‡: ${pattern.frequency} æ¬¡
- é¦–æ¬¡ä½¿ç”¨: ${new Date(pattern.observations[0].timestamp).toLocaleDateString()}
- æœ€è¿‘ä½¿ç”¨: ${new Date(pattern.observations[pattern.observations.length - 1].timestamp).toLocaleDateString()}

---

*This skill was auto-generated by Kiro Knowledge Base Plugin*
*Based on ${pattern.frequency} similar observations*
    `.trim();
    
    return {
      name,
      description,
      content,
      metadata: {
        frequency: pattern.frequency,
        keywords: pattern.keywords,
        generated_at: Date.now()
      }
    };
  }
  
  async saveSkill(skill: Skill, project: string): Promise<void> {
    const skillDir = path.join(project, '.trae', 'skills', skill.name);
    await fs.mkdir(skillDir, { recursive: true });
    await fs.writeFile(path.join(skillDir, 'SKILL.md'), skill.content);
  }
}
```

**æ—¶é—´**: 2-3 å‘¨

---

### Phase 4: æœ¬åœ° AI æ¥å£ï¼ˆv3.0.0ï¼‰

**ä¸º"ç‰©ç† AI ä¸–ç•Œ"åšå‡†å¤‡**ï¼š

```typescript
// ç»Ÿä¸€çš„ AI æ¥å£
interface AIProvider {
  name: string;
  type: 'cloud' | 'local';
  
  // åŸºç¡€èƒ½åŠ›
  chat(messages: Message[]): Promise<string>;
  embed(text: string): Promise<number[]>;
  
  // çŸ¥è¯†åº“èƒ½åŠ›
  loadKnowledge(kb: KnowledgeBase): Promise<void>;
  recall(query: string): Promise<Knowledge[]>;
}

// Kiro å®ç°
class KiroAI implements AIProvider {
  name = 'Kiro';
  type = 'cloud';
  
  async chat(messages: Message[]): Promise<string> {
    // è°ƒç”¨ Kiro API
    return await kiroAPI.chat(messages);
  }
  
  async embed(text: string): Promise<number[]> {
    // ä½¿ç”¨ Claude API ç”Ÿæˆ Embedding
    return await claudeAPI.embed(text);
  }
  
  async loadKnowledge(kb: KnowledgeBase): Promise<void> {
    // åŠ è½½åˆ° Kiro çš„ä¸Šä¸‹æ–‡
    // é€šè¿‡ Steering è§„åˆ™è‡ªåŠ¨æ³¨å…¥
  }
  
  async recall(query: string): Promise<Knowledge[]> {
    // ä½¿ç”¨ 3 å±‚æœç´¢å·¥ä½œæµ
    const results = await memoryAPI.search(query);
    return results.map(r => ({
      id: r.id,
      content: r.snippet,
      relevance: r.rank
    }));
  }
}

// Ollama å®ç°ï¼ˆæœ¬åœ° AIï¼‰
class OllamaAI implements AIProvider {
  name = 'Ollama';
  type = 'local';
  
  async chat(messages: Message[]): Promise<string> {
    // è°ƒç”¨ Ollama API
    const response = await fetch('http://localhost:11434/api/chat', {
      method: 'POST',
      body: JSON.stringify({
        model: 'qwen2.5:32b',
        messages
      })
    });
    return await response.json();
  }
  
  async embed(text: string): Promise<number[]> {
    // ä½¿ç”¨ Ollama çš„ Embedding æ¨¡å‹
    const response = await fetch('http://localhost:11434/api/embeddings', {
      method: 'POST',
      body: JSON.stringify({
        model: 'nomic-embed-text',
        prompt: text
      })
    });
    const data = await response.json();
    return data.embedding;
  }
  
  async loadKnowledge(kb: KnowledgeBase): Promise<void> {
    // åŠ è½½åˆ°æœ¬åœ°æ¨¡å‹çš„ä¸Šä¸‹æ–‡
    // ä½¿ç”¨ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰
    const relevantDocs = await kb.search(this.currentQuery);
    this.context = relevantDocs.map(d => d.content).join('\n\n');
  }
  
  async recall(query: string): Promise<Knowledge[]> {
    // ä½¿ç”¨æ··åˆæœç´¢ï¼ˆFTS5 + å‘é‡ï¼‰
    return await vectorMemory.hybridSearch(query);
  }
}

// æœªæ¥å¯ä»¥è½»æ¾æ·»åŠ æ›´å¤š AI
class ClaudeAI implements AIProvider { /* ... */ }
class ChatGPT implements AIProvider { /* ... */ }
class GeminiAI implements AIProvider { /* ... */ }
```

**æ—¶é—´**: 4-6 å‘¨

---

## ğŸ¯ ç«‹å³è¡ŒåŠ¨è®¡åˆ’ï¼ˆæ›´æ–°ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå­¦ä¹  Claude-Mem æºç  â­

**ä»»åŠ¡**ï¼š
1. Clone Claude-Mem ä»“åº“
2. ç ”ç©¶æ ¸å¿ƒå®ç°
3. ç†è§£ 3 å±‚æœç´¢å·¥ä½œæµ
4. å­¦ä¹  Folder Context Files ç”Ÿæˆ

**å‘½ä»¤**ï¼š
```bash
git clone https://github.com/thedotmack/claude-mem.git
cd claude-mem

# ç ”ç©¶å…³é”®æ–‡ä»¶
# - src/hooks/ - ç”Ÿå‘½å‘¨æœŸé’©å­
# - src/worker/ - Worker Service
# - src/database/ - SQLite æ•°æ®åº“
# - src/search/ - æœç´¢å®ç°
# - src/context/ - ä¸Šä¸‹æ–‡ç”Ÿæˆ
```

**æ—¶é—´**ï¼š1-2 å¤©

---

### ç¬¬äºŒæ­¥ï¼šå®ç° SQLite + FTS5

**ä»»åŠ¡**ï¼š
1. åˆ›å»ºæ•°æ®åº“ç»“æ„
2. å®ç° FTS5 å…¨æ–‡æœç´¢
3. æ·»åŠ åŸºç¡€ CRUD æ“ä½œ
4. ç¼–å†™æµ‹è¯•

**æ–‡ä»¶**ï¼š
- `src/database/schema.sql` - æ•°æ®åº“ç»“æ„
- `src/database/db.ts` - æ•°æ®åº“æ“ä½œ
- `src/database/fts.ts` - FTS5 æœç´¢
- `tests/database.test.ts` - æµ‹è¯•

**æ—¶é—´**ï¼š1-2 å¤©

---

### ç¬¬ä¸‰æ­¥ï¼šå®ç° Folder Context Files

**ä»»åŠ¡**ï¼š
1. è‡ªåŠ¨ç”Ÿæˆ `KIRO.md`
2. åŒ…å«æ´»åŠ¨æ—¶é—´çº¿
3. æå–å…³é”®å­¦ä¹ å†…å®¹
4. æ·»åŠ  Hook è‡ªåŠ¨æ›´æ–°

**æ–‡ä»¶**ï¼š
- `src/context/generator.ts` - ä¸Šä¸‹æ–‡ç”Ÿæˆå™¨
- `src/context/template.ts` - Markdown æ¨¡æ¿
- `.kiro/hooks/update-context.json` - Hook é…ç½®

**æ—¶é—´**ï¼š2-3 å¤©

---

### ç¬¬å››æ­¥ï¼šå®ç° 3 å±‚æœç´¢ API

**ä»»åŠ¡**ï¼š
1. å®ç°å¿«é€Ÿç´¢å¼•æœç´¢
2. å®ç°æ—¶é—´çº¿ä¸Šä¸‹æ–‡
3. å®ç°å®Œæ•´è¯¦æƒ…è·å–
4. æ·»åŠ  HTTP API

**æ–‡ä»¶**ï¼š
- `src/search/api.ts` - æœç´¢ API
- `src/search/index.ts` - ç´¢å¼•æœç´¢
- `src/search/timeline.ts` - æ—¶é—´çº¿
- `src/search/details.ts` - è¯¦æƒ…è·å–

**æ—¶é—´**ï¼š3-4 å¤©

---

### ç¬¬äº”æ­¥ï¼šé›†æˆ Chroma å‘é‡æ•°æ®åº“

**ä»»åŠ¡**ï¼š
1. å®‰è£… Chroma
2. å®ç° Embedding ç”Ÿæˆ
3. å®ç°æ··åˆæœç´¢
4. ä¼˜åŒ–æ€§èƒ½

**æ–‡ä»¶**ï¼š
- `src/vector/chroma.ts` - Chroma é›†æˆ
- `src/vector/embedding.ts` - Embedding ç”Ÿæˆ
- `src/vector/hybrid.ts` - æ··åˆæœç´¢

**æ—¶é—´**ï¼š3-5 å¤©

---

### ç¬¬å…­æ­¥ï¼šå®ç° Worker Service + Web UI

**ä»»åŠ¡**ï¼š
1. åˆ›å»º HTTP API æœåŠ¡å™¨
2. å®ç°æœç´¢ç«¯ç‚¹
3. åˆ›å»º Web UI
4. å®æ—¶æ›´æ–°ï¼ˆSSEï¼‰

**æ–‡ä»¶**ï¼š
- `src/worker/server.ts` - HTTP æœåŠ¡å™¨
- `src/worker/api.ts` - API ç«¯ç‚¹
- `src/worker/ui.html` - Web UI
- `src/worker/sse.ts` - å®æ—¶æ›´æ–°

**æ—¶é—´**ï¼š4-5 å¤©

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### Claude-Mem çš„è®¾è®¡å“²å­¦

1. **Token æ•ˆç‡ä¼˜å…ˆ**
   - 3 å±‚æœç´¢å·¥ä½œæµ
   - å…ˆç´¢å¼•ï¼Œå†æ—¶é—´çº¿ï¼Œæœ€åè¯¦æƒ…
   - é¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰å†…å®¹

2. **æœ¬åœ°ä¼˜å…ˆ**
   - SQLite æœ¬åœ°å­˜å‚¨
   - Chroma æœ¬åœ°å‘é‡æ•°æ®åº“
   - ä¸ä¾èµ–äº‘æœåŠ¡

3. **è‡ªåŠ¨åŒ–**
   - ç”Ÿå‘½å‘¨æœŸé’©å­è‡ªåŠ¨æ•è·
   - è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
   - è‡ªåŠ¨æ³¨å…¥ä¸Šä¸‹æ–‡

4. **å¯è§†åŒ–**
   - Web UI å®æ—¶ç›‘æ§
   - æ—¶é—´çº¿å¯è§†åŒ–
   - æœç´¢ç»“æœå¯è§†åŒ–

---

### æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½çš„åœ°æ–¹

1. **è·¨é¡¹ç›®å…³è”** â­
   - Claude-Mem åªå…³æ³¨å•ä¸ªé¡¹ç›®
   - æˆ‘ä»¬éœ€è¦è·¨é¡¹ç›®ä¸Šä¸‹æ–‡å…³è”
   - æ¥æºè¿½è¸ªå’Œé¡¹ç›®åˆ†ç±»

2. **Skills è‡ªåŠ¨ç”Ÿæˆ** â­
   - Claude-Mem æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½
   - æˆ‘ä»¬å¯ä»¥æ·»åŠ æ¨¡å¼æ£€æµ‹
   - è‡ªåŠ¨ç”Ÿæˆ Skill æ–‡æ¡£

3. **å¤š AI æ”¯æŒ** â­
   - ä¸åªæ˜¯ Claude
   - æ”¯æŒ Ollama, ChatGPT, Gemini ç­‰
   - ç»Ÿä¸€çš„ AI æ¥å£

4. **å›¢é˜Ÿåä½œ** â­
   - å¤šç”¨æˆ·æ”¯æŒ
   - çŸ¥è¯†å…±äº«
   - æƒé™ç®¡ç†

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

1. **Anthropic å®˜æ–¹**
   - [Effective Harnesses for Long-Running Agents](https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents)
   - [Context Management](https://www.anthropic.com/news/context-management)
   - [Memory Tool Cookbook](https://platform.claude.com/cookbook/tool-use-memory-cookbook)

2. **Claude-Mem å¼€æºé¡¹ç›®**
   - [GitHub Repo](https://github.com/thedotmack/claude-mem)
   - [Documentation](https://docs.claude-mem.ai/)
   - [Architecture Overview](https://docs.claude-mem.ai/architecture)

### æŠ€æœ¯æ ˆ

1. **SQLite + FTS5**
   - [SQLite FTS5 Documentation](https://www.sqlite.org/fts5.html)
   - [Full-Text Search Best Practices](https://www.sqlite.org/fts5.html#appendix_a)

2. **Chroma å‘é‡æ•°æ®åº“**
   - [Chroma Documentation](https://docs.trychroma.com/)
   - [Getting Started](https://docs.trychroma.com/getting-started)
   - [Embeddings Guide](https://docs.trychroma.com/embeddings)

3. **Claude Agent SDK**
   - [Agent SDK Documentation](https://github.com/anthropics/anthropic-sdk-typescript)
   - [Quickstart Guide](https://github.com/anthropics/anthropic-quickstarts)

4. **Bun**
   - [Bun Documentation](https://bun.sh/docs)
   - [SQLite with Bun](https://bun.sh/docs/api/sqlite)

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### çŸ­æœŸï¼ˆPhase 1-2ï¼‰

- âœ… è§£å†³è·¨é¡¹ç›®ä¸Šä¸‹æ–‡æ–­è£‚
- âœ… å‡å°‘é‡å¤è®¨è®º
- âœ… æé«˜çŸ¥è¯†å¤ç”¨ç‡
- âœ… å®ç°è¶…é•¿è®°å¿†ä¸Šä¸‹æ–‡
- âœ… èŠ‚çœ Token æˆæœ¬ï¼ˆ3 å±‚æœç´¢ï¼‰

### ä¸­æœŸï¼ˆPhase 3-4ï¼‰

- âœ… è‡ªåŠ¨ç”Ÿæˆ Skills
- âœ… AI è¶Šç”¨è¶Š"æ‡‚"ä½ 
- âœ… æ”¯æŒæœ¬åœ° AI
- âœ… å½¢æˆä¸ªæ€§åŒ–"è‡ªæˆ‘"
- âœ… è·¨ AI å¹³å°ç»Ÿä¸€çŸ¥è¯†ç®¡ç†

### é•¿æœŸï¼ˆPhase 5+ï¼‰

- âœ… å¤šå¹³å°ç»Ÿä¸€çŸ¥è¯†ç®¡ç†
- âœ… å›¢é˜ŸçŸ¥è¯†å…±äº«
- âœ… çœŸæ­£çš„"AI è‡ªæˆ‘å”¤é†’"
- âœ… ä¸º"ç‰©ç† AI ä¸–ç•Œ"åšå¥½å‡†å¤‡
- âœ… ç‹¬ç«‹ App å’Œ API æœåŠ¡

---

## ğŸ“Š æˆæœ¬ä¼°ç®—

### å¼€å‘æˆæœ¬

| Phase | æ—¶é—´ | äººåŠ› | å¤æ‚åº¦ |
|-------|------|------|--------|
| Phase 1 | 1-2 å‘¨ | 1 äºº | ä¸­ç­‰ |
| Phase 2 | 3-4 å‘¨ | 1 äºº | å¤§ |
| Phase 3 | 2-3 å‘¨ | 1 äºº | ä¸­ç­‰ |
| Phase 4 | 4-6 å‘¨ | 1-2 äºº | å¤§ |
| **æ€»è®¡** | **10-15 å‘¨** | **1-2 äºº** | **å¤§** |

### è¿è¡Œæˆæœ¬

| é¡¹ç›® | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| SQLite | å…è´¹ | æœ¬åœ°å­˜å‚¨ |
| Chroma | å…è´¹ | æœ¬åœ°å‘é‡æ•°æ®åº“ |
| Claude API | æŒ‰ä½¿ç”¨é‡ | æ™ºèƒ½å‹ç¼©å’Œ Embedding |
| Ollama | å…è´¹ | æœ¬åœ° AIï¼ˆå¯é€‰ï¼‰ |
| æœåŠ¡å™¨ | å…è´¹ | æœ¬åœ°è¿è¡Œ |

**æ€»æˆæœ¬**: ä¸»è¦æ˜¯ Claude API çš„ä½¿ç”¨æˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ä¼˜åŒ–å‡å°‘ã€‚

---

## âœ… ç»“è®º

### æ ¸å¿ƒå‘ç°

1. **Claude-Mem æ˜¯æœ€æ¥è¿‘æˆ‘ä»¬éœ€æ±‚çš„å¼€æºæ–¹æ¡ˆ**
   - å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸé’©å­ç³»ç»Ÿ
   - é«˜æ•ˆçš„ 3 å±‚æœç´¢å·¥ä½œæµ
   - æ™ºèƒ½çš„ Folder Context Files
   - æœ¬åœ°ä¼˜å…ˆçš„æŠ€æœ¯æ ˆ

2. **æˆ‘ä»¬å¯ä»¥åœ¨ Claude-Mem çš„åŸºç¡€ä¸Šåšå¾—æ›´å¥½**
   - è·¨é¡¹ç›®ä¸Šä¸‹æ–‡å…³è”
   - Skills è‡ªåŠ¨ç”Ÿæˆ
   - å¤š AI æ”¯æŒ
   - å›¢é˜Ÿåä½œ

3. **æŠ€æœ¯æ ˆé€‰æ‹©æ˜ç¡®**
   - SQLite + FTS5ï¼ˆåŸºç¡€æœç´¢ï¼‰
   - Chromaï¼ˆè¯­ä¹‰æœç´¢ï¼‰
   - Claude APIï¼ˆæ™ºèƒ½å‹ç¼©ï¼‰
   - Bunï¼ˆè¿è¡Œæ—¶ï¼‰

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼šå­¦ä¹  Claude-Mem æºç 
2. **å¿«é€ŸåŸå‹**ï¼šå®ç° Phase 1ï¼ˆ1-2 å‘¨ï¼‰
3. **è¿­ä»£ä¼˜åŒ–**ï¼šæ ¹æ®åé¦ˆè°ƒæ•´
4. **é•¿æœŸè§„åˆ’**ï¼šæŒ‰ Phase 2-4 é€æ­¥å®ç°

### æœ€ç»ˆç›®æ ‡

**ä¸åªæ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œè€Œæ˜¯ AI çš„"å‡ºç”Ÿåæˆé•¿ç³»ç»Ÿ"ï¼Œä¸º"ç‰©ç† AI ä¸–ç•Œ"åšå‡†å¤‡ï¼**

---

**åˆ›å»ºæ—¶é—´**: 2026-01-30  
**ä½œè€…**: Kiro AI + ç”¨æˆ·åä½œ  
**ç‰ˆæœ¬**: v1.0  
**æ„ä¹‰**: ä¸º Kiro Knowledge Base æ’ä»¶æä¾›æ¸…æ™°çš„æŠ€æœ¯è·¯å¾„å’Œå®ç°æ–¹æ¡ˆ

