# Kiro-Trae 双系统兼容方案

**创建时间**: 2026-01-28  
**目标**: 让 Kiro Knowledge Base 插件同时支持 Kiro 和 Trae 的知识管理

---

## 背景

### 当前情况

1. **Kiro Knowledge Base 插件**
   - 只支持 Kiro 的对话保存
   - 使用 Markdown 格式
   - 路径：`knowledge-base/solutions/`, `notes/`, `discussions/`

2. **Trae 系统**
   - 现在也支持 Markdown 文件了！
   - 使用 `.trae/skills/` 目录
   - 文件格式：带 YAML frontmatter 的 `SKILL.md`

### 问题

之前因为 Trae 不支持 Markdown 而放弃了兼容，现在 Trae 也能生成 `.md` 文件了，可以重新考虑兼容。

---

## Trae 文件格式分析

### 目录结构

```
.trae/
└── skills/
    └── maya-automation-expert/
        ├── image/
        │   └── SKILL/
        └── SKILL.md
```

### SKILL.md 格式

```markdown
---
name: "maya-automation-expert"
description: "Expert in Autodesk Maya scripting..."
---

# Maya Automation Expert

内容...
```

**特点**：
- 使用 YAML frontmatter（`---` 包裹）
- 包含 `name` 和 `description` 字段
- 正文是标准 Markdown

---

## 兼容方案设计

### 方案 1: 双模式支持（推荐）

插件同时支持两种模式：

#### Kiro 模式（现有）
```
knowledge-base/
├── solutions/
│   └── 20260128-xxx.md
├── notes/
│   └── 20260128-xxx.md
└── discussions/
    └── 20260128-xxx.md
```

#### Trae 模式（新增）
```
.trae/
└── skills/
    ├── cocos-animation-expert/
    │   └── SKILL.md
    ├── maya-scripting-expert/
    │   └── SKILL.md
    └── blender-automation-expert/
        └── SKILL.md
```

### 方案 2: 统一格式

让 Kiro 的文件也支持 frontmatter：

```markdown
---
title: "Cocos2D 金币飞行动画开发"
date: "2026-01-28"
tags: ["cocos2d", "animation", "game-dev"]
type: "solution"
---

# Cocos2D 金币飞行动画开发

内容...
```

---

## 功能设计

### 1. 自动检测模式

插件启动时检测：
- 如果有 `.trae/` 文件夹 → 启用 Trae 模式
- 如果有 `knowledge-base/` 文件夹 → 启用 Kiro 模式
- 两者都有 → 双模式

### 2. 保存对话

#### Kiro 模式（现有）
```typescript
// 保存到 knowledge-base/solutions/
saveToKiro(content: string, type: 'solution' | 'note' | 'discussion')
```

#### Trae 模式（新增）
```typescript
// 保存到 .trae/skills/
saveToTrae(content: string, skillName: string, description: string)
```

### 3. 智能分类

根据对话内容自动判断：
- **技术方案** → Kiro `solutions/` 或 Trae `skills/`
- **代码片段** → Kiro `notes/`
- **讨论记录** → Kiro `discussions/`

### 4. 统一检索

```typescript
// 同时搜索 Kiro 和 Trae 的内容
searchKnowledgeBase(query: string): {
  kiroResults: KiroResult[],
  traeResults: TraeResult[]
}
```

---

## 实现步骤

### 阶段 1: 基础兼容（v2.5.0）

1. **检测 Trae 目录**
   ```typescript
   function detectTraeMode(): boolean {
     return fs.existsSync('.trae/skills');
   }
   ```

2. **读取 SKILL.md**
   ```typescript
   function parseSkillFile(path: string): {
     frontmatter: { name: string, description: string },
     content: string
   }
   ```

3. **保存到 Trae**
   ```typescript
   function saveToTrae(skillName: string, content: string) {
     const skillPath = `.trae/skills/${skillName}/SKILL.md`;
     // 生成 frontmatter + content
   }
   ```

### 阶段 2: 智能转换（v2.6.0）

1. **Kiro → Trae 转换**
   - 将 `solutions/` 中的技术方案转换为 Trae skills
   - 自动生成 `name` 和 `description`

2. **Trae → Kiro 转换**
   - 将 Trae skills 导入到 Kiro knowledge-base
   - 保留 frontmatter 信息

### 阶段 3: 统一界面（v2.7.0）

1. **统一的知识库视图**
   - 树形结构显示 Kiro 和 Trae 的内容
   - 支持拖拽移动

2. **统一的搜索**
   - 同时搜索两个系统
   - 结果分类显示

---

## 配置项

### 新增配置

```json
{
  "kiro-kb.traeMode": {
    "type": "boolean",
    "default": true,
    "description": "启用 Trae 兼容模式 / Enable Trae compatibility"
  },
  "kiro-kb.traePath": {
    "type": "string",
    "default": ".trae/skills",
    "description": "Trae skills 路径 / Trae skills path"
  },
  "kiro-kb.autoConvert": {
    "type": "boolean",
    "default": false,
    "description": "自动转换 Kiro ↔ Trae / Auto-convert between Kiro and Trae"
  }
}
```

---

## 命令扩展

### 新增命令

```json
{
  "command": "kiro-kb.saveToTrae",
  "title": "Kiro KB: 保存为 Trae Skill / Save as Trae Skill"
},
{
  "command": "kiro-kb.convertToTrae",
  "title": "Kiro KB: 转换为 Trae Skills / Convert to Trae Skills"
},
{
  "command": "kiro-kb.importFromTrae",
  "title": "Kiro KB: 从 Trae 导入 / Import from Trae"
}
```

---

## 使用场景

### 场景 1: 纯 Kiro 用户
- 不受影响，继续使用现有功能
- 可选择性启用 Trae 模式

### 场景 2: 纯 Trae 用户
- 插件自动检测 `.trae/` 目录
- 对话保存为 SKILL.md 格式

### 场景 3: 双系统用户（你的情况）
- 同时使用 Kiro 和 Trae
- 插件提供统一的知识管理界面
- 可以在两个系统间转换

---

## 技术实现

### 1. Frontmatter 解析

```typescript
import * as yaml from 'js-yaml';

function parseFrontmatter(content: string): {
  frontmatter: any,
  body: string
} {
  const match = content.match(/^---\n([\s\S]+?)\n---\n([\s\S]*)$/);
  if (!match) {
    return { frontmatter: {}, body: content };
  }
  
  const frontmatter = yaml.load(match[1]);
  const body = match[2];
  
  return { frontmatter, body };
}
```

### 2. SKILL.md 生成

```typescript
function generateSkillFile(
  name: string,
  description: string,
  content: string
): string {
  const frontmatter = yaml.dump({ name, description });
  return `---\n${frontmatter}---\n\n${content}`;
}
```

### 3. 智能分类

```typescript
function classifyContent(content: string): 'skill' | 'solution' | 'note' {
  // 检测关键词
  if (content.includes('Expert in') || content.includes('专家')) {
    return 'skill';
  }
  if (content.includes('解决方案') || content.includes('Solution')) {
    return 'solution';
  }
  return 'note';
}
```

---

## 优势

1. **向后兼容** - 不影响现有 Kiro 用户
2. **灵活性** - 用户可以选择使用哪种模式
3. **统一管理** - 一个插件管理两个系统
4. **智能转换** - 自动在两种格式间转换
5. **未来扩展** - 可以支持更多 AI 系统

---

## 风险和挑战

### 1. 格式差异
- **问题**: Kiro 和 Trae 的文件格式不完全一致
- **解决**: 使用适配器模式，统一接口

### 2. 目录结构
- **问题**: Kiro 按类型分类，Trae 按技能分类
- **解决**: 提供映射关系，支持双向转换

### 3. 用户习惯
- **问题**: 用户可能习惯了某一种方式
- **解决**: 默认保持现有行为，新功能可选

---

## 下一步

1. **调研 Trae 的完整格式**
   - 查看更多 SKILL.md 示例
   - 了解 Trae 的其他文件类型

2. **设计详细的 API**
   - 定义统一的接口
   - 实现适配器

3. **开发原型**
   - 先实现基础的读写功能
   - 测试兼容性

4. **用户测试**
   - 在你的项目中测试
   - 收集反馈

---

## 总结

通过双模式支持，Kiro Knowledge Base 插件可以：
- ✅ 继续服务 Kiro 用户
- ✅ 支持 Trae 用户
- ✅ 为双系统用户提供统一体验
- ✅ 为未来扩展打下基础

这是一个很好的想法！让我们一起实现它！

---

**下一步行动**：
1. 你觉得这个方案可行吗？
2. 需要调整哪些部分？
3. 我们从哪个阶段开始实现？
