# 飞书工作配方配置检查清单

> 日期: 2026-01-22  
> 用途: 逐步配置飞书工作配方，确保不遗漏任何步骤

---

## 📋 配置前准备

### 需要准备的信息

```
□ GitLab 地址: ___________________________
  （例如：gitlab.company.com 或 192.168.1.100:8080）

□ GitLab 账号: ___________________________
  （有项目访问权限的账号）

□ 项目路径: ___________________________
  （例如：GroupTwoGame/groupTowArt_Hb）

□ 监听分支: ___________________________
  （例如：master 或 main）

□ 通知接收人: ___________________________
  （飞书账号或群组）
```

---

## 🚀 第一阶段：创建飞书机器人（预计 5 分钟）

### Step 1.1: 打开飞书应用目录

```
□ 打开飞书客户端
□ 点击左下角"工作台"
□ 点击"应用目录"
□ 搜索"飞书机器人"
```

**截图位置**：应用目录搜索页面

---

### Step 1.2: 创建机器人应用

```
□ 点击"创建机器人应用"
□ 填写机器人名称: 美术资源通知机器人
□ 填写描述: 自动通知美术资源提交
□ 点击"创建"
□ 等待创建完成（约 10 秒）
```

**成功标志**：显示"创建成功"提示

---

### Step 1.3: 进入创建流程

```
□ 点击"创建流程"按钮
□ 进入流程编辑页面
```

**截图位置**：流程编辑页面

---

## 🔗 第二阶段：配置 GitLab 连接（预计 10 分钟）

### Step 2.1: 在 GitLab 创建应用

```
□ 打开 GitLab 网站
□ 登录你的 GitLab 账号
□ 点击右上角头像 → Settings（设置）
□ 左侧菜单 → Applications（应用程序）
□ 点击"New application"（新建应用）
```

---

### Step 2.2: 填写应用信息

```
□ Name（名称）: 飞书机器人
□ Redirect URI（回调地址）:
  https://botbuilder.feishu.cn/authorize/callback
□ Confidential: ✅ 勾选
□ Scopes（权限）:
  ✅ api - 完整 API 访问权限
  ✅ read_user - 读取用户信息
  ✅ read_repository - 读取仓库信息
□ 点击"Save application"
```

**⚠️ 重要**：Redirect URI 必须完全一致，包括 https

---

### Step 2.3: 复制应用凭证

```
□ 复制 Application ID: ___________________________
□ 复制 Secret: ___________________________
```

**⚠️ 注意**：Secret 只显示一次，务必保存好！

---

### Step 2.4: 在飞书添加 GitLab 账号

```
□ 回到飞书机器人流程编辑页面
□ 点击"触发器"
□ 选择"GitLab Commit"
□ 点击"添加账号"
```

---

### Step 2.5: 填写 GitLab 信息

```
□ GitLab 域名: ___________________________
  （填写你准备的 GitLab 地址）

□ Application ID: ___________________________
  （粘贴刚才复制的 Application ID）

□ Secret: ___________________________
  （粘贴刚才复制的 Secret）

□ 点击"确定"
```

**检查点**：
- ✅ 域名格式正确（不要加 http:// 或 https://）
- ✅ Application ID 和 Secret 没有多余空格

---

### Step 2.6: 授权 GitLab 账号

```
□ 自动跳转到 GitLab 授权页面
□ 如果没有 SSL 证书，手动修改 URL：
  - 将 https:// 改为 http://
□ 点击"Authorize"（授权）按钮
□ 等待跳转回飞书
```

**成功标志**：回到飞书页面，显示"已授权"

**如果失败**：
- 检查 GitLab 地址是否正确
- 检查 Application ID 和 Secret 是否正确
- 检查网络连接

---

## ⚙️ 第三阶段：配置监听规则（预计 5 分钟）

### Step 3.1: 选择监听项目

```
□ 在"项目"下拉框中选择项目
□ 项目名称: ___________________________
  （例如：GroupTwoGame/groupTowArt_Hb）
```

**如果找不到项目**：
- 检查 GitLab 账号是否有项目访问权限
- 刷新页面重试

---

### Step 3.2: 选择监听分支

```
□ 在"分支"下拉框中选择分支
□ 分支名称: ___________________________
  （建议选择：master 或 main）
```

**建议**：
- ✅ 监听主分支（master/main）
- ❌ 不建议监听开发分支（太频繁）

---

### Step 3.3: 确认配置

```
□ 检查项目名称是否正确
□ 检查分支名称是否正确
□ 点击"确定"
```

---

## 📨 第四阶段：配置通知动作（预计 10 分钟）

### Step 4.1: 添加发送消息节点

```
□ 点击"+"添加节点
□ 选择"发送飞书消息"
□ 或选择"发送卡片消息"（推荐）
```

---

### Step 4.2: 配置接收人

**方案 A：发送给个人**
```
□ 接收人类型: 个人
□ 选择接收人: ___________________________
  （选择你的飞书账号）
```

**方案 B：发送给群组**
```
□ 接收人类型: 群组
□ 选择群组: ___________________________
  （选择项目群组）
```

---

### Step 4.3: 配置消息内容

**基础版（推荐新手）**：
```
□ 消息类型: 文本消息
□ 消息内容:
  【美术资源更新提醒】
  项目：{{project.name}}
  提交人：{{user.name}}
  提交信息：{{commit.message}}
  查看变更：{{commit.url}}
```

**高级版（推荐）**：
```
□ 消息类型: 卡片消息
□ 使用模板: 自定义卡片
□ 复制以下 JSON 配置:
```

```json
{
  "header": {
    "title": {
      "tag": "plain_text",
      "content": "美术资源更新提醒"
    },
    "template": "blue"
  },
  "elements": [
    {
      "tag": "div",
      "fields": [
        {
          "is_short": true,
          "text": {
            "tag": "lark_md",
            "content": "**项目**\n{{project.name}}"
          }
        },
        {
          "is_short": true,
          "text": {
            "tag": "lark_md",
            "content": "**提交人**\n{{user.name}}"
          }
        }
      ]
    },
    {
      "tag": "div",
      "text": {
        "tag": "lark_md",
        "content": "**提交信息**\n{{commit.message}}"
      }
    },
    {
      "tag": "action",
      "actions": [
        {
          "tag": "button",
          "text": {
            "tag": "plain_text",
            "content": "查看变更"
          },
          "url": "{{commit.url}}",
          "type": "primary"
        }
      ]
    },
    {
      "tag": "note",
      "elements": [
        {
          "tag": "plain_text",
          "content": "请及时拉取最新资源！"
        }
      ]
    }
  ]
}
```

---

### Step 4.4: （可选）添加条件判断

**如果需要根据项目分配不同负责人**：

```
□ 在发送消息节点前添加"条件判断"节点
□ 条件 1: {{project.path}} 包含 "Y_遇水发财"
  → 发送给: 赵丽达
□ 条件 2: {{project.path}} 包含 "C_财运接龙"
  → 发送给: 王新来、赵丽达
□ 条件 3: {{project.path}} 包含 "groupTowArt_Hb"
  → 发送给: 王新来
□ 其他: 发送给默认负责人
```

---

### Step 4.5: （可选）添加多维表格记录

```
□ 添加"多维表格"节点
□ 选择表格: 美术资源提交记录
□ 操作: 新增记录
□ 字段映射:
  - 项目名称: {{project.name}}
  - 提交人: {{user.name}}
  - 提交时间: {{commit.timestamp}}
  - 提交信息: {{commit.message}}
  - 提交链接: {{commit.url}}
```

---

## ✅ 第五阶段：启用和测试（预计 5 分钟）

### Step 5.1: 启用流程

```
□ 检查所有节点配置是否正确
□ 点击右上角"启用"按钮
□ 确认启用
```

**成功标志**：按钮变为"已启用"

---

### Step 5.2: 发布流程

```
□ ⚠️ 重要：点击右上角"发布"按钮
□ 填写发布说明: 初始版本
□ 点击"确定"
```

**⚠️ 关键**：不发布流程不会生效！

**成功标志**：显示"发布成功"提示

---

### Step 5.3: 测试流程

```
□ 打开 GitLab 项目
□ 修改一个文件（或创建测试文件）
□ 提交代码到监听的分支
□ 等待 10-30 秒
□ 检查飞书是否收到通知
```

**测试提交示例**：
```bash
# 创建测试文件
echo "test" > test.txt

# 提交
git add test.txt
git commit -m "测试飞书通知"
git push origin master
```

---

### Step 5.4: 查看执行日志

```
□ 回到飞书机器人应用
□ 点击"执行记录"
□ 查看最新的执行记录
□ 检查是否成功
```

**如果成功**：
- ✅ 状态显示"成功"
- ✅ 飞书收到通知消息

**如果失败**：
- ❌ 查看错误信息
- ❌ 根据错误信息排查问题
- ❌ 参考"常见问题"章节

---

## 🐛 常见问题排查

### 问题 1: 授权失败

```
□ 检查 GitLab 地址是否正确
□ 检查 Application ID 是否正确
□ 检查 Secret 是否正确
□ 检查网络连接
□ 如果没有 SSL，确认 URL 改为 http://
```

---

### 问题 2: 找不到项目

```
□ 检查 GitLab 账号是否有项目访问权限
□ 刷新页面重试
□ 重新授权 GitLab 账号
```

---

### 问题 3: 没有收到通知

```
□ 检查流程是否已启用
□ ⚠️ 检查流程是否已发布（最常见的问题）
□ 检查提交是否在监听的分支上
□ 检查执行日志是否有错误
□ 检查接收人是否正确
```

---

### 问题 4: 消息格式错误

```
□ 检查 JSON 格式是否正确
□ 检查变量名是否正确（{{project.name}}）
□ 使用在线 JSON 校验工具检查
□ 参考官方模板
```

---

## 📊 配置完成检查

### 最终检查清单

```
□ GitLab 应用已创建
□ 飞书机器人已创建
□ GitLab 账号已授权
□ 监听项目已配置
□ 监听分支已配置
□ 通知消息已配置
□ 接收人已配置
□ 流程已启用
□ ⚠️ 流程已发布（重要！）
□ 测试提交已成功
□ 飞书已收到通知
```

---

## 🎯 下一步优化

### 短期优化（本周）

```
□ 添加多个项目监听
□ 配置不同项目的负责人
□ 优化消息卡片样式
□ 添加多维表格记录
```

---

### 长期优化（下周）

```
□ 添加 AI 分类功能
□ 配置数据统计报表
□ 添加审批流程
□ 集成其他飞书功能
```

---

## 📝 配置记录

### 配置信息记录

```
配置日期: ___________________________
配置人: ___________________________
GitLab 地址: ___________________________
监听项目: ___________________________
监听分支: ___________________________
接收人: ___________________________
流程 ID: ___________________________
```

---

### 测试记录

```
测试日期: ___________________________
测试提交 SHA: ___________________________
是否收到通知: □ 是  □ 否
通知延迟: _____ 秒
问题记录: ___________________________
```

---

## 🔗 快速链接

- [飞书机器人应用](https://www.feishu.cn/admin/appCenter/manage)
- [GitLab 应用管理](你的GitLab地址/profile/applications)
- [配置详细指南](./飞书工作配方-GitLab集成配置指南.md)
- [方案对比文档](./飞书工作配方-vs-GitLab-CI方案对比.md)

---

## ✅ 配置完成标志

当你完成以下所有步骤，配置就完成了：

```
✅ 所有检查项都已勾选
✅ 测试提交成功收到通知
✅ 执行日志显示成功
✅ 消息内容格式正确
✅ 接收人收到通知
```

---

**恭喜！配置完成！** 🎉

现在你可以：
1. 提交美术资源，自动收到通知
2. 查看执行记录，监控运行状态
3. 根据需要优化配置

有问题随时问我！🚀
