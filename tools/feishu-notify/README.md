# 飞书美术资源通知系统

> 自动通知系统，当美术资源提交到 GitLab 时，自动发送飞书消息给项目负责人

**当前版本**: v3.2  
**更新日期**: 2026-01-27  
**状态**: ✅ 生产环境运行中

---

## 🎯 选择方案

我们提供三种方案，根据你的需求选择：

### 方案 1：GitLab CI（当前使用）⭐⭐⭐

**适用场景**：需要立即使用，不能等待审批

- ✅ 不需要任何审批
- ✅ 配置简单
- ⚠️ 提交人显示为 "Unknown User"
- ⚠️ 不显示中文提交信息

📖 [GitLab CI 方案部署指南](./docs/GitLab-CI方案部署指南.md)

### 方案 2：Webhook（推荐）⭐⭐⭐⭐⭐

**适用场景**：对功能和用户体验要求高

- ✅ 中文完美支持
- ✅ 提交人信息完整
- ✅ 功能强大
- ❌ 需要 GitLab 管理员权限

📖 [Webhook 方案部署指南](./docs/Webhook方案部署指南.md)

### 方案 3：飞书工作配方⭐⭐⭐⭐

**适用场景**：公司已购买飞书高级套餐

- ✅ 官方支持
- ✅ 无需维护
- ✅ 功能完整
- ❌ 需要审批
- ⚠️ 可能付费

📖 [飞书工作配方部署指南](./docs/飞书工作配方部署指南.md)

---

## 📊 方案对比

详细对比请查看：[方案对比与选择指南](./方案对比与选择指南.md)

---

## 🚀 快速开始

### 1. 选择方案

根据上面的介绍选择适合你的方案。

### 2. 查看部署指南

- [GitLab CI 方案部署指南](./docs/GitLab-CI方案部署指南.md)
- [Webhook 方案部署指南](./docs/Webhook方案部署指南.md)
- [飞书工作配方部署指南](./docs/飞书工作配方部署指南.md)

### 3. 配置负责人名单

编辑 `config/owners.json`：

```json
{
    "_comment": "美术资源负责人配置文件",
    "_说明": "支持单人或多人通知",
    
    "项目名称": ["email@huixuanjiasu.com"],
    "groupTowArt_Hb": ["wangxinlai@huixuanjiasu.com"],
    "C_财运接龙": [
        "wangxinlai@huixuanjiasu.com",
        "zhaolida@huixuanjiasu.com"
    ]
}
```

---

## 📁 目录结构

```
Feishu_Notify_Setup/
├── 📁 config/                   # 配置文件
│   ├── owners.json             # ⭐ 负责人配置（生产环境）
│   ├── owners_example.json     # 配置示例
│   └── README.md               # 配置说明
│
├── 📁 docs/                     # 📚 文档中心
│   ├── GitLab-CI方案部署指南.md      # ⭐ GitLab CI 方案（当前使用）
│   ├── Webhook方案部署指南.md        # ⭐ Webhook 方案（推荐）
│   ├── 飞书工作配方部署指南.md       # ⭐ 飞书工作配方（官方）
│   ├── 关键经验-必读.md              # ⚠️ 修改代码前必读
│   ├── 飞书应用创建指南.md
│   ├── 部署到公司工程指南.md
│   ├── 修复方案.md
│   ├── 功能价值说明.md
│   └── ... (其他文档)
│
├── 📁 scripts/                  # Python 脚本
│   ├── notify_v3_gitlab_ci.py  # ⭐ GitLab CI 方案脚本
│   ├── gantt_reminder.py       # 甘特图任务提醒
│   ├── my_task_reminder.py     # 个人任务提醒
│   └── README.md               # 脚本说明
│
├── 📁 webhook_server/           # Webhook 方案
│   ├── webhook_server.py       # ⭐ Webhook 服务器
│   ├── 启动Webhook服务器.bat    # 启动脚本
│   ├── 测试Webhook.bat          # 测试脚本
│   ├── 快速部署指南.md
│   └── README.md
│
├── 📁 archives/                 # 归档文件（旧版本）
│   ├── ci-configs/             # 旧的 CI 配置（11 个版本）
│   ├── old-scripts/            # 旧版本脚本
│   ├── test-files/             # 测试文件
│   └── README.md
│
├── 📄 .gitlab-ci.yml            # ⭐ GitLab CI 配置（当前使用）
├── 📄 方案对比与选择指南.md      # ⭐ 三种方案对比
├── 📄 给老板的申请文档.md        # ⭐ 申请权限文档
├── 🔧 部署到公司工程.bat         # 部署工具
└── 📖 README.md                 # 本文件
```

**文件说明**：
- ⭐ 标记的是核心文件
- ⚠️ 标记的是重要文档
- 其他文件为辅助工具和历史文档

---

## 🔧 核心功能

### 三种方案共同功能

- ✅ 自动识别项目路径
- ✅ 支持多人通知
- ✅ 美观的卡片消息
- ✅ 详细的日志输出

### 方案特色功能

| 功能 | GitLab CI | Webhook | 飞书工作配方 |
|------|-----------|---------|-------------|
| 提交人信息 | ⚠️ 可能缺失 | ✅ 完整 | ✅ 完整 |
| 中文支持 | ⚠️ 受限 | ✅ 完美 | ✅ 完美 |
| 自定义能力 | 🟡 中等 | 🟢 强 | ⚠️ 受限 |
| 维护成本 | 🟡 中等 | 🟢 低 | 🟢 低 |

---

## 📋 版本历史

| 版本 | 日期 | 主要更新 |
|------|------|----------|
| v3.2 | 2026-01-27 | 文件夹整理，创建三种方案独立部署指南 |
| v3.1 | 2026-01-21 | 支持多人通知 |
| v3.0 | 2026-01-20 | 自动项目路径匹配 |
| v2.0 | 2025-12 | 增强版通知 |
| v1.0 | 2025-11 | 基础通知功能 |

---

## 📚 核心文档

### 部署指南（必读）

- [GitLab CI 方案部署指南](./docs/GitLab-CI方案部署指南.md) - 当前使用
- [Webhook 方案部署指南](./docs/Webhook方案部署指南.md) - 推荐方案
- [飞书工作配方部署指南](./docs/飞书工作配方部署指南.md) - 官方方案

### 决策文档

- [方案对比与选择指南](./方案对比与选择指南.md) - 三种方案详细对比
- [给老板的申请文档](./给老板的申请文档.md) - 申请权限模板

### 技术文档

- [关键经验-必读](./docs/关键经验-必读.md) - ⚠️ 修改代码前必读
- [飞书应用创建指南](./docs/飞书应用创建指南.md)
- [部署到公司工程指南](./docs/部署到公司工程指南.md)
- [修复方案](./docs/修复方案.md)

---

## 🐛 故障排查

### 快速诊断

1. **没有收到通知**：
   - 检查 CI/CD 日志
   - 检查 owners.json 配置
   - 检查飞书应用权限

2. **提交人显示为 "Unknown User"**：
   - 这是 GitLab CI 方案的已知限制
   - 建议升级到 Webhook 方案

3. **中文乱码**：
   - GitLab CI 方案：使用英文信息
   - 建议升级到 Webhook 方案

### 详细排查

查看对应方案的部署指南中的"故障排查"章节：
- [GitLab CI 方案故障排查](./docs/GitLab-CI方案部署指南.md#-故障排查)
- [Webhook 方案故障排查](./docs/Webhook方案部署指南.md#-故障排查)
- [飞书工作配方故障排查](./docs/飞书工作配方部署指南.md#-故障排查)

---

## 🚀 升级路径

### 当前状态

- ✅ GitLab CI 方案已部署
- ✅ 核心功能正常
- ⚠️ 提交人信息缺失

### 推荐升级

**升级到 Webhook 方案**（推荐）：
1. 申请 GitLab 管理员权限
2. 部署 Webhook 服务器（5 分钟）
3. 享受完整功能

**或升级到飞书工作配方**：
1. 申请飞书工作配方功能
2. 可视化配置（10 分钟）
3. 官方支持，无需维护

---

## 📞 技术支持

### 文档位置

- **本地路径**: `E:\K_Kiro_Work\Feishu_Notify_Setup`
- **公司工程**: `D:\HuiXuanJiaSu\I_IAA_Work`
- **GitLab Runner**: `C:\GitLab-Runner`

### 联系方式

- **技术负责人**: 美术技术团队
- **邮箱**: wangxinlai@huixuanjiasu.com

---

## 🎉 总结

### 当前方案

**GitLab CI 方案** ✅
- 立即可用，不需要审批
- 核心功能完整
- 提交人信息缺失（已知限制）

### 推荐方案

**Webhook 方案** 🏆
- 功能最完整
- 用户体验最好
- 需要 GitLab 管理员权限

### 未来方向

根据审批结果选择：
1. Webhook 方案（如果管理员批准）
2. 飞书工作配方（如果老板批准）
3. 继续优化 GitLab CI 方案（如果都不批准）

---

**创建时间**: 2025-11  
**最后更新**: 2026-01-27  
**维护人**: 技术团队  
**版本**: v3.2
