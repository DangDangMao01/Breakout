# 飞书工作配方 - 快速配置清单

**配置时间**: 10 分钟  
**难度**: ⭐⭐ (简单)  
**日期**: 2026-01-27

---

## ✅ 配置前准备

### 需要的信息

- [ ] GitLab URL: `https://gitlab.huixuanjiasu.com`
- [ ] GitLab 项目: `grouptwogame/grouptowart_hb`
- [ ] 通知人员邮箱: `wangxinlai@huixuanjiasu.com`

### 需要的权限

- [ ] 飞书管理后台访问权限
- [ ] 工作配方功能权限（如果没有，需要申请）
- [ ] GitLab 账号（用于创建 Access Token）

---

## 📝 配置步骤

### Step 1: 创建 GitLab Access Token (2 分钟)

1. [ ] 登录 GitLab: https://gitlab.huixuanjiasu.com
2. [ ] 点击右上角头像 → **Settings**
3. [ ] 点击左侧 **Access Tokens**
4. [ ] 填写信息：
   - Name: `飞书工作配方`
   - Scopes: ✅ 勾选 `api`
5. [ ] 点击 **Create personal access token**
6. [ ] **立即复制 Token**（只显示一次！）

```
Token: ________________________________
（粘贴到这里备用）
```

---

### Step 2: 进入飞书工作配方 (1 分钟)

1. [ ] 登录飞书管理后台: https://www.feishu.cn/admin
2. [ ] 点击左侧菜单 **工作台** → **工作配方**
3. [ ] 点击 **创建配方** 按钮

---

### Step 3: 配置触发器 (2 分钟)

#### 3.1 选择触发器

1. [ ] 搜索框输入: `GitLab`
2. [ ] 选择: **GitLab - 代码推送时**
3. [ ] 点击 **下一步**

#### 3.2 配置 GitLab 连接

1. [ ] GitLab URL: `https://gitlab.huixuanjiasu.com`
2. [ ] Access Token: 粘贴 Step 1 复制的 Token
3. [ ] 点击 **测试连接**
4. [ ] 确认显示 ✅ **连接成功**

#### 3.3 选择项目

1. [ ] 在项目列表中找到: `grouptwogame/grouptowart_hb`
2. [ ] 勾选该项目
3. [ ] 点击 **下一步**

---

### Step 4: 配置动作 (3 分钟)

#### 4.1 添加发送消息动作

1. [ ] 点击 **添加动作**
2. [ ] 搜索: `发送消息`
3. [ ] 选择: **发送飞书消息**

#### 4.2 配置接收人

1. [ ] 接收人类型: 选择 **指定用户**
2. [ ] 添加用户: 输入 `wangxinlai@huixuanjiasu.com` 或搜索姓名
3. [ ] 确认用户已添加

#### 4.3 配置消息内容

1. [ ] 消息类型: 选择 **卡片消息**
2. [ ] 复制以下 JSON 到消息内容框：

```json
{
  "config": {
    "wide_screen_mode": true
  },
  "header": {
    "title": {
      "tag": "plain_text",
      "content": "【美术资源更新提醒】"
    },
    "template": "blue"
  },
  "elements": [
    {
      "tag": "div",
      "fields": [
        {
          "is_short": true,
          "text": {
            "tag": "lark_md",
            "content": "**项目**\n{{project_name}}"
          }
        },
        {
          "is_short": true,
          "text": {
            "tag": "lark_md",
            "content": "**提交人**\n{{user_name}}"
          }
        }
      ]
    },
    {
      "tag": "div",
      "text": {
        "tag": "lark_md",
        "content": "**提交信息**\n{{commit_message}}"
      }
    },
    {
      "tag": "action",
      "actions": [
        {
          "tag": "button",
          "text": {
            "tag": "plain_text",
            "content": "查看变更"
          },
          "url": "{{commit_url}}",
          "type": "primary"
        }
      ]
    }
  ]
}
```

3. [ ] 确认 JSON 格式正确（没有红色错误提示）

---

### Step 5: 保存并启用 (1 分钟)

1. [ ] 点击 **保存** 按钮
2. [ ] 配方名称: `GitLab 美术资源更新通知`
3. [ ] 点击 **启用** 开关
4. [ ] 确认状态显示为 **已启用**

---

### Step 6: 测试配方 (1 分钟)

#### 方式 1: 使用测试功能

1. [ ] 在配方详情页点击 **测试** 按钮
2. [ ] 选择一个历史提交记录
3. [ ] 点击 **运行测试**
4. [ ] 查看飞书是否收到通知

#### 方式 2: 提交代码测试

```bash
cd D:\HuiXuanJiaSu\I_IAA_Work
git add .
git commit -m "测试飞书工作配方通知"
git push
```

5. [ ] 等待 10-30 秒
6. [ ] 查看飞书是否收到通知

---

## 🎉 配置完成检查

### 通知效果

你应该收到类似这样的飞书消息：

```
【美术资源更新提醒】

项目: GroupTwoGame/groupTowArt_Hb
提交人: 王新来
提交信息: 测试飞书工作配方通知

[查看变更] (按钮)
```

### 检查清单

- [ ] ✅ 收到了飞书通知
- [ ] ✅ 项目名称显示正确
- [ ] ✅ 提交人姓名显示正确
- [ ] ✅ 提交信息显示正确（中文无乱码）
- [ ] ✅ 点击按钮可以跳转到 GitLab

---

## 🔧 添加更多人员

如果需要通知多个人：

### 方式 1: 添加多个接收人（推荐）

1. [ ] 进入配方详情页
2. [ ] 点击 **编辑**
3. [ ] 在 "发送消息" 动作中，点击 **添加接收人**
4. [ ] 添加新的邮箱: `zhaolida@huixuanjiasu.com`
5. [ ] 保存

### 方式 2: 添加多个动作

1. [ ] 进入配方详情页
2. [ ] 点击 **编辑**
3. [ ] 点击 **添加动作**
4. [ ] 重复配置 "发送消息"，选择不同的接收人
5. [ ] 保存

### 方式 3: 使用群组（推荐多人）

1. [ ] 创建飞书群组: `美术资源通知群`
2. [ ] 添加所有需要通知的人
3. [ ] 在配方中，接收人选择 **群组**
4. [ ] 选择刚创建的群组

---

## 🚀 添加更多项目

如果需要监听其他项目：

1. [ ] 进入配方详情页
2. [ ] 点击 **编辑**
3. [ ] 在触发器配置中，点击 **添加项目**
4. [ ] 选择新项目: 例如 `Y_遇水发财`
5. [ ] 保存

---

## 📊 查看执行记录

随时查看配方运行情况：

1. [ ] 进入配方详情页
2. [ ] 点击 **执行记录** 标签
3. [ ] 查看每次执行的状态：
   - ✅ 成功
   - ❌ 失败（查看错误信息）
   - ⏳ 执行中

---

## ⚠️ 常见问题

### Q1: 找不到 "工作配方" 菜单？

**原因**: 公司飞书套餐不包含工作配方功能

**解决方案**:
1. 联系飞书管理员
2. 或参考 [给老板的申请文档](./给老板的申请文档.md) 申请开通

---

### Q2: GitLab 连接失败？

**检查清单**:
- [ ] GitLab URL 是否正确？
- [ ] Access Token 是否复制完整？
- [ ] Token 是否勾选了 `api` 权限？
- [ ] Token 是否已过期？

**解决方案**: 重新创建 Access Token

---

### Q3: 没有收到通知？

**检查清单**:
- [ ] 配方是否已启用？
- [ ] 接收人邮箱是否正确？
- [ ] 用户是否在飞书中？
- [ ] 查看执行记录是否有错误？

**调试方法**:
1. 查看配方执行记录
2. 使用测试功能测试
3. 检查飞书消息设置（是否屏蔽了机器人消息）

---

### Q4: 通知延迟？

**正常情况**: 10-30 秒延迟是正常的

**异常情况**: 如果超过 5 分钟：
1. 查看执行记录
2. 检查 GitLab 是否正常
3. 联系飞书客服

---

## 🎯 下一步

### 优化建议

1. [ ] **添加条件触发**
   - 只在 master/main 分支触发
   - 只在特定文件变更时触发

2. [ ] **自定义消息模板**
   - 修改卡片颜色
   - 添加更多信息字段

3. [ ] **配置多个项目**
   - 为不同项目配置不同的接收人
   - 使用条件判断

### 禁用 GitLab CI 方案（可选）

如果之前使用了 GitLab CI 方案，现在可以禁用：

1. [ ] 打开 `.gitlab-ci.yml` 文件
2. [ ] 注释掉 `notify` 任务：

```yaml
# notify:
#   stage: notify
#   ...
```

3. [ ] 提交并推送

---

## 📚 相关文档

- [飞书工作配方部署指南](./docs/飞书工作配方部署指南.md) - 详细文档
- [方案对比与选择指南](./方案对比与选择指南.md) - 三种方案对比
- [给老板的申请文档](./给老板的申请文档.md) - 申请模板

---

## 🎉 恭喜！

你已经成功配置了飞书工作配方！

**优势**:
- ✅ 官方支持，稳定可靠
- ✅ 无需维护代码
- ✅ 中文和提交人信息完整
- ✅ 可视化配置，简单易用

**享受自动化通知吧！** 🎊

---

**创建时间**: 2026-01-27  
**维护人**: 技术团队  
**版本**: v1.0
