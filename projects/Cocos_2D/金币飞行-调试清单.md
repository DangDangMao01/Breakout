# 金币飞行动画 - 调试清单

**问题**: 金币没有飞行  
**场景结构**: ✅ 已搭建（Canvas → CoinManager, CoinIcon, TestButton）

---

## 🔍 排查步骤

### 1️⃣ 检查 TestButton 的 Button 组件

#### TestButton 节点必须有 Button 组件
- [ ] 是否添加了 `Button` 组件？（Cocos 自带组件）
- [ ] Button 组件的 `Interactable` 是否勾选？
- [ ] `Transition` 设置为 `SCALE`（可选，但推荐）

**如何添加 Button 组件**：
1. 选中 `TestButton` 节点
2. 点击 **添加组件**
3. 选择 **UI 组件 → Button**
4. 设置属性：
   - Target: TestButton（自己）
   - Transition: SCALE
   - Interactable: ✅ 勾选

---

### 2️⃣ 检查组件是否正确挂载

#### CoinManager 节点
- [ ] 是否添加了 `CoinFlyAnimation_RoyalMatch` 组件？
- [ ] 或者添加了 `CoinFlyAnimation` 组件？

**如何检查**：
1. 选中 `CoinManager` 节点
2. 在属性检查器中查看是否有金币飞行组件

---

### 2️⃣ 检查 Coin Prefab 是否设置

#### 在 CoinManager 的组件属性中
- [ ] `Coin Prefab` 是否拖拽了金币预制体？
- [ ] 预制体是否为空（null）？

**如何检查**：
1. 选中 `CoinManager` 节点
2. 查看 `CoinFlyAnimation` 组件
3. 确认 `Coin Prefab` 属性有预制体

**如果为空**：
- 从 `assets/prefabs` 文件夹拖拽 `Coin` 预制体到这里

---

### 3️⃣ 检查测试脚本是否正确

#### Canvas 节点
- [ ] 是否添加了 `CoinTest` 组件？
- [ ] 组件属性是否都设置了？

**需要设置的属性**：
- `coinFlyAnim` → 拖拽 CoinManager 节点
- `coinIcon` → 拖拽 CoinIcon 节点
- `coinLabel` → 拖拽 CoinIcon/CoinLabel 节点
- `testButton` → 拖拽 TestButton 节点

---

### 4️⃣ 检查按钮点击事件

#### TestButton 节点
- [ ] Button 组件是否正常？
- [ ] 是否绑定了点击事件？

**如何检查**：
1. 选中 `TestButton` 节点
2. 查看 Button 组件
3. 确认 `Click Events` 中有事件

**如果没有事件**：
- 不用手动添加，代码中已经绑定了

---

### 5️⃣ 检查控制台错误

#### 运行游戏后查看控制台

**常见错误**：

**错误 1**: `Cannot read property 'flyCoins' of null`
- **原因**: coinFlyAnim 组件未设置
- **解决**: 拖拽 CoinManager 到 Canvas 的 CoinTest 组件的 coinFlyAnim 属性

**错误 2**: `请设置 coinPrefab`
- **原因**: 金币预制体未设置
- **解决**: 拖拽金币预制体到 CoinManager 的 Coin Prefab 属性

**错误 3**: `找不到 CoinFlyAnimation_RoyalMatch 组件`
- **原因**: 脚本文件名或类名不对
- **解决**: 确认脚本文件名和代码中的类名一致

---

## 🐛 快速调试代码

### 在 CoinTest.js 的 onTestClick 方法中添加调试信息：

```javascript
onTestClick() {
    console.log("=== 开始调试 ===");
    
    // 1. 检查组件
    if (!this.coinFlyAnim) {
        console.error("❌ coinFlyAnim 未设置！");
        return;
    }
    console.log("✅ coinFlyAnim 组件存在");
    
    // 2. 检查节点
    if (!this.testButton || !this.coinIcon) {
        console.error("❌ testButton 或 coinIcon 未设置！");
        return;
    }
    console.log("✅ 节点都存在");
    
    // 3. 检查位置
    let startPos = this.testButton.convertToWorldSpaceAR(cc.v2(0, 0));
    let endPos = this.coinIcon.convertToWorldSpaceAR(cc.v2(0, 0));
    console.log("起始位置:", startPos);
    console.log("结束位置:", endPos);
    
    // 4. 调用飞行
    console.log("开始飞行...");
    this.coinFlyAnim.flyCoins(startPos, endPos, 10, () => {
        console.log("✅ 飞行完成！");
        this.addCoins(50);
    });
}
```

---

## 📋 完整的 CoinTest.js 代码

如果你的代码有问题，可以用这个：

```javascript
cc.Class({
    extends: cc.Component,

    properties: {
        coinFlyAnim: {
            default: null,
            type: cc.Component,
            tooltip: "CoinFlyAnimation 组件"
        },
        coinIcon: {
            default: null,
            type: cc.Node,
            tooltip: "金币图标节点"
        },
        coinLabel: {
            default: null,
            type: cc.Label,
            tooltip: "金币数量标签"
        },
        testButton: {
            default: null,
            type: cc.Node,
            tooltip: "测试按钮"
        }
    },

    onLoad() {
        console.log("=== CoinTest 初始化 ===");
        
        // 初始金币数量
        this.currentCoins = 0;
        this.updateCoinLabel();

        // 检查组件
        if (!this.coinFlyAnim) {
            console.error("❌ coinFlyAnim 未设置！请在属性检查器中设置");
        }
        if (!this.coinIcon) {
            console.error("❌ coinIcon 未设置！");
        }
        if (!this.testButton) {
            console.error("❌ testButton 未设置！");
        }

        // 绑定按钮点击事件
        if (this.testButton) {
            this.testButton.on('click', this.onTestClick, this);
            console.log("✅ 按钮点击事件已绑定");
        }
    },

    onTestClick() {
        console.log("=== 按钮被点击 ===");
        
        // 检查组件
        if (!this.coinFlyAnim) {
            console.error("❌ coinFlyAnim 组件不存在！");
            return;
        }

        // 检查节点
        if (!this.testButton || !this.coinIcon) {
            console.error("❌ 节点不存在！");
            return;
        }

        // 获取位置
        let startPos = this.testButton.convertToWorldSpaceAR(cc.v2(0, 0));
        let endPos = this.coinIcon.convertToWorldSpaceAR(cc.v2(0, 0));

        console.log("起始位置:", startPos);
        console.log("结束位置:", endPos);
        console.log("开始飞行 10 个金币...");

        // 飞行金币
        this.coinFlyAnim.flyCoins(startPos, endPos, 10, () => {
            console.log("✅ 金币飞行完成！");
            this.addCoins(50);
            
            // 金币图标反馈动画
            if (this.coinIcon) {
                this.coinIcon.runAction(cc.sequence(
                    cc.scaleTo(0.1, 1.2),
                    cc.scaleTo(0.1, 1.0)
                ));
            }
        });
    },

    addCoins(amount) {
        this.currentCoins += amount;
        this.updateCoinLabel();
        console.log("当前金币:", this.currentCoins);
    },

    updateCoinLabel() {
        if (this.coinLabel) {
            this.coinLabel.string = this.currentCoins.toString();
        }
    }
});
```

---

## 🎯 最可能的问题

根据经验，最常见的问题是：

### 问题 1: Coin Prefab 未设置 ⭐⭐⭐⭐⭐

**症状**: 控制台显示 "请设置 coinPrefab"

**解决方案**:
1. 选中 `CoinManager` 节点
2. 找到 `CoinFlyAnimation` 组件
3. 将金币预制体拖拽到 `Coin Prefab` 属性

---

### 问题 2: 组件属性未设置 ⭐⭐⭐⭐

**症状**: 控制台显示 "Cannot read property 'flyCoins' of null"

**解决方案**:
1. 选中 `Canvas` 节点
2. 找到 `CoinTest` 组件
3. 将对应节点拖拽到属性：
   - coinFlyAnim → CoinManager
   - coinIcon → CoinIcon
   - coinLabel → CoinIcon/CoinLabel
   - testButton → TestButton

---

### 问题 3: 脚本文件名不对 ⭐⭐⭐

**症状**: 找不到组件

**解决方案**:
- 确认脚本文件名: `CoinFlyAnimation_RoyalMatch.js`
- 或者使用: `CoinFlyAnimation.js`
- 文件名必须和代码中的类名一致

---

## 📸 截图检查

请截图以下内容，我帮你检查：

1. **CoinManager 节点的属性检查器**
   - 查看组件和属性设置

2. **Canvas 节点的属性检查器**
   - 查看 CoinTest 组件的属性设置

3. **控制台输出**
   - 点击按钮后的错误信息

---

## 🆘 如果还是不行

请告诉我：
1. 控制台有什么错误信息？
2. 点击按钮有反应吗？
3. 金币预制体设置了吗？

我会根据具体情况帮你解决！

---

**创建时间**: 2026-01-27  
**用途**: 调试金币飞行动画
