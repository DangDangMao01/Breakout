# 飞书工作配方 vs GitLab CI - 方案对比

> 日期: 2026-01-22  
> 目的: 对比两种实现方式，选择最优方案

---

## 🎯 你的发现

你发现了**飞书工作配方（Feishu Recipes）**的"关键消息提醒"功能，可能可以和 Git 关联！

这是个很好的想法！让我们对比一下两种方案。

---

## 📊 方案对比

### 方案 1：当前方案（GitLab CI + Python 脚本）

**工作流程**：
```
提交代码 → GitLab CI 触发 → Runner 执行脚本 → 调用飞书 API → 发送通知
```

**优点**：
- ✅ 完全自动化，无需人工干预
- ✅ 可以自定义复杂逻辑（多人通知、项目匹配等）
- ✅ 可以获取详细的提交信息（SHA、URL、文件列表等）
- ✅ 不依赖飞书的额外功能
- ✅ 已经实现并测试通过

**缺点**：
- ❌ 需要配置 GitLab Runner
- ❌ 需要写 Python 脚本
- ❌ 需要维护 `.gitlab-ci.yml`
- ❌ 调试相对复杂（需要查看 CI 日志）

---

### 方案 2：飞书工作配方（GitLab Webhook + 飞书工作流）

**工作流程**：
```
提交代码 → GitLab Webhook → 飞书工作配方 → 自动化流程 → 发送通知
```

**优点**：
- ✅ 可视化配置，无需写代码
- ✅ 飞书原生支持，集成度高
- ✅ 可以结合飞书其他功能（多维表格、审批等）
- ✅ 调试方便（飞书工作流有可视化日志）
- ✅ 可以使用 AI 节点进行智能分类

**缺点**：
- ❌ 需要配置 GitLab Webhook
- ❌ 依赖飞书工作配方功能（可能需要付费版）
- ❌ 灵活性可能不如自定义脚本
- ❌ 需要学习飞书工作配方的使用

---

## 🔍 飞书工作配方详解

### 什么是飞书工作配方？

**飞书工作配方（Feishu Recipes）** 是飞书的自动化工作流工具，类似于：
- Zapier（国外）
- n8n（开源）
- IFTTT（If This Then That）

**核心功能**：
1. **触发器**：当某个事件发生时（如收到 Webhook、收到消息等）
2. **动作**：执行某个操作（如发送通知、创建记录等）
3. **条件**：根据条件分支执行不同操作
4. **AI 节点**：使用 AI 进行智能分类、提取信息等

---

### 飞书工作配方的新功能（2026 年）

根据我找到的资料，飞书工作配方最近新增了：

1. **接收飞书消息节点**
   - 可以接收群聊或单聊消息
   - 支持 @机器人触发
   - 自动提取消息内容

2. **AI 分类节点**
   - 自动对消息进行分类
   - 支持自定义分类规则
   - 可以根据分类执行不同操作

3. **多维表格集成**
   - 自动记录到多维表格
   - 支持自动派单
   - 支持数据统计

---

## 🎯 GitLab + 飞书工作配方集成方案

### 实现思路

```
GitLab 提交
   ↓
GitLab Webhook（发送 HTTP POST 请求）
   ↓
飞书工作配方（接收 Webhook）
   ↓
解析提交信息（项目、提交人、文件等）
   ↓
匹配负责人（根据项目路径）
   ↓
发送飞书通知（卡片消息）
   ↓
（可选）记录到多维表格
```

---

### 配置步骤

#### Step 1: 在飞书创建工作配方

1. 打开飞书工作台
2. 找到"工作配方"或"自动化"
3. 创建新的工作流
4. 选择触发器：**接收 Webhook**

#### Step 2: 配置 GitLab Webhook

1. 打开 GitLab 项目
2. 设置 → Webhooks
3. 添加 Webhook URL（飞书工作配方提供的 URL）
4. 选择触发事件：
   - ✅ Push events（代码提交）
   - ✅ Merge request events（合并请求）
   - ❌ 其他事件（根据需要）

#### Step 3: 配置飞书工作流

**节点 1：接收 Webhook**
- 触发器：接收到 HTTP 请求
- 提取数据：
  - `project.path_with_namespace` - 项目路径
  - `user_name` - 提交人
  - `commits[0].message` - 提交信息
  - `commits[0].url` - 提交链接

**节点 2：条件判断**
- 根据项目路径匹配负责人
- 例如：
  - 如果项目路径包含 "Y_遇水发财" → 负责人：赵丽达
  - 如果项目路径包含 "C_财运接龙" → 负责人：王新来、赵丽达
  - 如果项目路径包含 "groupTowArt_Hb" → 负责人：王新来

**节点 3：发送飞书通知**
- 发送给：匹配到的负责人
- 消息类型：卡片消息
- 消息内容：
  - 项目名称
  - 提交人
  - 提交信息
  - 查看变更按钮

**节点 4（可选）：记录到多维表格**
- 表格：美术资源提交记录
- 字段：
  - 项目名称
  - 提交人
  - 提交时间
  - 提交信息
  - 负责人

---

## 💡 方案推荐

### 短期推荐：继续使用当前方案（GitLab CI）

**理由**：
1. ✅ 已经实现并测试通过
2. ✅ 不需要额外学习成本
3. ✅ 今天就要提交资源，不适合大改
4. ✅ 功能完整，满足需求

**建议**：
- 先用当前方案，确保今天的提交正常
- 等稳定后再考虑迁移

---

### 长期推荐：迁移到飞书工作配方

**理由**：
1. ✅ 可视化配置，更易维护
2. ✅ 飞书原生支持，集成度高
3. ✅ 可以结合多维表格，做数据统计
4. ✅ 可以使用 AI 节点，做智能分类
5. ✅ 不依赖 GitLab Runner，减少维护成本

**迁移计划**：
1. **第 1 周**：学习飞书工作配方的使用
2. **第 2 周**：配置测试环境，验证功能
3. **第 3 周**：并行运行两套方案，对比效果
4. **第 4 周**：完全迁移到飞书工作配方

---

## 🔧 飞书工作配方的高级玩法

### 1. 智能分类

使用 AI 节点自动分类提交类型：
- 美术资源更新
- 代码修复
- 功能开发
- 文档更新

根据分类发送给不同的人或群组。

---

### 2. 自动派单

结合多维表格，自动创建任务：
- 提交信息 → 创建任务
- 自动分配给负责人
- 设置截止时间
- 跟踪完成状态

---

### 3. 数据统计

自动记录到多维表格，生成报表：
- 每个项目的提交次数
- 每个人的提交频率
- 提交时间分布
- 资源类型统计

---

### 4. 审批流程

对于重要的提交，可以加入审批流程：
- 提交 → 通知负责人
- 负责人审批
- 审批通过 → 通知相关人员
- 审批拒绝 → 通知提交人修改

---

## 📚 参考资料

### 飞书工作配方

- 官方文档：https://www.feishu.cn/hc/zh-CN/articles/360049067822
- 工作配方入口：https://recipes.feishu.cn/
- 教程文章：https://duntools.com/feishu-base-workflow/

### GitLab Webhook

- 官方文档：https://docs.gitlab.com/ee/user/project/integrations/webhooks.html
- Webhook 事件：https://docs.gitlab.com/ee/user/project/integrations/webhook_events.html

---

## 🎯 下一步行动

### 今天（2026-01-22）

1. ✅ 使用当前方案（GitLab CI）
2. ✅ 运行"一键修复部署.bat"
3. ✅ 提交美术资源
4. ✅ 确认通知正常

### 本周

1. 📖 学习飞书工作配方的使用
2. 🔍 研究 GitLab Webhook 配置
3. 📝 设计飞书工作配方的流程图

### 下周

1. 🧪 搭建测试环境
2. ⚙️ 配置飞书工作配方
3. 🔬 测试功能完整性

### 下下周

1. 🔄 并行运行两套方案
2. 📊 对比效果和稳定性
3. 🚀 决定是否完全迁移

---

## 💬 总结

你的发现非常棒！**飞书工作配方**确实是一个更优雅的解决方案。

**当前建议**：
- 今天先用 GitLab CI 方案（已经实现，稳定可靠）
- 之后逐步迁移到飞书工作配方（更易维护，功能更强）

**两种方案可以并存**：
- GitLab CI：作为备用方案
- 飞书工作配方：作为主要方案

这样既保证了稳定性，又能享受飞书工作配方的便利性。

---

**有问题随时问我！** 🚀

我可以帮你：
1. 配置飞书工作配方
2. 设计工作流程
3. 调试和优化
