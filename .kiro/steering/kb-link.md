---
inclusion: always
---

# KB Link - 强制跨项目上下文检查

Central KB: `D:\G_GitHub\Kiro-Central-KB`

## 🚨 CRITICAL: 对话开始时必须执行

在回答用户问题之前，你**必须**执行以下步骤：

### 1. 时间关键词触发（🔴 最高优先级 - 优先于所有其他关键词）

**⚠️ 关键规则**: 时间关键词 **永远优先于** 技术关键词和项目关键词！

**立即执行表**：

| 用户问题模式 | 立即执行的操作 | 优先级 |
|------------|--------------|--------|
| "今天.*做.*什么" | 读取 `knowledge-base/notes/YYYYMMDD-今日对话总结.md` | 🔴 P0 |
| "今天.*探讨.*什么" | 读取 `knowledge-base/notes/YYYYMMDD-今日对话总结.md` | 🔴 P0 |
| "今天.*讨论.*什么" | 读取 `knowledge-base/notes/YYYYMMDD-今日对话总结.md` | 🔴 P0 |
| "今天" + 任何问题 | 读取 `knowledge-base/notes/YYYYMMDD-今日对话总结.md` | 🔴 P0 |
| "昨天.*做.*什么" | 读取昨日总结 | 🔴 P0 |
| "昨天.*讨论.*什么" | 读取昨日总结 | 🔴 P0 |
| "昨晚.*做.*什么" | 读取昨日总结 | 🔴 P0 |
| "昨晚.*测试" | 读取昨日总结 + 测试记录 | 🔴 P0 |
| "最近.*做.*什么" | 读取最近 3 天的总结 | 🔴 P0 |

**⚠️ 重要提示**:
- 即使问题中包含"跨设备"、"Hook"等技术关键词，如果有时间关键词，**先处理时间**
- 例如："今天在另一台设备做了什么？" → 先读取今日总结，不要被"另一台设备"误导
- 例如："昨晚测试 Hook 的结果如何？" → 先读取昨日总结，不要被"Hook"误导

### 2. 直接问题触发（🟠 高优先级）

**立即执行表**：

| 用户问题模式 | 立即执行的操作 | 优先级 |
|------------|--------------|--------|
| "继续开发\|继续工作\|继续" | 读取完整上下文包（见下方详细说明） | 🟠 P1 |
| "我们之前.*讨论" | 检索本地 + 中央知识库 | 🟠 P1 |
| "之前.*说过" | 检索本地 + 中央知识库 | 🟠 P1 |
| "保存到知识库" | 评估对话质量并保存 | 🟠 P1 |

**"继续"关键词的完整上下文包**:
```
1. SESSION-STATE.md（当前任务状态）
2. knowledge-base/notes/YYYYMMDD-今日对话总结.md（今日工作）
3. 最近修改的文件（Git diff，如果在 Git 仓库中）
4. 最近的错误日志（如果存在 .kiro/logs/ 或项目日志）
5. 相关项目的 README.md（如果在项目目录中）
```

**为什么这样做**:
- ✅ 提供完整的上下文，避免用户重复解释
- ✅ 像"真人"一样记得今天做了什么
- ✅ 自动关联相关信息，提升预判准确度

### 3. 技术和项目关键词触发（🟡 中优先级）

**⚠️ 仅当没有时间关键词时**，才检查技术关键词！

**何时检索**:
- ✅ 用户提出技术问题时
- ✅ 讨论架构设计时
- ✅ 提到其他项目或系统时
- ✅ 讨论之前可能讨论过的话题时
- ✅ **匹配到任何关键词时（不要犹豫）**

**关键词触发列表**:

**技术关键词**:
- Clawdbot, Claude Code, Claude-Mem → 超长记忆上下文
- Skills → 自动生成机制
- 神经网络 → AI 架构思想
- 胎儿期、成长 → AI 哲学
- 知识库、插件 → 架构设计
- 跨项目、上下文 → 上下文断裂问题
- Hook → 自动化、跨设备
- Ollama, Qwen → 本地 AI 系统
- 向量数据库, ChromaDB, Chroma → 超长记忆实现
- 预判、准确度 → AI 智能评估
- DevBrain → DevBrain-App 项目
- 腾讯元宝, IMA → 竞品分析

**项目关键词**:
- Kiro-KB-Plugin → 检索插件项目文档
- DevBrain-App → 检索应用项目文档
- K_Kiro_Work → 当前项目
- 中央知识库 → 检索 `D:\G_GitHub\Kiro-Central-KB\`

**情感关键词**（模糊时间/状态查询）:
- "忙吗"、"怎么样"、"进展如何" → 读取今日总结 + 任务状态
- "累吗"、"辛苦了" → 读取今日总结 + 情感回应
- "有什么新发现" → 读取最近 3 天的总结

**如何检索**:
```
⚠️ 我发现这个话题之前可能讨论过（关键词：[匹配的关键词]）。

让我先检索知识库...

【本地知识库】
1. 搜索 knowledge-base/notes/ 中的相关文档
2. 搜索 knowledge-base/solutions/ 中的相关方案
3. 搜索 docs/ 中的相关文档

【中央知识库】
4. 读取 D:\G_GitHub\Kiro-Central-KB\INDEX.md
5. 搜索相关关键词
6. 读取找到的文档

【其他项目】
7. 搜索 incubator/graduated/Kiro-KB-Plugin/docs/
8. 搜索其他相关项目文档

请稍等...
```

**检索后必须做**:
1. ✅ 告诉用户找到了什么（文件路径 + 标题）
2. ✅ 读取相关文档的完整内容
3. ✅ 在回答中引用相关讨论
4. ✅ 避免重复讨论

### 2. 检测重复讨论（防止重叠开发）

**关键词匹配**:
- Clawdbot, Claude Code → 超长记忆上下文
- Skills → 自动生成机制
- 神经网络 → AI 架构思想
- 胎儿期、成长 → AI 哲学
- 知识库、插件 → 架构设计
- 跨项目、上下文 → 上下文断裂问题
- Hook → 自动化、跨设备
- Ollama, Qwen → 本地 AI 系统

**如果发现相关讨论（必须提醒用户）**:
```
⚠️ 提醒用户：
"我在 [日期] 的 [项目名] 中发现了相关讨论：

【本地知识库】
- [文档标题] - [文档路径]

【中央知识库】
- [文档标题] - [文档路径]

【其他项目】
- [文档标题] - [文档路径]

让我先读取这些内容，避免重复讨论。"
```

**然后立即**:
1. ✅ 读取所有相关文档
2. ✅ 总结之前的讨论
3. ✅ 基于历史上下文回答
4. ✅ 指出新问题和已讨论内容的区别

### 3. 标记来源项目

保存知识时，**必须**包含：
```yaml
source_project: "K_Kiro_Work"
time: "HH:MM" (24小时制)
location: "公司/家里/其他"
related_discussions:
  - "path/to/related/doc.md"
```

**⚠️ 时间和地点的准确性**:
- 保存文档时，**必须**询问用户当前时间和地点
- 不要猜测或推断，只使用用户提供的信息
- 这对于跨设备上下文恢复至关重要！

## 📋 检查清单（每次对话开始时）

在回答用户问题之前，问自己：

- [ ] **用户问题是否匹配直接触发表？**（如"今天探讨的什么？"）
  - 如果是 → 立即读取对应文档，不要等待
  
- [ ] **用户问题是否包含关键词？**（如 Hook, Skills, Clawdbot）
  - 如果是 → 立即检索知识库，不要犹豫
  
- [ ] **这个话题之前讨论过吗？**
  - 如果可能 → 检索本地 + 中央知识库
  
- [ ] **是否需要检索中央知识库？**
  - 技术问题 → 是
  - 架构设计 → 是
  - 提到其他项目 → 是
  
- [ ] **是否有相关的历史讨论？**
  - 如果有 → 读取并引用
  
- [ ] **是否需要提醒用户避免重复？**
  - 如果发现重复 → 必须提醒

## ⚠️ 常见错误（避免）

❌ **错误 1**: 用户问"今天探讨的什么？"，我回答"让我检索..."
✅ **正确**: 立即读取 `knowledge-base/notes/YYYYMMDD-今日对话总结.md`

❌ **错误 2**: 用户问"今天在另一台设备做了什么？"，我被"另一台设备"误导
✅ **正确**: 时间关键词"今天"优先级最高，立即读取今日总结

❌ **错误 3**: 用户问"昨晚测试 Hook 的结果如何？"，我被"Hook"误导
✅ **正确**: 时间关键词"昨晚"优先级最高，立即读取昨日总结

❌ **错误 4**: 用户提到"Hook"，我直接回答
✅ **正确**: 先检索知识库，找到相关讨论，再回答

❌ **错误 5**: 检索到相关文档，但没有读取
✅ **正确**: 必须读取完整内容，然后基于内容回答

❌ **错误 6**: 发现重复讨论，但没有提醒用户
✅ **正确**: 必须提醒用户，避免重叠开发

## 🎯 目标

**避免重叠开发** - 不要让用户在不同项目中重复讨论相同的问题！
